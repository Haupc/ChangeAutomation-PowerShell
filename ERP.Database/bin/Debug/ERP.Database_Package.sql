/*
    Target database:    ERP.Database (configurable)
    Target instance:    (any)
    Generated date:     7/16/2019 9:19:17 AM
    Generated on:       PC
    Package version:    (undefined)
    Migration version:  (n/a)
    Baseline version:   (n/a)
    SQL Change Automation version:  3.2.19162.8508
    Migrations pending: (variable)

    IMPORTANT! "SQLCMD Mode" must be activated prior to execution (under the Query menu in SSMS).

    BEFORE EXECUTING THIS SCRIPT, WE STRONGLY RECOMMEND YOU TAKE A BACKUP OF YOUR DATABASE.

    This SQLCMD script is designed to be executed through MSBuild (via the .sqlproj Deploy target) however
    it can also be run manually using SQL Management Studio.

    It was generated by the SQL Change Automation build task and contains logic to deploy the database, ensuring that
    each of the incremental migrations is executed a single time only in alphabetical (filename)
    order. If any errors occur within those scripts, the deployment will be aborted and the transaction
    rolled-back.

    NOTE: Automatic transaction management is provided for incremental migrations, so you don't need to
          add any special BEGIN TRAN/COMMIT/ROLLBACK logic in those script files.
          However if you require transaction handling in your Pre/Post-Deployment scripts, you will
          need to add this logic to the source .sql files yourself.
*/

----====================================================================================================================
---- SQLCMD Variables
---- This script is designed to be called by SQLCMD.EXE with variables specified on the command line.
---- However you can also run it in SQL Management Studio by uncommenting this section (CTRL+K, CTRL+U).
--:setvar DatabaseName "ERP.Database"
--:setvar ReleaseVersion ""
--:setvar ForceDeployWithoutBaseline "False"
--:setvar DefaultFilePrefix "ERP.Database"
--:setvar DefaultDataPath ""
--:setvar DefaultLogPath ""
--:setvar DefaultBackupPath ""
--:setvar DeployPath ""
----====================================================================================================================

:on error exit -- Instructs SQLCMD to abort execution as soon as an erroneous batch is encountered

:setvar PackageVersion "(undefined)"
:setvar IsShadowDeployment 0

GO
:setvar IsSqlCmdEnabled "True"
GO

IF N'$(DatabaseName)' = N'$' + N'(DatabaseName)' OR
   N'$(ReleaseVersion)' = N'$' + N'(ReleaseVersion)' OR
   N'$(ForceDeployWithoutBaseline)' = N'$' + N'(ForceDeployWithoutBaseline)'
      RAISERROR('(This will not throw). Please make sure that all SQLCMD variables are defined before running this script.', 0, 0);
GO

SET IMPLICIT_TRANSACTIONS, NUMERIC_ROUNDABORT OFF;
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, NOCOUNT, QUOTED_IDENTIFIER ON;
SET XACT_ABORT ON; -- Abort the current batch immediately if a statement raises a run-time error and rollback any open transaction(s)

IF N'$(IsSqlCmdEnabled)' <> N'True' -- Is SQLCMD mode not enabled within the execution context (eg. SSMS)
    BEGIN
        IF IS_SRVROLEMEMBER(N'sysadmin') = 1
            BEGIN -- User is sysadmin; abort execution by disconnect the script from the database server
                RAISERROR(N'This script must be run in SQLCMD Mode (under the Query menu in SSMS). Aborting connection to suppress subsequent errors.', 20, 127, N'UNKNOWN') WITH LOG;
            END
        ELSE
            BEGIN -- User is not sysadmin; abort execution by switching off statement execution (script will continue to the end without performing any actual deployment work)
                RAISERROR(N'This script must be run in SQLCMD Mode (under the Query menu in SSMS). Script execution has been halted.', 16, 127, N'UNKNOWN') WITH NOWAIT;
            END
    END
GO
IF @@ERROR != 0
    BEGIN
        SET NOEXEC ON; -- SQLCMD is NOT enabled so prevent any further statements from executing
    END
GO
-- Beyond this point, no further explicit error handling is required because it can be assumed that SQLCMD mode is enabled

IF SERVERPROPERTY('EngineEdition') = 5 AND DB_NAME() != N'$(DatabaseName)'
  RAISERROR(N'Azure SQL Database does not support switching between databases. Connect to [$(DatabaseName)] and then re-run the script.', 16, 127);








------------------------------------------------------------------------------------------------------------------------
------------------------------------------       PRE-DEPLOYMENT SCRIPTS       ------------------------------------------
------------------------------------------------------------------------------------------------------------------------

SET IMPLICIT_TRANSACTIONS, NUMERIC_ROUNDABORT OFF;
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, NOCOUNT, QUOTED_IDENTIFIER ON;

PRINT '----- executing pre-deployment script "Pre-Deployment\01_Create_Database.sql" -----';
GO

------------------------- BEGIN PRE-DEPLOYMENT SCRIPT: "Pre-Deployment\01_Create_Database.sql" ---------------------------
IF (DB_ID(N'$(DatabaseName)') IS NULL)
BEGIN
	PRINT N'Creating $(DatabaseName)...';
END
GO
IF (DB_ID(N'$(DatabaseName)') IS NULL)
BEGIN
	CREATE DATABASE [$(DatabaseName)]; -- MODIFY THIS STATEMENT TO SPECIFY A COLLATION FOR YOUR DATABASE
END

GO
-------------------------- END PRE-DEPLOYMENT SCRIPT: "Pre-Deployment\01_Create_Database.sql" ----------------------------

SET IMPLICIT_TRANSACTIONS, NUMERIC_ROUNDABORT OFF;
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, NOCOUNT, QUOTED_IDENTIFIER ON;









------------------------------------------------------------------------------------------------------------------------
------------------------------------------       INCREMENTAL MIGRATIONS       ------------------------------------------
------------------------------------------------------------------------------------------------------------------------

SET IMPLICIT_TRANSACTIONS, NUMERIC_ROUNDABORT OFF;
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, NOCOUNT, QUOTED_IDENTIFIER ON;

GO
PRINT '# Beginning transaction';

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;

SET XACT_ABORT ON;

BEGIN TRANSACTION;

GO
IF DB_ID('$(DatabaseName)') IS NULL
  RAISERROR ('The database [$(DatabaseName)] could not be found. Please ensure that there is a Pre-Deployment script within your project that contains a CREATE DATABASE statement (e.g. Pre-Deployment\01_Create_Database.sql).', 16, 127);

GO
IF DB_NAME() != '$(DatabaseName)'
  USE [$(DatabaseName)];

GO
PRINT '# Setting up migration log table';
IF (NOT EXISTS (SELECT * FROM sys.objects WHERE [object_id] = OBJECT_ID(N'[dbo].[__MigrationLog]') AND [type] = 'U'))
  BEGIN
    IF OBJECT_ID(N'[dbo].[__MigrationLogCurrent]', 'V') IS NOT NULL
      DROP VIEW [dbo].[__MigrationLogCurrent];
    PRINT '# Creating a new migration log table';
    CREATE TABLE [dbo].[__MigrationLog] (
      [migration_id] UNIQUEIDENTIFIER NOT NULL,
      [script_checksum] NVARCHAR (64) NOT NULL,
      [script_filename] NVARCHAR (255) NOT NULL,
      [complete_dt] DATETIME2 NOT NULL,
      [applied_by] NVARCHAR (100) NOT NULL,
      [deployed] TINYINT CONSTRAINT [DF___MigrationLog_deployed] DEFAULT (1) NOT NULL,
      [version] VARCHAR (255) NULL,
      [package_version] VARCHAR (255) NULL,
      [release_version] VARCHAR (255) NULL,
      [sequence_no] INT IDENTITY (1, 1) NOT NULL CONSTRAINT [PK___MigrationLog] PRIMARY KEY CLUSTERED ([migration_id], [complete_dt], [script_checksum]));
    CREATE NONCLUSTERED INDEX [IX___MigrationLog_CompleteDt]
      ON [dbo].[__MigrationLog]([complete_dt]);
    CREATE NONCLUSTERED INDEX [IX___MigrationLog_Version]
      ON [dbo].[__MigrationLog]([version]);
    CREATE UNIQUE NONCLUSTERED INDEX [UX___MigrationLog_SequenceNo]
      ON [dbo].[__MigrationLog]([sequence_no]);
    EXECUTE ('
	CREATE VIEW [dbo].[__MigrationLogCurrent]
			AS
			WITH currentMigration AS
			(
			  SELECT
				 migration_id, script_checksum, script_filename, complete_dt, applied_by, deployed, ROW_NUMBER() OVER(PARTITION BY migration_id ORDER BY sequence_no DESC) AS RowNumber
			  FROM [dbo].[__MigrationLog]
			)
			SELECT  migration_id, script_checksum, script_filename, complete_dt, applied_by, deployed
			FROM currentMigration
			WHERE RowNumber = 1
	');
    IF OBJECT_ID(N'sp_addextendedproperty', 'P') IS NOT NULL
      BEGIN
        PRINT N'Creating extended properties';
        EXECUTE sp_addextendedproperty N'MS_Description', N'This table is required by SQL Change Automation projects to keep track of which migrations have been executed during deployment. Please do not alter or remove this table from the database.', 'SCHEMA', N'dbo', 'TABLE', N'__MigrationLog', NULL, NULL;
        EXECUTE sp_addextendedproperty N'MS_Description', N'The executing user at the time of deployment (populated using the SYSTEM_USER function).', 'SCHEMA', N'dbo', 'TABLE', N'__MigrationLog', 'COLUMN', N'applied_by';
        EXECUTE sp_addextendedproperty N'MS_Description', N'The date/time that the migration finished executing. This value is populated using the SYSDATETIME function.', 'SCHEMA', N'dbo', 'TABLE', N'__MigrationLog', 'COLUMN', N'complete_dt';
        EXECUTE sp_addextendedproperty N'MS_Description', N'This column contains a number of potential states:

0 - Marked As Deployed: The migration was not executed.
1- Deployed: The migration was executed successfully.
2- Imported: The migration was generated by importing from this DB.

"Marked As Deployed" and "Imported" are similar in that the migration was not executed on this database; it was was only marked as such to prevent it from executing during subsequent deployments.', 'SCHEMA', N'dbo', 'TABLE', N'__MigrationLog', 'COLUMN', N'deployed';
        EXECUTE sp_addextendedproperty N'MS_Description', N'The unique identifier of a migration script file. This value is stored within the <Migration /> Xml fragment within the header of the file itself.

Note that it is possible for this value to repeat in the [__MigrationLog] table. In the case of programmable object scripts, a record will be inserted with a particular ID each time a change is made to the source file and subsequently deployed.

In the case of a migration, you may see the same [migration_id] repeated, but only in the scenario where the "Mark As Deployed" button/command has been run.', 'SCHEMA', N'dbo', 'TABLE', N'__MigrationLog', 'COLUMN', N'migration_id';
        EXECUTE sp_addextendedproperty N'MS_Description', N'If you have enabled SQLCMD Packaging in your SQL Change Automation project, or if you are using Octopus Deploy, this will be the version number that your database package was stamped with at build-time.', 'SCHEMA', N'dbo', 'TABLE', N'__MigrationLog', 'COLUMN', N'package_version';
        EXECUTE sp_addextendedproperty N'MS_Description', N'If you are using Octopus Deploy, you can use the value in this column to look-up which release was responsible for deploying this migration.
If deploying via PowerShell, set the $ReleaseVersion variable to populate this column.
If deploying via Visual Studio, this column will always be NULL.', 'SCHEMA', N'dbo', 'TABLE', N'__MigrationLog', 'COLUMN', N'release_version';
        EXECUTE sp_addextendedproperty N'MS_Description', N'A SHA256 representation of the migration script file at the time of build.  This value is used to determine whether a migration has been changed since it was deployed. In the case of a programmable object script, a different checksum will cause the migration to be redeployed.
Note: if any variables have been specified as part of a deployment, this will not affect the checksum value.', 'SCHEMA', N'dbo', 'TABLE', N'__MigrationLog', 'COLUMN', N'script_checksum';
        EXECUTE sp_addextendedproperty N'MS_Description', N'The name of the migration script file on disk, at the time of build.
If Semantic Versioning has been enabled, then this value will contain the full relative path from the root of the project folder. If it is not enabled, then it will simply contain the filename itself.', 'SCHEMA', N'dbo', 'TABLE', N'__MigrationLog', 'COLUMN', N'script_filename';
        EXECUTE sp_addextendedproperty N'MS_Description', N'An auto-seeded numeric identifier that can be used to determine the order in which migrations were deployed.', 'SCHEMA', N'dbo', 'TABLE', N'__MigrationLog', 'COLUMN', N'sequence_no';
        EXECUTE sp_addextendedproperty N'MS_Description', N'The semantic version that this migration was created under. In SQL Change Automation projects, a folder can be given a version number, e.g. 1.0.0, and one or more migration scripts can be stored within that folder to provide logical grouping of related database changes.', 'SCHEMA', N'dbo', 'TABLE', N'__MigrationLog', 'COLUMN', N'version';
        EXECUTE sp_addextendedproperty N'MS_Description', N'This view is required by SQL Change Automation projects to determine whether a migration should be executed during a deployment. The view lists the most recent [__MigrationLog] entry for a given [migration_id], which is needed to determine whether a particular programmable object script needs to be (re)executed: a non-matching checksum on the current [__MigrationLog] entry will trigger the execution of a programmable object script. Please do not alter or remove this table from the database.', N'SCHEMA', N'dbo', N'VIEW', N'__MigrationLogCurrent', NULL, NULL;
      END
  END

IF NOT EXISTS (SELECT col.COLUMN_NAME FROM INFORMATION_SCHEMA.TABLE_CONSTRAINTS AS tab, INFORMATION_SCHEMA.CONSTRAINT_COLUMN_USAGE AS col WHERE col.CONSTRAINT_NAME = tab.CONSTRAINT_NAME AND col.TABLE_NAME = tab.TABLE_NAME AND col.TABLE_SCHEMA = tab.TABLE_SCHEMA AND tab.CONSTRAINT_TYPE = 'PRIMARY KEY' AND col.TABLE_SCHEMA = 'dbo' AND col.TABLE_NAME = '__MigrationLog' AND col.COLUMN_NAME = 'complete_dt')
  BEGIN
    RAISERROR (N'The SQL Change Automation [dbo].[__MigrationLog] table has an incorrect primary key specification. This may be due to the fact that the <SqlChangeAutomationSchemaVersion/> element in your .sqlproj file contains the wrong version number for your database. Please check earlier versions of your .sqlproj file to determine what is the appropriate version for your database (possibly 1.7 or 1.3.1).', 16, 127, N'UNKNOWN')
      WITH NOWAIT;
    RETURN;
  END

IF COL_LENGTH(N'[dbo].[__MigrationLog]', N'sequence_no') IS NULL
  BEGIN
    RAISERROR (N'The SQL Change Automation [dbo].[__MigrationLog] table is missing the [sequence_no] column. This may be due to the fact that the <SqlChangeAutomationSchemaVersion/> element in your .sqlproj file contains the wrong version number for your database. Please check earlier versions of your .sqlproj file to determine what is the appropriate version for your database (possibly 1.7 or 1.3.1).', 16, 127, N'UNKNOWN')
      WITH NOWAIT;
    RETURN;
  END

IF (NOT EXISTS (SELECT * FROM sys.objects WHERE [object_id] = OBJECT_ID(N'[dbo].[__MigrationLogCurrent]') AND [type] = 'V'))
  BEGIN
    EXECUTE ('
	CREATE VIEW [dbo].[__MigrationLogCurrent]
			AS
			WITH currentMigration AS
			(
			  SELECT
				 migration_id, script_checksum, script_filename, complete_dt, applied_by, deployed, ROW_NUMBER() OVER(PARTITION BY migration_id ORDER BY sequence_no DESC) AS RowNumber
			  FROM [dbo].[__MigrationLog]
			)
			SELECT  migration_id, script_checksum, script_filename, complete_dt, applied_by, deployed
			FROM currentMigration
			WHERE RowNumber = 1
	');
  END

GO
PRINT '# Setting up __SchemaSnapshot table';
IF (NOT EXISTS (SELECT * FROM sys.objects WHERE [object_id] = OBJECT_ID(N'[dbo].[__SchemaSnapshot]')))
  BEGIN
    CREATE TABLE [dbo].[__SchemaSnapshot] (
      [Snapshot] VARBINARY (MAX),
      [LastUpdateDate] DATETIME2 CONSTRAINT [__SchemaSnapshotDateDefault] DEFAULT SYSDATETIME());
    IF OBJECT_ID(N'sp_addextendedproperty', 'P') IS NOT NULL
      BEGIN
        EXECUTE sp_addextendedproperty N'MS_Description', N'This table is used by SQL Change Automation projects to store a snapshot of the schema at the time of the last deployment. Please do not alter or remove this table from the database.', 'SCHEMA', N'dbo', 'TABLE', N'__SchemaSnapshot', NULL, NULL;
      END
  END

GO
PRINT '# Truncating __SchemaSnapshot';
TRUNCATE TABLE [dbo].[__SchemaSnapshot];

GO
PRINT '# Check if baseline is required';
DECLARE @baselineRequired AS BIT;

SET @baselineRequired = 0;

IF (EXISTS (SELECT * FROM sys.objects AS o WHERE o.is_ms_shipped = 0 AND NOT (o.name LIKE '%__MigrationLog%' OR o.name LIKE '%__SchemaSnapshot%')) AND (SELECT count(*) FROM [dbo].[__MigrationLog]) = 0)
  SET @baselineRequired = 1;

IF @baselineRequired = 1
  IF '$(ForceDeployWithoutBaseline)' != 'True'
    RAISERROR ('A baseline has not been set for this project, however pre-existing objects have been found in this database. Please set a baseline in the Visual Studio Project Settings, or set ForceDeployWithoutBaseline=True to continue deploying without a baseline.', 16, 127);

GO
SET IMPLICIT_TRANSACTIONS, NUMERIC_ROUNDABORT OFF;
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, NOCOUNT, QUOTED_IDENTIFIER ON;

GO
IF DB_NAME() != '$(DatabaseName)'
  USE [$(DatabaseName)];

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('37d01100-75dd-407d-801c-ed9ecdb40e67' AS UNIQUEIDENTIFIER))
  PRINT '

***** EXECUTING MIGRATION "Migrations\001_20190702-1441_PC.sql", ID: {37d01100-75dd-407d-801c-ed9ecdb40e67} *****';

GO
IF EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('37d01100-75dd-407d-801c-ed9ecdb40e67' AS UNIQUEIDENTIFIER))
BEGIN
  PRINT '----- Skipping "Migrations\001_20190702-1441_PC.sql", ID: {37d01100-75dd-407d-801c-ed9ecdb40e67} as it has already been run on this database';
  SET NOEXEC ON;
END

GO
EXECUTE ('
PRINT N''Creating schemas''
');

GO
EXECUTE ('CREATE SCHEMA [AP]
AUTHORIZATION [dbo]
');

GO
EXECUTE ('CREATE SCHEMA [APPS]
AUTHORIZATION [dbo]
');

GO
EXECUTE ('CREATE SCHEMA [APPSYS]
AUTHORIZATION [dbo]
');

GO
EXECUTE ('CREATE SCHEMA [AR]
AUTHORIZATION [dbo]
');

GO
EXECUTE ('CREATE SCHEMA [HR]
AUTHORIZATION [dbo]
');

GO
EXECUTE ('CREATE SCHEMA [INV]
AUTHORIZATION [dbo]
');

GO
EXECUTE ('PRINT N''Creating [APPS].[SetOfBook]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[SetOfBook]
(
[Id] [uniqueidentifier] NOT NULL,
[Code] [char] (2) NOT NULL,
[ShortCode] [nvarchar] (50) NOT NULL,
[Name] [nvarchar] (500) NOT NULL,
[BusinessGroupId] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1)
)
');

GO
EXECUTE ('PRINT N''Creating index [CX_SetofBook] on [APPS].[SetOfBook]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_SetofBook] ON [APPS].[SetOfBook] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_SetofBook] on [APPS].[SetOfBook]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[SetOfBook] ADD CONSTRAINT [PK_SetofBook] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Adding constraints to [APPS].[SetOfBook]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[SetOfBook] ADD CONSTRAINT [IX_Code_SetOfBook] UNIQUE NONCLUSTERED  ([Code], [BusinessGroupId])
');

GO
EXECUTE ('PRINT N''Creating [APPS].[AccountType]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[AccountType]
(
[Id] [uniqueidentifier] NOT NULL,
[SetOfBookId] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL,
[Disable] [bigint] NOT NULL,
[Code] [nvarchar] (50) NOT NULL,
[Name] [nvarchar] (500) NOT NULL,
[Description] [nvarchar] (500) NULL
)
');

GO
EXECUTE ('PRINT N''Creating index [CX_AccountType] on [APPS].[AccountType]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_AccountType] ON [APPS].[AccountType] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_AccountType] on [APPS].[AccountType]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[AccountType] ADD CONSTRAINT [PK_AccountType] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Creating [APPS].[Division]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[Division]
(
[Id] [uniqueidentifier] NOT NULL,
[LegalEntityId] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Disable] [bit] NOT NULL,
[Code] [nchar] (3) NOT NULL,
[ShortCode] [nvarchar] (50) NOT NULL,
[Name] [nvarchar] (50) NOT NULL
)
');

GO
EXECUTE ('PRINT N''Creating index [CX_Division] on [APPS].[Division]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_Division] ON [APPS].[Division] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_Division] on [APPS].[Division]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Division] ADD CONSTRAINT [PK_Division] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Adding constraints to [APPS].[Division]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Division] ADD CONSTRAINT [IX_Code_Division] UNIQUE NONCLUSTERED  ([Code], [LegalEntityId])
');

GO
EXECUTE ('PRINT N''Creating [APPS].[AssetOrganization]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[AssetOrganization]
(
[Id] [uniqueidentifier] NOT NULL,
[Code] [nchar] (4) NOT NULL,
[ShortCode] [nvarchar] (10) NOT NULL,
[Name] [nvarchar] (500) NOT NULL,
[DivisionId] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Disable] [bit] NOT NULL
)
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_AssetOrganization] on [APPS].[AssetOrganization]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[AssetOrganization] ADD CONSTRAINT [PK_AssetOrganization] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Adding constraints to [APPS].[AssetOrganization]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[AssetOrganization] ADD CONSTRAINT [IX_Code_AssetOrganization] UNIQUE NONCLUSTERED  ([Code], [DivisionId])
');

GO
EXECUTE ('PRINT N''Creating [APPSYS].[User]''
');

GO
EXECUTE ('CREATE TABLE [APPSYS].[User]
(
[Id] [uniqueidentifier] NOT NULL,
[Username] [nvarchar] (50) NOT NULL,
[Password] [nvarchar] (50) NOT NULL,
[EmployeeId] [uniqueidentifier] NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[IsSysUser] [bit] NOT NULL,
[IsActive] [bit] NOT NULL,
[Salt] [nvarchar] (50) NULL
)
');

GO
EXECUTE ('PRINT N''Creating index [CX_User] on [APPSYS].[User]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_User] ON [APPSYS].[User] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_User] on [APPSYS].[User]''
');

GO
EXECUTE ('ALTER TABLE [APPSYS].[User] ADD CONSTRAINT [PK_User] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Creating [APPSYS].[AuditLog]''
');

GO
EXECUTE ('CREATE TABLE [APPSYS].[AuditLog]
(
[Id] [uniqueidentifier] NOT NULL,
[UserId] [uniqueidentifier] NOT NULL,
[ClassName] [nvarchar] (500) NOT NULL,
[MethodName] [nvarchar] (500) NOT NULL,
[OldData] [ntext] NULL,
[NewData] [ntext] NOT NULL,
[Time] [datetime] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1)
)
');

GO
EXECUTE ('PRINT N''Creating index [CX_AuditLog] on [APPSYS].[AuditLog]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_AuditLog] ON [APPSYS].[AuditLog] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_AuditLog] on [APPSYS].[AuditLog]''
');

GO
EXECUTE ('ALTER TABLE [APPSYS].[AuditLog] ADD CONSTRAINT [PK_AuditLog] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Creating [APPS].[BusinessGroup]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[BusinessGroup]
(
[Id] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Disable] [bit] NOT NULL,
[Code] [char] (2) NOT NULL,
[ShortCode] [nvarchar] (10) NOT NULL,
[Name] [nvarchar] (500) NOT NULL
)
');

GO
EXECUTE ('PRINT N''Creating index [CX_BusinessGroup] on [APPS].[BusinessGroup]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_BusinessGroup] ON [APPS].[BusinessGroup] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_BusinessGroup] on [APPS].[BusinessGroup]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[BusinessGroup] ADD CONSTRAINT [PK_BusinessGroup] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Adding constraints to [APPS].[BusinessGroup]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[BusinessGroup] ADD CONSTRAINT [IX_Code_BusinessGroup] UNIQUE NONCLUSTERED  ([Code])
');

GO
EXECUTE ('PRINT N''Creating [APPS].[Bank]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[Bank]
(
[Id] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Disable] [bit] NOT NULL,
[Code] [nvarchar] (50) NOT NULL,
[Name] [nvarchar] (500) NOT NULL,
[BusinessGroupId] [uniqueidentifier] NOT NULL
)
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_Bank] on [APPS].[Bank]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Bank] ADD CONSTRAINT [PK_Bank] PRIMARY KEY CLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Creating [APPS].[ChartOfAccount]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[ChartOfAccount]
(
[Id] [uniqueidentifier] NOT NULL,
[SetOfBookId] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Disable] [bit] NOT NULL,
[AccountCode] [nvarchar] (500) NOT NULL,
[AliasCode] [nvarchar] (500) NULL,
[AccountName] [nvarchar] (1000) NOT NULL,
[AccountDescription] [nvarchar] (2000) NULL,
[AccountType] [uniqueidentifier] NOT NULL
)
');

GO
EXECUTE ('PRINT N''Creating index [CX_ChartOfAccount] on [APPS].[ChartOfAccount]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_ChartOfAccount] ON [APPS].[ChartOfAccount] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_ChartOfAccount] on [APPS].[ChartOfAccount]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[ChartOfAccount] ADD CONSTRAINT [PK_ChartOfAccount] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Creating [APPS].[CustomerHeader]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[CustomerHeader]
(
[Id] [uniqueidentifier] NOT NULL,
[BusinessGroupId] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Disable] [bit] NOT NULL,
[Name] [nvarchar] (50) NOT NULL
)
');

GO
EXECUTE ('PRINT N''Creating index [CX_CustomerHeader] on [APPS].[CustomerHeader]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_CustomerHeader] ON [APPS].[CustomerHeader] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_CustomerHeader] on [APPS].[CustomerHeader]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[CustomerHeader] ADD CONSTRAINT [PK_CustomerHeader] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Adding constraints to [APPS].[CustomerHeader]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[CustomerHeader] ADD CONSTRAINT [IX_Name_CustomerHeader] UNIQUE NONCLUSTERED  ([Name])
');

GO
EXECUTE ('PRINT N''Creating [APPS].[HROrganization]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[HROrganization]
(
[Id] [uniqueidentifier] NOT NULL,
[Code] [nchar] (4) NOT NULL,
[ShortCode] [nvarchar] (10) NOT NULL,
[Name] [nvarchar] (500) NOT NULL,
[DivisionId] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Disable] [bit] NOT NULL
)
');

GO
EXECUTE ('PRINT N''Creating index [CX_Department] on [APPS].[HROrganization]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_Department] ON [APPS].[HROrganization] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_Department] on [APPS].[HROrganization]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[HROrganization] ADD CONSTRAINT [PK_Department] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Adding constraints to [APPS].[HROrganization]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[HROrganization] ADD CONSTRAINT [IX_Code_Department] UNIQUE NONCLUSTERED  ([Code], [DivisionId])
');

GO
EXECUTE ('PRINT N''Creating [APPS].[DescriptiveFledField]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[DescriptiveFledField]
(
[Id] [uniqueidentifier] NOT NULL,
[Code] [nvarchar] (50) NULL,
[Name] [nvarchar] (50) NULL,
[Description] [nvarchar] (50) NULL,
[BusinessGroupId] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Disable] [bit] NOT NULL
)
');

GO
EXECUTE ('PRINT N''Creating index [CX_DescriptiveFledField] on [APPS].[DescriptiveFledField]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_DescriptiveFledField] ON [APPS].[DescriptiveFledField] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_DescriptiveFledField] on [APPS].[DescriptiveFledField]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[DescriptiveFledField] ADD CONSTRAINT [PK_DescriptiveFledField] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Creating [APPS].[LegalEntity]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[LegalEntity]
(
[Id] [uniqueidentifier] NOT NULL,
[SetOfBookId] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Disable] [bit] NOT NULL,
[Code] [char] (2) NULL,
[ShortCode] [nchar] (10) NULL,
[Name] [nvarchar] (500) NULL
)
');

GO
EXECUTE ('PRINT N''Creating index [CX_LegalEntity] on [APPS].[LegalEntity]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_LegalEntity] ON [APPS].[LegalEntity] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_LegalEntity] on [APPS].[LegalEntity]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[LegalEntity] ADD CONSTRAINT [PK_LegalEntity] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Adding constraints to [APPS].[LegalEntity]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[LegalEntity] ADD CONSTRAINT [IX_Code_LegalEntity] UNIQUE NONCLUSTERED  ([Code], [SetOfBookId])
');

GO
EXECUTE ('PRINT N''Creating [HR].[Employee]''
');

GO
EXECUTE ('CREATE TABLE [HR].[Employee]
(
[Id] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Code] [nvarchar] (50) NOT NULL,
[DisplayName] [nvarchar] (200) NULL,
[PrimaryEmail] [nvarchar] (500) NULL,
[AlternativeEmail] [nvarchar] (500) NULL,
[DepartmentId] [uniqueidentifier] NOT NULL,
[JobTitleId] [uniqueidentifier] NOT NULL,
[JobLevelId] [uniqueidentifier] NOT NULL,
[JoinDate] [date] NOT NULL,
[EffectiveDate] [date] NULL,
[EndDate] [date] NULL,
[Status] [int] NOT NULL
)
');

GO
EXECUTE ('PRINT N''Creating index [CX_Employee] on [HR].[Employee]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_Employee] ON [HR].[Employee] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_Employee] on [HR].[Employee]''
');

GO
EXECUTE ('ALTER TABLE [HR].[Employee] ADD CONSTRAINT [PK_Employee] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Creating [HR].[JobLevel]''
');

GO
EXECUTE ('CREATE TABLE [HR].[JobLevel]
(
[Id] [uniqueidentifier] NOT NULL,
[BusinessGroupId] [uniqueidentifier] NOT NULL,
[Level] [float] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1)
)
');

GO
EXECUTE ('PRINT N''Creating index [CX_JobLevel] on [HR].[JobLevel]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_JobLevel] ON [HR].[JobLevel] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_JobLevel] on [HR].[JobLevel]''
');

GO
EXECUTE ('ALTER TABLE [HR].[JobLevel] ADD CONSTRAINT [PK_JobLevel] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Creating [HR].[JobTitle]''
');

GO
EXECUTE ('CREATE TABLE [HR].[JobTitle]
(
[Id] [uniqueidentifier] NOT NULL,
[BusinessGroupId] [uniqueidentifier] NOT NULL,
[Code] [nvarchar] (50) NULL,
[Name] [nvarchar] (500) NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1)
)
');

GO
EXECUTE ('PRINT N''Creating index [CX_JobTitle] on [HR].[JobTitle]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_JobTitle] ON [HR].[JobTitle] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_JobTitle] on [HR].[JobTitle]''
');

GO
EXECUTE ('ALTER TABLE [HR].[JobTitle] ADD CONSTRAINT [PK_JobTitle] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Creating [HR].[EmployeeGroup]''
');

GO
EXECUTE ('CREATE TABLE [HR].[EmployeeGroup]
(
[EmployeeId] [uniqueidentifier] NOT NULL,
[GroupId] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL
)
');

GO
EXECUTE ('PRINT N''Creating index [CX_UserGroup] on [HR].[EmployeeGroup]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_UserGroup] ON [HR].[EmployeeGroup] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_UserGroup] on [HR].[EmployeeGroup]''
');

GO
EXECUTE ('ALTER TABLE [HR].[EmployeeGroup] ADD CONSTRAINT [PK_UserGroup] PRIMARY KEY NONCLUSTERED  ([EmployeeId], [GroupId])
');

GO
EXECUTE ('PRINT N''Creating [HR].[Group]''
');

GO
EXECUTE ('CREATE TABLE [HR].[Group]
(
[Id] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[OrganizationId] [uniqueidentifier] NOT NULL,
[Name] [nvarchar] (500) NOT NULL
)
');

GO
EXECUTE ('PRINT N''Creating index [CX_Group] on [HR].[Group]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_Group] ON [HR].[Group] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_Group] on [HR].[Group]''
');

GO
EXECUTE ('ALTER TABLE [HR].[Group] ADD CONSTRAINT [PK_Group] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Creating [APPS].[FiscalCalendar]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[FiscalCalendar]
(
[Id] [uniqueidentifier] NOT NULL,
[SetOfBookId] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Year] [int] NOT NULL,
[StartDate] [datetime] NOT NULL,
[EndDate] [datetime] NOT NULL
)
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_FiscalCalendar] on [APPS].[FiscalCalendar]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[FiscalCalendar] ADD CONSTRAINT [PK_FiscalCalendar] PRIMARY KEY CLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Creating [APPS].[Currency]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[Currency]
(
[Id] [uniqueidentifier] NOT NULL,
[SetOfBookId] [uniqueidentifier] NOT NULL,
[Code] [nvarchar] (3) NULL,
[Name] [nvarchar] (500) NULL,
[IsMain] [bit] NOT NULL,
[Disable] [bit] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1)
)
');

GO
EXECUTE ('PRINT N''Creating index [CX_FunctionalCurrency] on [APPS].[Currency]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_FunctionalCurrency] ON [APPS].[Currency] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_FunctionalCurrency] on [APPS].[Currency]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Currency] ADD CONSTRAINT [PK_FunctionalCurrency] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Creating index [IX_Code_Currency] on [APPS].[Currency]''
');

GO
EXECUTE ('CREATE UNIQUE NONCLUSTERED INDEX [IX_Code_Currency] ON [APPS].[Currency] ([Code])
');

GO
EXECUTE ('PRINT N''Creating [APPS].[InventoryOrganization]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[InventoryOrganization]
(
[Id] [uniqueidentifier] NOT NULL,
[Code] [nchar] (4) NOT NULL,
[ShortCode] [nvarchar] (10) NOT NULL,
[Name] [nvarchar] (500) NOT NULL,
[DivisionId] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Disable] [bit] NOT NULL
)
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_InventoryOrganization] on [APPS].[InventoryOrganization]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[InventoryOrganization] ADD CONSTRAINT [PK_InventoryOrganization] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Adding constraints to [APPS].[InventoryOrganization]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[InventoryOrganization] ADD CONSTRAINT [IX_Code_InventoryOrganization] UNIQUE NONCLUSTERED  ([Code], [DivisionId])
');

GO
EXECUTE ('PRINT N''Creating [HR].[JobHistory]''
');

GO
EXECUTE ('CREATE TABLE [HR].[JobHistory]
(
[Id] [uniqueidentifier] NOT NULL,
[EmployeeId] [uniqueidentifier] NOT NULL,
[DepartmentId] [uniqueidentifier] NOT NULL,
[StartDate] [date] NOT NULL,
[EndDate] [date] NULL,
[Status] [nvarchar] (50) NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1)
)
');

GO
EXECUTE ('PRINT N''Creating index [CX_JobHistory] on [HR].[JobHistory]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_JobHistory] ON [HR].[JobHistory] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_JobHistory] on [HR].[JobHistory]''
');

GO
EXECUTE ('ALTER TABLE [HR].[JobHistory] ADD CONSTRAINT [PK_JobHistory] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Creating [APPS].[KeyFlexField]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[KeyFlexField]
(
[Id] [uniqueidentifier] NOT NULL,
[Code] [nvarchar] (50) NOT NULL,
[Name] [nvarchar] (500) NOT NULL,
[Description] [nvarchar] (500) NULL,
[BusinessGroupId] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Disable] [bit] NOT NULL
)
');

GO
EXECUTE ('PRINT N''Creating index [CX_KeyFlexField] on [APPS].[KeyFlexField]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_KeyFlexField] ON [APPS].[KeyFlexField] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_KeyFlexField] on [APPS].[KeyFlexField]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[KeyFlexField] ADD CONSTRAINT [PK_KeyFlexField] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Creating [APPSYS].[Notification]''
');

GO
EXECUTE ('CREATE TABLE [APPSYS].[Notification]
(
[Id] [uniqueidentifier] NOT NULL,
[Time] [datetime] NOT NULL,
[CX] [bigint] NOT NULL,
[Status] [int] NOT NULL,
[UserId] [uniqueidentifier] NOT NULL,
[Content] [ntext] NOT NULL
)
');

GO
EXECUTE ('PRINT N''Creating index [CX_Notification] on [APPSYS].[Notification]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_Notification] ON [APPSYS].[Notification] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_Notification] on [APPSYS].[Notification]''
');

GO
EXECUTE ('ALTER TABLE [APPSYS].[Notification] ADD CONSTRAINT [PK_Notification] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Creating [APPSYS].[Feature]''
');

GO
EXECUTE ('CREATE TABLE [APPSYS].[Feature]
(
[Id] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Name] [nvarchar] (500) NOT NULL,
[Disable] [bit] NOT NULL
)
');

GO
EXECUTE ('PRINT N''Creating index [CX_Feature] on [APPSYS].[Feature]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_Feature] ON [APPSYS].[Feature] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_Feature] on [APPSYS].[Feature]''
');

GO
EXECUTE ('ALTER TABLE [APPSYS].[Feature] ADD CONSTRAINT [PK_Feature] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Creating [APPSYS].[Operation]''
');

GO
EXECUTE ('CREATE TABLE [APPSYS].[Operation]
(
[Id] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Name] [nvarchar] (2000) NOT NULL,
[FeatureId] [uniqueidentifier] NOT NULL,
[Disable] [bit] NOT NULL
)
');

GO
EXECUTE ('PRINT N''Creating index [CX_Operation] on [APPSYS].[Operation]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_Operation] ON [APPSYS].[Operation] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_APPSYS.Operation] on [APPSYS].[Operation]''
');

GO
EXECUTE ('ALTER TABLE [APPSYS].[Operation] ADD CONSTRAINT [PK_APPSYS.Operation] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Creating [APPS].[PaymentMethod]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[PaymentMethod]
(
[Id] [uniqueidentifier] NOT NULL,
[MethodName] [nvarchar] (50) NOT NULL,
[AccountName] [nvarchar] (50) NOT NULL,
[Sequence] [int] NOT NULL,
[CX] [bigint] NOT NULL,
[SetOfBookId] [uniqueidentifier] NOT NULL
)
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_PaymentMethod] on [APPS].[PaymentMethod]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[PaymentMethod] ADD CONSTRAINT [PK_PaymentMethod] PRIMARY KEY CLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Creating [APPS].[PaymentTerm]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[PaymentTerm]
(
[Id] [uniqueidentifier] NOT NULL,
[SetOfBookId] [uniqueidentifier] NOT NULL,
[Name] [nvarchar] (500) NOT NULL,
[Day] [int] NOT NULL,
[Default] [bit] NOT NULL,
[Sequence] [int] NOT NULL,
[Disable] [bit] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1)
)
');

GO
EXECUTE ('PRINT N''Creating index [CX_PaymentTerm] on [APPS].[PaymentTerm]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_PaymentTerm] ON [APPS].[PaymentTerm] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_PaymentTerm] on [APPS].[PaymentTerm]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[PaymentTerm] ADD CONSTRAINT [PK_PaymentTerm] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Creating [APPS].[ProjectOrganization]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[ProjectOrganization]
(
[Id] [uniqueidentifier] NOT NULL,
[Code] [nchar] (4) NOT NULL,
[ShortCode] [nvarchar] (10) NOT NULL,
[Name] [nvarchar] (500) NOT NULL,
[DivisionId] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Disable] [bit] NOT NULL
)
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_ProjectOrganization] on [APPS].[ProjectOrganization]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[ProjectOrganization] ADD CONSTRAINT [PK_ProjectOrganization] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Adding constraints to [APPS].[ProjectOrganization]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[ProjectOrganization] ADD CONSTRAINT [IX_Code_ProjectOrganization] UNIQUE NONCLUSTERED  ([Code], [DivisionId])
');

GO
EXECUTE ('PRINT N''Creating [APPS].[SupplierHeader]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[SupplierHeader]
(
[Id] [uniqueidentifier] NOT NULL,
[BusinessGroupId] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL,
[Disable] [bit] NOT NULL,
[Name] [nvarchar] (50) NOT NULL
)
');

GO
EXECUTE ('PRINT N''Creating index [CX_SupplierHeader] on [APPS].[SupplierHeader]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_SupplierHeader] ON [APPS].[SupplierHeader] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_SupplierHeader] on [APPS].[SupplierHeader]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[SupplierHeader] ADD CONSTRAINT [PK_SupplierHeader] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Creating [APPS].[Tax]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[Tax]
(
[Id] [uniqueidentifier] NOT NULL,
[SetOfBookId] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[TaxCode] [nvarchar] (50) NOT NULL,
[Name] [nvarchar] (500) NOT NULL,
[Description] [nvarchar] (500) NULL,
[Percent] [float] NOT NULL,
[Disable] [bit] NOT NULL
)
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_Tax] on [APPS].[Tax]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Tax] ADD CONSTRAINT [PK_Tax] PRIMARY KEY CLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Creating [APPS].[UnitOfMeasure]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[UnitOfMeasure]
(
[Id] [uniqueidentifier] NOT NULL,
[Name] [nvarchar] (50) NOT NULL,
[AllowedPrecision] [int] NOT NULL,
[Type] [nvarchar] (50) NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[BusinessGroupId] [uniqueidentifier] NULL
)
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_UOM] on [APPS].[UnitOfMeasure]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[UnitOfMeasure] ADD CONSTRAINT [PK_UOM] PRIMARY KEY CLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Creating [APPSYS].[UserProfile]''
');

GO
EXECUTE ('CREATE TABLE [APPSYS].[UserProfile]
(
[Id] [uniqueidentifier] NOT NULL,
[Key] [nvarchar] (200) NOT NULL,
[UserId] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL,
[Value] [ntext] NOT NULL
)
');

GO
EXECUTE ('PRINT N''Creating index [IX_UserProfile] on [APPSYS].[UserProfile]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [IX_UserProfile] ON [APPSYS].[UserProfile] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_UserProfile] on [APPSYS].[UserProfile]''
');

GO
EXECUTE ('ALTER TABLE [APPSYS].[UserProfile] ADD CONSTRAINT [PK_UserProfile] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Creating [APPSYS].[SystemConfiguration]''
');

GO
EXECUTE ('CREATE TABLE [APPSYS].[SystemConfiguration]
(
[Key] [nvarchar] (50) NOT NULL,
[Value] [nvarchar] (2000) NOT NULL
)
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_SystemConfiguration] on [APPSYS].[SystemConfiguration]''
');

GO
EXECUTE ('ALTER TABLE [APPSYS].[SystemConfiguration] ADD CONSTRAINT [PK_SystemConfiguration] PRIMARY KEY CLUSTERED  ([Key])
');

GO
EXECUTE ('PRINT N''Creating [APPS].[CostCenter]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[CostCenter]
(
[Id] [uniqueidentifier] NOT NULL,
[Code] [nvarchar] (500) NOT NULL,
[Name] [nvarchar] (500) NULL,
[ParentId] [uniqueidentifier] NOT NULL,
[Disable] [bit] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[ChartOfAccountId] [uniqueidentifier] NOT NULL
)
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_CostCenter] on [APPS].[CostCenter]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[CostCenter] ADD CONSTRAINT [PK_CostCenter] PRIMARY KEY CLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Creating [APPS].[GoodItem]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[GoodItem]
(
[Id] [uniqueidentifier] NOT NULL,
[Code] [nvarchar] (50) NOT NULL,
[Name] [nvarchar] (50) NOT NULL,
[CX] [bigint] NOT NULL,
[Disable] [bit] NOT NULL,
[InventoryOrganizationId] [uniqueidentifier] NOT NULL
)
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_GoodItem] on [APPS].[GoodItem]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[GoodItem] ADD CONSTRAINT [PK_GoodItem] PRIMARY KEY CLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Creating [AP].[SupplierHeaderValue]''
');

GO
EXECUTE ('CREATE TABLE [AP].[SupplierHeaderValue]
(
[Id] [uniqueidentifier] NOT NULL,
[SupplierId] [uniqueidentifier] NOT NULL,
[SupplierHeaderId] [uniqueidentifier] NULL,
[Value] [nvarchar] (500) NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1)
)
');

GO
EXECUTE ('PRINT N''Creating index [CX_SupplierHeaderValue] on [AP].[SupplierHeaderValue]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_SupplierHeaderValue] ON [AP].[SupplierHeaderValue] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_SupplierHeaderValue] on [AP].[SupplierHeaderValue]''
');

GO
EXECUTE ('ALTER TABLE [AP].[SupplierHeaderValue] ADD CONSTRAINT [PK_SupplierHeaderValue] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Creating [AP].[SupplierSite]''
');

GO
EXECUTE ('CREATE TABLE [AP].[SupplierSite]
(
[Id] [uniqueidentifier] NOT NULL,
[SupplierId] [uniqueidentifier] NOT NULL,
[DivisionId] [uniqueidentifier] NOT NULL,
[Code] [nvarchar] (50) NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Disable] [bit] NOT NULL
)
');

GO
EXECUTE ('PRINT N''Creating index [CX_SupplierSite] on [AP].[SupplierSite]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_SupplierSite] ON [AP].[SupplierSite] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_SupplierSite] on [AP].[SupplierSite]''
');

GO
EXECUTE ('ALTER TABLE [AP].[SupplierSite] ADD CONSTRAINT [PK_SupplierSite] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Creating [AP].[Supplier]''
');

GO
EXECUTE ('CREATE TABLE [AP].[Supplier]
(
[Id] [uniqueidentifier] NOT NULL,
[TaxCode] [nvarchar] (50) NULL,
[Name] [nvarchar] (500) NULL,
[BusinessGroupId] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1)
)
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_Supplier] on [AP].[Supplier]''
');

GO
EXECUTE ('ALTER TABLE [AP].[Supplier] ADD CONSTRAINT [PK_Supplier] PRIMARY KEY CLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Creating [AR].[CustomerSite]''
');

GO
EXECUTE ('CREATE TABLE [AR].[CustomerSite]
(
[Id] [uniqueidentifier] NOT NULL,
[CustomerId] [uniqueidentifier] NOT NULL,
[DivisionId] [uniqueidentifier] NOT NULL,
[Code] [nvarchar] (50) NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Disable] [bit] NOT NULL
)
');

GO
EXECUTE ('PRINT N''Creating index [CX_CustomerSite] on [AR].[CustomerSite]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_CustomerSite] ON [AR].[CustomerSite] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_CustomerSite] on [AR].[CustomerSite]''
');

GO
EXECUTE ('ALTER TABLE [AR].[CustomerSite] ADD CONSTRAINT [PK_CustomerSite] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Creating [AR].[Customer]''
');

GO
EXECUTE ('CREATE TABLE [AR].[Customer]
(
[Id] [uniqueidentifier] NOT NULL,
[BusinessGroupId] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL,
[Disable] [bit] NOT NULL,
[Code] [nvarchar] (50) NOT NULL,
[Name] [nvarchar] (500) NOT NULL
)
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_Customer] on [AR].[Customer]''
');

GO
EXECUTE ('ALTER TABLE [AR].[Customer] ADD CONSTRAINT [PK_Customer] PRIMARY KEY CLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Creating [INV].[Bin]''
');

GO
EXECUTE ('CREATE TABLE [INV].[Bin]
(
[Id] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL,
[Disable] [bit] NOT NULL,
[Code] [nvarchar] (50) NOT NULL,
[RackId] [uniqueidentifier] NOT NULL
)
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_Bin] on [INV].[Bin]''
');

GO
EXECUTE ('ALTER TABLE [INV].[Bin] ADD CONSTRAINT [PK_Bin] PRIMARY KEY CLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Creating [INV].[Rack]''
');

GO
EXECUTE ('CREATE TABLE [INV].[Rack]
(
[Id] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL,
[Disable] [bit] NOT NULL,
[Code] [nvarchar] (50) NOT NULL,
[RowId] [uniqueidentifier] NOT NULL
)
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_Rack] on [INV].[Rack]''
');

GO
EXECUTE ('ALTER TABLE [INV].[Rack] ADD CONSTRAINT [PK_Rack] PRIMARY KEY CLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Creating [INV].[Row]''
');

GO
EXECUTE ('CREATE TABLE [INV].[Row]
(
[Id] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL,
[Disable] [bit] NOT NULL,
[Code] [nvarchar] (50) NOT NULL,
[WarehouseId] [uniqueidentifier] NOT NULL
)
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_Row] on [INV].[Row]''
');

GO
EXECUTE ('ALTER TABLE [INV].[Row] ADD CONSTRAINT [PK_Row] PRIMARY KEY CLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Creating [INV].[Warehouse]''
');

GO
EXECUTE ('CREATE TABLE [INV].[Warehouse]
(
[Id] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL,
[Disable] [bit] NOT NULL,
[Code] [nvarchar] (50) NOT NULL,
[Name] [nvarchar] (50) NOT NULL,
[Location] [nvarchar] (500) NOT NULL,
[InventoryOrganizationId] [uniqueidentifier] NOT NULL
)
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_Warehouse] on [INV].[Warehouse]''
');

GO
EXECUTE ('ALTER TABLE [INV].[Warehouse] ADD CONSTRAINT [PK_Warehouse] PRIMARY KEY CLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Creating [dbo].[CustomerGroup]''
');

GO
EXECUTE ('CREATE TABLE [dbo].[CustomerGroup]
(
[Id] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL,
[Disable] [bit] NOT NULL,
[Name] [nvarchar] (500) NOT NULL,
[LegalEntityId] [uniqueidentifier] NOT NULL
)
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_CustomerGroup] on [dbo].[CustomerGroup]''
');

GO
EXECUTE ('ALTER TABLE [dbo].[CustomerGroup] ADD CONSTRAINT [PK_CustomerGroup] PRIMARY KEY CLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Creating [dbo].[Stock]''
');

GO
EXECUTE ('CREATE TABLE [dbo].[Stock]
(
[Id] [uniqueidentifier] NOT NULL,
[GoodItemId] [uniqueidentifier] NOT NULL,
[WarehouseId] [uniqueidentifier] NOT NULL,
[Quantity] [decimal] (18, 4) NOT NULL,
[CX] [bigint] NOT NULL,
[Disable] [bit] NOT NULL
)
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_Stock] on [dbo].[Stock]''
');

GO
EXECUTE ('ALTER TABLE [dbo].[Stock] ADD CONSTRAINT [PK_Stock] PRIMARY KEY CLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Creating [dbo].[SupplierGroup]''
');

GO
EXECUTE ('CREATE TABLE [dbo].[SupplierGroup]
(
[Id] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL,
[Disable] [bit] NOT NULL,
[Name] [nvarchar] (500) NOT NULL,
[LegalEntityId] [uniqueidentifier] NOT NULL
)
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_SupplierGroup] on [dbo].[SupplierGroup]''
');

GO
EXECUTE ('ALTER TABLE [dbo].[SupplierGroup] ADD CONSTRAINT [PK_SupplierGroup] PRIMARY KEY CLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPSYS].[AuditLog]''
');

GO
EXECUTE ('ALTER TABLE [APPSYS].[AuditLog] ADD CONSTRAINT [FK_AuditLog_User] FOREIGN KEY ([UserId]) REFERENCES [APPSYS].[User] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPSYS].[Operation]''
');

GO
EXECUTE ('ALTER TABLE [APPSYS].[Operation] ADD CONSTRAINT [FK_Operation_Feature] FOREIGN KEY ([FeatureId]) REFERENCES [APPSYS].[Feature] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPSYS].[Notification]''
');

GO
EXECUTE ('ALTER TABLE [APPSYS].[Notification] ADD CONSTRAINT [FK_Notification_User] FOREIGN KEY ([UserId]) REFERENCES [APPSYS].[User] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPSYS].[UserProfile]''
');

GO
EXECUTE ('ALTER TABLE [APPSYS].[UserProfile] ADD CONSTRAINT [FK_UserProfile_User] FOREIGN KEY ([UserId]) REFERENCES [APPSYS].[User] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPSYS].[User]''
');

GO
EXECUTE ('ALTER TABLE [APPSYS].[User] ADD CONSTRAINT [FK_User_Employee] FOREIGN KEY ([EmployeeId]) REFERENCES [HR].[Employee] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[AccountType]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[AccountType] ADD CONSTRAINT [FK_AccountType_SetofBook] FOREIGN KEY ([SetOfBookId]) REFERENCES [APPS].[SetOfBook] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[AssetOrganization]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[AssetOrganization] ADD CONSTRAINT [FK_AssetOrganization_Division] FOREIGN KEY ([DivisionId]) REFERENCES [APPS].[Division] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[Bank]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Bank] ADD CONSTRAINT [FK_Bank_BusinessGroup] FOREIGN KEY ([BusinessGroupId]) REFERENCES [APPS].[BusinessGroup] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[CustomerHeader]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[CustomerHeader] ADD CONSTRAINT [FK_CustomerHeader_BusinessGroup] FOREIGN KEY ([BusinessGroupId]) REFERENCES [APPS].[BusinessGroup] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[DescriptiveFledField]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[DescriptiveFledField] ADD CONSTRAINT [FK_DescriptiveFledField_BusinessGroup] FOREIGN KEY ([BusinessGroupId]) REFERENCES [APPS].[BusinessGroup] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [HR].[JobLevel]''
');

GO
EXECUTE ('ALTER TABLE [HR].[JobLevel] ADD CONSTRAINT [FK_JobLevel_BusinessGroup] FOREIGN KEY ([BusinessGroupId]) REFERENCES [APPS].[BusinessGroup] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [HR].[JobTitle]''
');

GO
EXECUTE ('ALTER TABLE [HR].[JobTitle] ADD CONSTRAINT [FK_JobTitle_BusinessGroup] FOREIGN KEY ([BusinessGroupId]) REFERENCES [APPS].[BusinessGroup] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[KeyFlexField]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[KeyFlexField] ADD CONSTRAINT [FK_KeyFlexField_BusinessGroup] FOREIGN KEY ([BusinessGroupId]) REFERENCES [APPS].[BusinessGroup] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[SetOfBook]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[SetOfBook] ADD CONSTRAINT [FK_SetofBook_BusinessGroup] FOREIGN KEY ([BusinessGroupId]) REFERENCES [APPS].[BusinessGroup] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[SupplierHeader]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[SupplierHeader] ADD CONSTRAINT [FK_SupplierHeader_BusinessGroup] FOREIGN KEY ([BusinessGroupId]) REFERENCES [APPS].[BusinessGroup] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[UnitOfMeasure]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[UnitOfMeasure] ADD CONSTRAINT [FK_UnitOfMeasure_BusinessGroup] FOREIGN KEY ([BusinessGroupId]) REFERENCES [APPS].[BusinessGroup] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[ChartOfAccount]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[ChartOfAccount] ADD CONSTRAINT [FK_ChartOfAccount_SetofBook] FOREIGN KEY ([SetOfBookId]) REFERENCES [APPS].[SetOfBook] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[Currency]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Currency] ADD CONSTRAINT [FK_FunctionalCurrency_SetofBook] FOREIGN KEY ([SetOfBookId]) REFERENCES [APPS].[SetOfBook] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[HROrganization]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[HROrganization] ADD CONSTRAINT [FK_Department_Division] FOREIGN KEY ([DivisionId]) REFERENCES [APPS].[Division] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[InventoryOrganization]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[InventoryOrganization] ADD CONSTRAINT [FK_InventoryOrganization_Division] FOREIGN KEY ([DivisionId]) REFERENCES [APPS].[Division] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[ProjectOrganization]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[ProjectOrganization] ADD CONSTRAINT [FK_ProjectOrganization_Division] FOREIGN KEY ([DivisionId]) REFERENCES [APPS].[Division] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[Division]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Division] ADD CONSTRAINT [FK_Division_LegalEntity] FOREIGN KEY ([LegalEntityId]) REFERENCES [APPS].[LegalEntity] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[FiscalCalendar]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[FiscalCalendar] ADD CONSTRAINT [FK_FiscalCalendar_SetofBook] FOREIGN KEY ([SetOfBookId]) REFERENCES [APPS].[SetOfBook] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [HR].[Employee]''
');

GO
EXECUTE ('ALTER TABLE [HR].[Employee] ADD CONSTRAINT [FK_Employee_Department] FOREIGN KEY ([DepartmentId]) REFERENCES [APPS].[HROrganization] ([Id])
');

GO
EXECUTE ('ALTER TABLE [HR].[Employee] ADD CONSTRAINT [FK_Employee_JobTitle] FOREIGN KEY ([JobTitleId]) REFERENCES [HR].[JobTitle] ([Id])
');

GO
EXECUTE ('ALTER TABLE [HR].[Employee] ADD CONSTRAINT [FK_Employee_JobLevel] FOREIGN KEY ([JobLevelId]) REFERENCES [HR].[JobLevel] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [HR].[JobHistory]''
');

GO
EXECUTE ('ALTER TABLE [HR].[JobHistory] ADD CONSTRAINT [FK_JobHistory_Department] FOREIGN KEY ([DepartmentId]) REFERENCES [APPS].[HROrganization] ([Id])
');

GO
EXECUTE ('ALTER TABLE [HR].[JobHistory] ADD CONSTRAINT [FK_JobHistory_Employee] FOREIGN KEY ([EmployeeId]) REFERENCES [HR].[Employee] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[LegalEntity]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[LegalEntity] ADD CONSTRAINT [FK_LegalEntity_SetofBook] FOREIGN KEY ([SetOfBookId]) REFERENCES [APPS].[SetOfBook] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[PaymentMethod]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[PaymentMethod] ADD CONSTRAINT [FK_PaymentMethod_SetofBook] FOREIGN KEY ([SetOfBookId]) REFERENCES [APPS].[SetOfBook] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[PaymentTerm]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[PaymentTerm] ADD CONSTRAINT [FK_PaymentTerm_SetofBook] FOREIGN KEY ([SetOfBookId]) REFERENCES [APPS].[SetOfBook] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[Tax]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Tax] ADD CONSTRAINT [FK_Tax_SetofBook1] FOREIGN KEY ([SetOfBookId]) REFERENCES [APPS].[SetOfBook] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [HR].[EmployeeGroup]''
');

GO
EXECUTE ('ALTER TABLE [HR].[EmployeeGroup] ADD CONSTRAINT [FK_EmployeeGroup_Employee] FOREIGN KEY ([EmployeeId]) REFERENCES [HR].[Employee] ([Id])
');

GO
EXECUTE ('ALTER TABLE [HR].[EmployeeGroup] ADD CONSTRAINT [FK_EmployeeGroup_Group] FOREIGN KEY ([GroupId]) REFERENCES [HR].[Group] ([Id])
');

GO
SET NOEXEC OFF;

GO
IF N'$(IsSqlCmdEnabled)' <> N'True'
  SET NOEXEC ON;

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('37d01100-75dd-407d-801c-ed9ecdb40e67' AS UNIQUEIDENTIFIER))
  PRINT '***** FINISHED EXECUTING MIGRATION "Migrations\001_20190702-1441_PC.sql", ID: {37d01100-75dd-407d-801c-ed9ecdb40e67} *****
';

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('37d01100-75dd-407d-801c-ed9ecdb40e67' AS UNIQUEIDENTIFIER))
  INSERT [$(DatabaseName)].[dbo].[__MigrationLog] ([migration_id], [script_checksum], [script_filename], [complete_dt], [applied_by], [deployed], [version], [package_version], [release_version])
  VALUES                                         (CAST ('37d01100-75dd-407d-801c-ed9ecdb40e67' AS UNIQUEIDENTIFIER), 'ACFB1FCF9D494C17C4A472ED305D52EB83958111C1CCBE24C4AC1437AF3EA9D8', 'Migrations\001_20190702-1441_PC.sql', SYSDATETIME(), SYSTEM_USER, 1, NULL, '$(PackageVersion)', CASE '$(ReleaseVersion)' WHEN '' THEN NULL ELSE '$(ReleaseVersion)' END);

GO
SET IMPLICIT_TRANSACTIONS, NUMERIC_ROUNDABORT OFF;
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, NOCOUNT, QUOTED_IDENTIFIER ON;

GO
IF DB_NAME() != '$(DatabaseName)'
  USE [$(DatabaseName)];

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('eefcf28f-5a84-42bc-b73e-dd39cb41cb59' AS UNIQUEIDENTIFIER))
  PRINT '

***** EXECUTING MIGRATION "Migrations\002_20190702-1524_PC.sql", ID: {eefcf28f-5a84-42bc-b73e-dd39cb41cb59} *****';

GO
IF EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('eefcf28f-5a84-42bc-b73e-dd39cb41cb59' AS UNIQUEIDENTIFIER))
BEGIN
  PRINT '----- Skipping "Migrations\002_20190702-1524_PC.sql", ID: {eefcf28f-5a84-42bc-b73e-dd39cb41cb59} as it has already been run on this database';
  SET NOEXEC ON;
END

GO
EXECUTE ('
PRINT N''Dropping foreign keys from [APPS].[AccountType]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[AccountType] DROP CONSTRAINT [FK_AccountType_SetofBook]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [APPS].[AccountType]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[AccountType] DROP CONSTRAINT [PK_AccountType]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [APPS].[Bank]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Bank] DROP CONSTRAINT [PK_Bank]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [AP].[Supplier]''
');

GO
EXECUTE ('ALTER TABLE [AP].[Supplier] DROP CONSTRAINT [PK_Supplier]
');

GO
EXECUTE ('PRINT N''Dropping index [CX_AccountType] from [APPS].[AccountType]''
');

GO
EXECUTE ('DROP INDEX [CX_AccountType] ON [APPS].[AccountType]
');

GO
EXECUTE ('PRINT N''Dropping [APPS].[AccountType]''
');

GO
EXECUTE ('DROP TABLE [APPS].[AccountType]
');

GO
EXECUTE ('PRINT N''Creating [APPS].[BankAccount]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[BankAccount]
(
[Id] [uniqueidentifier] NOT NULL,
[BankId] [uniqueidentifier] NOT NULL,
[SetOfBookId] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL,
[Disable] [bit] NOT NULL
)
');

GO
EXECUTE ('PRINT N''Creating index [CX_BankAccount] on [APPS].[BankAccount]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_BankAccount] ON [APPS].[BankAccount] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_BankAccount] on [APPS].[BankAccount]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[BankAccount] ADD CONSTRAINT [PK_BankAccount] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Creating index [CX_Bank] on [APPS].[Bank]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_Bank] ON [APPS].[Bank] ([CX])
');

GO
EXECUTE ('PRINT N''Creating index [CX_Supplier] on [AP].[Supplier]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_Supplier] ON [AP].[Supplier] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_Bank] on [APPS].[Bank]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Bank] ADD CONSTRAINT [PK_Bank] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_Supplier] on [AP].[Supplier]''
');

GO
EXECUTE ('ALTER TABLE [AP].[Supplier] ADD CONSTRAINT [PK_Supplier] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
SET NOEXEC OFF;

GO
IF N'$(IsSqlCmdEnabled)' <> N'True'
  SET NOEXEC ON;

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('eefcf28f-5a84-42bc-b73e-dd39cb41cb59' AS UNIQUEIDENTIFIER))
  PRINT '***** FINISHED EXECUTING MIGRATION "Migrations\002_20190702-1524_PC.sql", ID: {eefcf28f-5a84-42bc-b73e-dd39cb41cb59} *****
';

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('eefcf28f-5a84-42bc-b73e-dd39cb41cb59' AS UNIQUEIDENTIFIER))
  INSERT [$(DatabaseName)].[dbo].[__MigrationLog] ([migration_id], [script_checksum], [script_filename], [complete_dt], [applied_by], [deployed], [version], [package_version], [release_version])
  VALUES                                         (CAST ('eefcf28f-5a84-42bc-b73e-dd39cb41cb59' AS UNIQUEIDENTIFIER), 'B96D36BE3793AB2AACEC5389F03FA02F3588C642D3DBB8C825F9CDD41A5BE54B', 'Migrations\002_20190702-1524_PC.sql', SYSDATETIME(), SYSTEM_USER, 1, NULL, '$(PackageVersion)', CASE '$(ReleaseVersion)' WHEN '' THEN NULL ELSE '$(ReleaseVersion)' END);

GO
SET IMPLICIT_TRANSACTIONS, NUMERIC_ROUNDABORT OFF;
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, NOCOUNT, QUOTED_IDENTIFIER ON;

GO
IF DB_NAME() != '$(DatabaseName)'
  USE [$(DatabaseName)];

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('a2ab3973-7c4e-4681-8a86-a803cffdf83e' AS UNIQUEIDENTIFIER))
  PRINT '

***** EXECUTING MIGRATION "Migrations\003_20190702-1639_PC.sql", ID: {a2ab3973-7c4e-4681-8a86-a803cffdf83e} *****';

GO
IF EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('a2ab3973-7c4e-4681-8a86-a803cffdf83e' AS UNIQUEIDENTIFIER))
BEGIN
  PRINT '----- Skipping "Migrations\003_20190702-1639_PC.sql", ID: {a2ab3973-7c4e-4681-8a86-a803cffdf83e} as it has already been run on this database';
  SET NOEXEC ON;
END

GO
EXECUTE ('
PRINT N''Dropping constraints from [INV].[Bin]''
');

GO
EXECUTE ('ALTER TABLE [INV].[Bin] DROP CONSTRAINT [PK_Bin]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [INV].[Rack]''
');

GO
EXECUTE ('ALTER TABLE [INV].[Rack] DROP CONSTRAINT [PK_Rack]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [INV].[Row]''
');

GO
EXECUTE ('ALTER TABLE [INV].[Row] DROP CONSTRAINT [PK_Row]
');

GO
EXECUTE ('PRINT N''Dropping [INV].[Row]''
');

GO
EXECUTE ('DROP TABLE [INV].[Row]
');

GO
EXECUTE ('PRINT N''Dropping [INV].[Rack]''
');

GO
EXECUTE ('DROP TABLE [INV].[Rack]
');

GO
EXECUTE ('PRINT N''Dropping [INV].[Bin]''
');

GO
EXECUTE ('DROP TABLE [INV].[Bin]
');

GO
EXECUTE ('PRINT N''Creating [INV].[BinLocation]''
');

GO
EXECUTE ('CREATE TABLE [INV].[BinLocation]
(
[Id] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL,
[Disable] [bit] NOT NULL,
[Row] [nvarchar] (500) NOT NULL,
[Rack] [nvarchar] (500) NULL,
[Bin] [nvarchar] (500) NULL,
[WarehouseId] [uniqueidentifier] NOT NULL
)
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_Bin] on [INV].[BinLocation]''
');

GO
EXECUTE ('ALTER TABLE [INV].[BinLocation] ADD CONSTRAINT [PK_Bin] PRIMARY KEY CLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [INV].[BinLocation]''
');

GO
EXECUTE ('ALTER TABLE [INV].[BinLocation] ADD CONSTRAINT [FK_BinLocation_Warehouse] FOREIGN KEY ([WarehouseId]) REFERENCES [INV].[Warehouse] ([Id])
');

GO
SET NOEXEC OFF;

GO
IF N'$(IsSqlCmdEnabled)' <> N'True'
  SET NOEXEC ON;

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('a2ab3973-7c4e-4681-8a86-a803cffdf83e' AS UNIQUEIDENTIFIER))
  PRINT '***** FINISHED EXECUTING MIGRATION "Migrations\003_20190702-1639_PC.sql", ID: {a2ab3973-7c4e-4681-8a86-a803cffdf83e} *****
';

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('a2ab3973-7c4e-4681-8a86-a803cffdf83e' AS UNIQUEIDENTIFIER))
  INSERT [$(DatabaseName)].[dbo].[__MigrationLog] ([migration_id], [script_checksum], [script_filename], [complete_dt], [applied_by], [deployed], [version], [package_version], [release_version])
  VALUES                                         (CAST ('a2ab3973-7c4e-4681-8a86-a803cffdf83e' AS UNIQUEIDENTIFIER), '34C2440936672AF73C3633EEED2C21AD7ED01E1E1BE6075D299C20DB239D12B4', 'Migrations\003_20190702-1639_PC.sql', SYSDATETIME(), SYSTEM_USER, 1, NULL, '$(PackageVersion)', CASE '$(ReleaseVersion)' WHEN '' THEN NULL ELSE '$(ReleaseVersion)' END);

GO
SET IMPLICIT_TRANSACTIONS, NUMERIC_ROUNDABORT OFF;
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, NOCOUNT, QUOTED_IDENTIFIER ON;

GO
IF DB_NAME() != '$(DatabaseName)'
  USE [$(DatabaseName)];

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('000131e1-16c7-410c-a7d7-0e10598cb302' AS UNIQUEIDENTIFIER))
  PRINT '

***** EXECUTING MIGRATION "Migrations\004_20190703-1406_PC.sql", ID: {000131e1-16c7-410c-a7d7-0e10598cb302} *****';

GO
IF EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('000131e1-16c7-410c-a7d7-0e10598cb302' AS UNIQUEIDENTIFIER))
BEGIN
  PRINT '----- Skipping "Migrations\004_20190703-1406_PC.sql", ID: {000131e1-16c7-410c-a7d7-0e10598cb302} as it has already been run on this database';
  SET NOEXEC ON;
END

GO
EXECUTE ('
PRINT N''Dropping foreign keys from [APPS].[Currency]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Currency] DROP CONSTRAINT [FK_FunctionalCurrency_SetofBook]
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [APPS].[DescriptiveFledField]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[DescriptiveFledField] DROP CONSTRAINT [FK_DescriptiveFledField_BusinessGroup]
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [APPS].[PaymentMethod]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[PaymentMethod] DROP CONSTRAINT [FK_PaymentMethod_SetofBook]
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [APPS].[SetOfBook]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[SetOfBook] DROP CONSTRAINT [FK_SetofBook_BusinessGroup]
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [APPS].[ChartOfAccount]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[ChartOfAccount] DROP CONSTRAINT [FK_ChartOfAccount_SetofBook]
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [APPS].[FiscalCalendar]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[FiscalCalendar] DROP CONSTRAINT [FK_FiscalCalendar_SetofBook]
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [APPS].[LegalEntity]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[LegalEntity] DROP CONSTRAINT [FK_LegalEntity_SetofBook]
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [APPS].[PaymentTerm]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[PaymentTerm] DROP CONSTRAINT [FK_PaymentTerm_SetofBook]
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [APPS].[Tax]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Tax] DROP CONSTRAINT [FK_Tax_SetofBook1]
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [APPS].[UnitOfMeasure]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[UnitOfMeasure] DROP CONSTRAINT [FK_UnitOfMeasure_BusinessGroup]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [APPS].[BankAccount]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[BankAccount] DROP CONSTRAINT [PK_BankAccount]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [APPS].[DescriptiveFledField]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[DescriptiveFledField] DROP CONSTRAINT [PK_DescriptiveFledField]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [APPS].[GoodItem]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[GoodItem] DROP CONSTRAINT [PK_GoodItem]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [APPS].[PaymentMethod]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[PaymentMethod] DROP CONSTRAINT [PK_PaymentMethod]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [APPS].[SetOfBook]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[SetOfBook] DROP CONSTRAINT [PK_SetofBook]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [APPS].[SetOfBook]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[SetOfBook] DROP CONSTRAINT [IX_Code_SetOfBook]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [APPS].[UnitOfMeasure]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[UnitOfMeasure] DROP CONSTRAINT [PK_UOM]
');

GO
EXECUTE ('PRINT N''Dropping index [CX_BankAccount] from [APPS].[BankAccount]''
');

GO
EXECUTE ('DROP INDEX [CX_BankAccount] ON [APPS].[BankAccount]
');

GO
EXECUTE ('PRINT N''Dropping index [CX_DescriptiveFledField] from [APPS].[DescriptiveFledField]''
');

GO
EXECUTE ('DROP INDEX [CX_DescriptiveFledField] ON [APPS].[DescriptiveFledField]
');

GO
EXECUTE ('PRINT N''Dropping index [CX_SetofBook] from [APPS].[SetOfBook]''
');

GO
EXECUTE ('DROP INDEX [CX_SetofBook] ON [APPS].[SetOfBook]
');

GO
EXECUTE ('PRINT N''Dropping [APPS].[GoodItem]''
');

GO
EXECUTE ('DROP TABLE [APPS].[GoodItem]
');

GO
EXECUTE ('PRINT N''Dropping [APPS].[DescriptiveFledField]''
');

GO
EXECUTE ('DROP TABLE [APPS].[DescriptiveFledField]
');

GO
EXECUTE ('PRINT N''Rebuilding [APPS].[BankAccount]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[RG_Recovery_1_BankAccount]
(
[Id] [uniqueidentifier] NOT NULL,
[BankId] [uniqueidentifier] NOT NULL,
[SetOfBookId] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL,
[Disable] [bit] NOT NULL,
[No] [nvarchar] (50) NOT NULL,
[Name] [nvarchar] (500) NOT NULL,
[Description] [nvarchar] (500) NULL
)
');

GO
EXECUTE ('INSERT INTO [APPS].[RG_Recovery_1_BankAccount]([Id], [BankId], [SetOfBookId], [CX], [Disable]) SELECT [Id], [BankId], [SetOfBookId], [CX], [Disable] FROM [APPS].[BankAccount]
');

GO
EXECUTE ('DROP TABLE [APPS].[BankAccount]
');

GO
EXECUTE ('EXEC sp_rename N''[APPS].[RG_Recovery_1_BankAccount]'', N''BankAccount'', N''OBJECT''
');

GO
EXECUTE ('PRINT N''Creating index [CX_BankAccount] on [APPS].[BankAccount]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_BankAccount] ON [APPS].[BankAccount] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_BankAccount] on [APPS].[BankAccount]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[BankAccount] ADD CONSTRAINT [PK_BankAccount] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Rebuilding [APPS].[SetOfBook]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[RG_Recovery_2_SetOfBook]
(
[Id] [uniqueidentifier] NOT NULL,
[Code] [char] (2) NOT NULL,
[ShortCode] [nvarchar] (50) NOT NULL,
[Name] [nvarchar] (500) NOT NULL,
[BusinessGroupId] [uniqueidentifier] NOT NULL,
[CurrencyId] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Disable] [bit] NOT NULL
)
');

GO
SET IDENTITY_INSERT [APPS].[RG_Recovery_2_SetOfBook] ON

GO
EXECUTE ('INSERT INTO [APPS].[RG_Recovery_2_SetOfBook]([Id], [Code], [ShortCode], [Name], [BusinessGroupId], [CX]) SELECT [Id], [Code], [ShortCode], [Name], [BusinessGroupId], [CX] FROM [APPS].[SetOfBook]
');

GO
SET IDENTITY_INSERT [APPS].[RG_Recovery_2_SetOfBook] OFF

GO
EXECUTE ('DECLARE @idVal BIGINT
SELECT @idVal = IDENT_CURRENT(N''[APPS].[SetOfBook]'')
IF @idVal IS NOT NULL
    DBCC CHECKIDENT(N''[APPS].[RG_Recovery_2_SetOfBook]'', RESEED, @idVal)
');

GO
EXECUTE ('DROP TABLE [APPS].[SetOfBook]
');

GO
EXECUTE ('EXEC sp_rename N''[APPS].[RG_Recovery_2_SetOfBook]'', N''SetOfBook'', N''OBJECT''
');

GO
EXECUTE ('PRINT N''Creating index [CX_SetofBook] on [APPS].[SetOfBook]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_SetofBook] ON [APPS].[SetOfBook] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_SetofBook] on [APPS].[SetOfBook]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[SetOfBook] ADD CONSTRAINT [PK_SetofBook] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Adding constraints to [APPS].[SetOfBook]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[SetOfBook] ADD CONSTRAINT [IX_Code_SetOfBook] UNIQUE NONCLUSTERED  ([Code], [BusinessGroupId])
');

GO
EXECUTE ('PRINT N''Altering [APPS].[ChartOfAccount]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[ChartOfAccount] DROP
COLUMN [AccountType]
');

GO
EXECUTE ('PRINT N''Altering [APPS].[Currency]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Currency] DROP
COLUMN [IsMain]
');

GO
EXECUTE ('EXEC sp_rename N''[APPS].[Currency].[SetOfBookId]'', N''BusinessGroupId'', N''COLUMN''
');

GO
EXECUTE ('PRINT N''Creating [APPS].[DescriptiveFlexField]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[DescriptiveFlexField]
(
[Id] [uniqueidentifier] NOT NULL,
[Code] [nvarchar] (50) NULL,
[Name] [nvarchar] (50) NULL,
[Description] [nvarchar] (50) NULL,
[BusinessGroupId] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Disable] [bit] NOT NULL
)
');

GO
EXECUTE ('PRINT N''Creating index [CX_DescriptiveFledField] on [APPS].[DescriptiveFlexField]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_DescriptiveFledField] ON [APPS].[DescriptiveFlexField] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_DescriptiveFledField] on [APPS].[DescriptiveFlexField]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[DescriptiveFlexField] ADD CONSTRAINT [PK_DescriptiveFledField] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Creating [APPS].[Item]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[Item]
(
[Id] [uniqueidentifier] NOT NULL,
[Code] [nvarchar] (50) NOT NULL,
[Name] [nvarchar] (50) NOT NULL,
[CX] [bigint] NOT NULL,
[Disable] [bit] NOT NULL,
[BusinessGroupId] [uniqueidentifier] NOT NULL
)
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_GoodItem] on [APPS].[Item]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Item] ADD CONSTRAINT [PK_GoodItem] PRIMARY KEY CLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Rebuilding [APPS].[PaymentMethod]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[RG_Recovery_3_PaymentMethod]
(
[Id] [uniqueidentifier] NOT NULL,
[MethodName] [nvarchar] (50) NOT NULL,
[AccountName] [nvarchar] (50) NOT NULL,
[Sequence] [int] NOT NULL,
[SetOfBookId] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL,
[Disable] [bit] NOT NULL
)
');

GO
EXECUTE ('INSERT INTO [APPS].[RG_Recovery_3_PaymentMethod]([Id], [MethodName], [AccountName], [Sequence], [SetOfBookId], [CX]) SELECT [Id], [MethodName], [AccountName], [Sequence], [SetOfBookId], [CX] FROM [APPS].[PaymentMethod]
');

GO
EXECUTE ('DROP TABLE [APPS].[PaymentMethod]
');

GO
EXECUTE ('EXEC sp_rename N''[APPS].[RG_Recovery_3_PaymentMethod]'', N''PaymentMethod'', N''OBJECT''
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_PaymentMethod] on [APPS].[PaymentMethod]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[PaymentMethod] ADD CONSTRAINT [PK_PaymentMethod] PRIMARY KEY CLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Altering [APPS].[PaymentTerm]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[PaymentTerm] DROP
COLUMN [Default]
');

GO
EXECUTE ('PRINT N''Rebuilding [APPS].[UnitOfMeasure]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[RG_Recovery_4_UnitOfMeasure]
(
[Id] [uniqueidentifier] NOT NULL,
[Name] [nvarchar] (50) NOT NULL,
[AllowedPrecision] [int] NOT NULL,
[Type] [nvarchar] (50) NOT NULL,
[BusinessGroupId] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Disable] [bit] NOT NULL
)
');

GO
SET IDENTITY_INSERT [APPS].[RG_Recovery_4_UnitOfMeasure] ON

GO
EXECUTE ('INSERT INTO [APPS].[RG_Recovery_4_UnitOfMeasure]([Id], [Name], [AllowedPrecision], [Type], [BusinessGroupId], [CX]) SELECT [Id], [Name], [AllowedPrecision], [Type], [BusinessGroupId], [CX] FROM [APPS].[UnitOfMeasure]
');

GO
SET IDENTITY_INSERT [APPS].[RG_Recovery_4_UnitOfMeasure] OFF

GO
EXECUTE ('DECLARE @idVal BIGINT
SELECT @idVal = IDENT_CURRENT(N''[APPS].[UnitOfMeasure]'')
IF @idVal IS NOT NULL
    DBCC CHECKIDENT(N''[APPS].[RG_Recovery_4_UnitOfMeasure]'', RESEED, @idVal)
');

GO
EXECUTE ('DROP TABLE [APPS].[UnitOfMeasure]
');

GO
EXECUTE ('EXEC sp_rename N''[APPS].[RG_Recovery_4_UnitOfMeasure]'', N''UnitOfMeasure'', N''OBJECT''
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_UOM] on [APPS].[UnitOfMeasure]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[UnitOfMeasure] ADD CONSTRAINT [PK_UOM] PRIMARY KEY CLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[BankAccount]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[BankAccount] ADD CONSTRAINT [FK_BankAccount_Bank] FOREIGN KEY ([BankId]) REFERENCES [APPS].[Bank] ([Id])
');

GO
EXECUTE ('ALTER TABLE [APPS].[BankAccount] ADD CONSTRAINT [FK_BankAccount_SetOfBook] FOREIGN KEY ([SetOfBookId]) REFERENCES [APPS].[SetOfBook] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[CostCenter]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[CostCenter] ADD CONSTRAINT [FK_CostCenter_ChartOfAccount] FOREIGN KEY ([ChartOfAccountId]) REFERENCES [APPS].[ChartOfAccount] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[Currency]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Currency] ADD CONSTRAINT [FK_Currency_BusinessGroup] FOREIGN KEY ([BusinessGroupId]) REFERENCES [APPS].[BusinessGroup] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[DescriptiveFlexField]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[DescriptiveFlexField] ADD CONSTRAINT [FK_DescriptiveFledField_BusinessGroup] FOREIGN KEY ([BusinessGroupId]) REFERENCES [APPS].[BusinessGroup] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[Item]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Item] ADD CONSTRAINT [FK_Item_BusinessGroup] FOREIGN KEY ([BusinessGroupId]) REFERENCES [APPS].[BusinessGroup] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[PaymentMethod]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[PaymentMethod] ADD CONSTRAINT [FK_PaymentMethod_SetofBook] FOREIGN KEY ([SetOfBookId]) REFERENCES [APPS].[SetOfBook] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[SetOfBook]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[SetOfBook] ADD CONSTRAINT [FK_SetofBook_BusinessGroup] FOREIGN KEY ([BusinessGroupId]) REFERENCES [APPS].[BusinessGroup] ([Id])
');

GO
EXECUTE ('ALTER TABLE [APPS].[SetOfBook] ADD CONSTRAINT [FK_SetOfBook_Currency] FOREIGN KEY ([CurrencyId]) REFERENCES [APPS].[Currency] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[ChartOfAccount]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[ChartOfAccount] ADD CONSTRAINT [FK_ChartOfAccount_SetofBook] FOREIGN KEY ([SetOfBookId]) REFERENCES [APPS].[SetOfBook] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[PaymentTerm]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[PaymentTerm] ADD CONSTRAINT [FK_PaymentTerm_SetofBook] FOREIGN KEY ([SetOfBookId]) REFERENCES [APPS].[SetOfBook] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[UnitOfMeasure]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[UnitOfMeasure] ADD CONSTRAINT [FK_UnitOfMeasure_BusinessGroup] FOREIGN KEY ([BusinessGroupId]) REFERENCES [APPS].[BusinessGroup] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[FiscalCalendar]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[FiscalCalendar] ADD CONSTRAINT [FK_FiscalCalendar_SetofBook] FOREIGN KEY ([SetOfBookId]) REFERENCES [APPS].[SetOfBook] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[LegalEntity]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[LegalEntity] ADD CONSTRAINT [FK_LegalEntity_SetofBook] FOREIGN KEY ([SetOfBookId]) REFERENCES [APPS].[SetOfBook] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[Tax]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Tax] ADD CONSTRAINT [FK_Tax_SetofBook1] FOREIGN KEY ([SetOfBookId]) REFERENCES [APPS].[SetOfBook] ([Id])
');

GO
SET NOEXEC OFF;

GO
IF N'$(IsSqlCmdEnabled)' <> N'True'
  SET NOEXEC ON;

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('000131e1-16c7-410c-a7d7-0e10598cb302' AS UNIQUEIDENTIFIER))
  PRINT '***** FINISHED EXECUTING MIGRATION "Migrations\004_20190703-1406_PC.sql", ID: {000131e1-16c7-410c-a7d7-0e10598cb302} *****
';

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('000131e1-16c7-410c-a7d7-0e10598cb302' AS UNIQUEIDENTIFIER))
  INSERT [$(DatabaseName)].[dbo].[__MigrationLog] ([migration_id], [script_checksum], [script_filename], [complete_dt], [applied_by], [deployed], [version], [package_version], [release_version])
  VALUES                                         (CAST ('000131e1-16c7-410c-a7d7-0e10598cb302' AS UNIQUEIDENTIFIER), 'D7AF1B064C652129D80EF2FB01D08B4614257CDEB3F85326D099106DC925D130', 'Migrations\004_20190703-1406_PC.sql', SYSDATETIME(), SYSTEM_USER, 1, NULL, '$(PackageVersion)', CASE '$(ReleaseVersion)' WHEN '' THEN NULL ELSE '$(ReleaseVersion)' END);

GO
SET IMPLICIT_TRANSACTIONS, NUMERIC_ROUNDABORT OFF;
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, NOCOUNT, QUOTED_IDENTIFIER ON;

GO
IF DB_NAME() != '$(DatabaseName)'
  USE [$(DatabaseName)];

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('211d82d3-3e2e-4318-8860-eb1bd3fa5143' AS UNIQUEIDENTIFIER))
  PRINT '

***** EXECUTING MIGRATION "Migrations\005_20190703-1732_PC.sql", ID: {211d82d3-3e2e-4318-8860-eb1bd3fa5143} *****';

GO
IF EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('211d82d3-3e2e-4318-8860-eb1bd3fa5143' AS UNIQUEIDENTIFIER))
BEGIN
  PRINT '----- Skipping "Migrations\005_20190703-1732_PC.sql", ID: {211d82d3-3e2e-4318-8860-eb1bd3fa5143} as it has already been run on this database';
  SET NOEXEC ON;
END

GO
EXECUTE ('
PRINT N''Altering [APPS].[Division]''
');

GO
EXECUTE ('EXEC sp_rename N''[APPS].[Division].[ShortCode]'', N''ShortName'', N''COLUMN''
');

GO
EXECUTE ('PRINT N''Altering [APPS].[AssetOrganization]''
');

GO
EXECUTE ('EXEC sp_rename N''[APPS].[AssetOrganization].[ShortCode]'', N''ShortName'', N''COLUMN''
');

GO
EXECUTE ('PRINT N''Altering [APPS].[BusinessGroup]''
');

GO
EXECUTE ('EXEC sp_rename N''[APPS].[BusinessGroup].[ShortCode]'', N''ShortName'', N''COLUMN''
');

GO
EXECUTE ('PRINT N''Altering [APPS].[SetOfBook]''
');

GO
EXECUTE ('EXEC sp_rename N''[APPS].[SetOfBook].[ShortCode]'', N''ShortName'', N''COLUMN''
');

GO
EXECUTE ('PRINT N''Altering [APPS].[HROrganization]''
');

GO
EXECUTE ('EXEC sp_rename N''[APPS].[HROrganization].[ShortCode]'', N''ShortName'', N''COLUMN''
');

GO
EXECUTE ('PRINT N''Altering [APPS].[LegalEntity]''
');

GO
EXECUTE ('EXEC sp_rename N''[APPS].[LegalEntity].[ShortCode]'', N''ShortName'', N''COLUMN''
');

GO
EXECUTE ('PRINT N''Altering [APPS].[InventoryOrganization]''
');

GO
EXECUTE ('EXEC sp_rename N''[APPS].[InventoryOrganization].[ShortCode]'', N''ShortName'', N''COLUMN''
');

GO
EXECUTE ('PRINT N''Altering [APPS].[ProjectOrganization]''
');

GO
EXECUTE ('EXEC sp_rename N''[APPS].[ProjectOrganization].[ShortCode]'', N''ShortName'', N''COLUMN''
');

GO
SET NOEXEC OFF;

GO
IF N'$(IsSqlCmdEnabled)' <> N'True'
  SET NOEXEC ON;

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('211d82d3-3e2e-4318-8860-eb1bd3fa5143' AS UNIQUEIDENTIFIER))
  PRINT '***** FINISHED EXECUTING MIGRATION "Migrations\005_20190703-1732_PC.sql", ID: {211d82d3-3e2e-4318-8860-eb1bd3fa5143} *****
';

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('211d82d3-3e2e-4318-8860-eb1bd3fa5143' AS UNIQUEIDENTIFIER))
  INSERT [$(DatabaseName)].[dbo].[__MigrationLog] ([migration_id], [script_checksum], [script_filename], [complete_dt], [applied_by], [deployed], [version], [package_version], [release_version])
  VALUES                                         (CAST ('211d82d3-3e2e-4318-8860-eb1bd3fa5143' AS UNIQUEIDENTIFIER), 'C65D405EAC5266E9F83089014C0F0D3939949B8D7965995819D26DC9902E26D6', 'Migrations\005_20190703-1732_PC.sql', SYSDATETIME(), SYSTEM_USER, 1, NULL, '$(PackageVersion)', CASE '$(ReleaseVersion)' WHEN '' THEN NULL ELSE '$(ReleaseVersion)' END);

GO
SET IMPLICIT_TRANSACTIONS, NUMERIC_ROUNDABORT OFF;
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, NOCOUNT, QUOTED_IDENTIFIER ON;

GO
IF DB_NAME() != '$(DatabaseName)'
  USE [$(DatabaseName)];

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('f72418af-4d73-4e1f-b785-fde3072be56b' AS UNIQUEIDENTIFIER))
  PRINT '

***** EXECUTING MIGRATION "Migrations\006_20190704-1500_PC.sql", ID: {f72418af-4d73-4e1f-b785-fde3072be56b} *****';

GO
IF EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('f72418af-4d73-4e1f-b785-fde3072be56b' AS UNIQUEIDENTIFIER))
BEGIN
  PRINT '----- Skipping "Migrations\006_20190704-1500_PC.sql", ID: {f72418af-4d73-4e1f-b785-fde3072be56b} as it has already been run on this database';
  SET NOEXEC ON;
END

GO
EXECUTE ('
PRINT N''Dropping foreign keys from [HR].[Employee]''
');

GO
EXECUTE ('ALTER TABLE [HR].[Employee] DROP CONSTRAINT [FK_Employee_Department]
');

GO
EXECUTE ('ALTER TABLE [HR].[Employee] DROP CONSTRAINT [FK_Employee_JobLevel]
');

GO
EXECUTE ('ALTER TABLE [HR].[Employee] DROP CONSTRAINT [FK_Employee_JobTitle]
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [HR].[JobHistory]''
');

GO
EXECUTE ('ALTER TABLE [HR].[JobHistory] DROP CONSTRAINT [FK_JobHistory_Department]
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [HR].[JobLevel]''
');

GO
EXECUTE ('ALTER TABLE [HR].[JobLevel] DROP CONSTRAINT [FK_JobLevel_BusinessGroup]
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [HR].[JobTitle]''
');

GO
EXECUTE ('ALTER TABLE [HR].[JobTitle] DROP CONSTRAINT [FK_JobTitle_BusinessGroup]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [HR].[JobLevel]''
');

GO
EXECUTE ('ALTER TABLE [HR].[JobLevel] DROP CONSTRAINT [PK_JobLevel]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [HR].[JobTitle]''
');

GO
EXECUTE ('ALTER TABLE [HR].[JobTitle] DROP CONSTRAINT [PK_JobTitle]
');

GO
EXECUTE ('PRINT N''Dropping index [CX_JobLevel] from [HR].[JobLevel]''
');

GO
EXECUTE ('DROP INDEX [CX_JobLevel] ON [HR].[JobLevel]
');

GO
EXECUTE ('PRINT N''Dropping index [CX_JobTitle] from [HR].[JobTitle]''
');

GO
EXECUTE ('DROP INDEX [CX_JobTitle] ON [HR].[JobTitle]
');

GO
EXECUTE ('PRINT N''Altering [HR].[Employee]''
');

GO
EXECUTE ('EXEC sp_rename N''[HR].[Employee].[DepartmentId]'', N''BusinessGroupId'', N''COLUMN''
');

GO
EXECUTE ('PRINT N''Rebuilding [HR].[JobLevel]''
');

GO
EXECUTE ('CREATE TABLE [HR].[RG_Recovery_1_JobLevel]
(
[Id] [uniqueidentifier] NOT NULL,
[BusinessGroupId] [uniqueidentifier] NOT NULL,
[Level] [float] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Disable] [bit] NOT NULL
)
');

GO
SET IDENTITY_INSERT [HR].[RG_Recovery_1_JobLevel] ON

GO
EXECUTE ('INSERT INTO [HR].[RG_Recovery_1_JobLevel]([Id], [BusinessGroupId], [Level], [CX]) SELECT [Id], [BusinessGroupId], [Level], [CX] FROM [HR].[JobLevel]
');

GO
SET IDENTITY_INSERT [HR].[RG_Recovery_1_JobLevel] OFF

GO
EXECUTE ('DECLARE @idVal BIGINT
SELECT @idVal = IDENT_CURRENT(N''[HR].[JobLevel]'')
IF @idVal IS NOT NULL
    DBCC CHECKIDENT(N''[HR].[RG_Recovery_1_JobLevel]'', RESEED, @idVal)
');

GO
EXECUTE ('DROP TABLE [HR].[JobLevel]
');

GO
EXECUTE ('EXEC sp_rename N''[HR].[RG_Recovery_1_JobLevel]'', N''JobLevel'', N''OBJECT''
');

GO
EXECUTE ('PRINT N''Creating index [CX_JobLevel] on [HR].[JobLevel]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_JobLevel] ON [HR].[JobLevel] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_JobLevel] on [HR].[JobLevel]''
');

GO
EXECUTE ('ALTER TABLE [HR].[JobLevel] ADD CONSTRAINT [PK_JobLevel] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Rebuilding [HR].[JobTitle]''
');

GO
EXECUTE ('CREATE TABLE [HR].[RG_Recovery_2_JobTitle]
(
[Id] [uniqueidentifier] NOT NULL,
[BusinessGroupId] [uniqueidentifier] NOT NULL,
[Code] [nvarchar] (50) NULL,
[Name] [nvarchar] (500) NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Disable] [bit] NOT NULL
)
');

GO
SET IDENTITY_INSERT [HR].[RG_Recovery_2_JobTitle] ON

GO
EXECUTE ('INSERT INTO [HR].[RG_Recovery_2_JobTitle]([Id], [BusinessGroupId], [Code], [Name], [CX]) SELECT [Id], [BusinessGroupId], [Code], [Name], [CX] FROM [HR].[JobTitle]
');

GO
SET IDENTITY_INSERT [HR].[RG_Recovery_2_JobTitle] OFF

GO
EXECUTE ('DECLARE @idVal BIGINT
SELECT @idVal = IDENT_CURRENT(N''[HR].[JobTitle]'')
IF @idVal IS NOT NULL
    DBCC CHECKIDENT(N''[HR].[RG_Recovery_2_JobTitle]'', RESEED, @idVal)
');

GO
EXECUTE ('DROP TABLE [HR].[JobTitle]
');

GO
EXECUTE ('EXEC sp_rename N''[HR].[RG_Recovery_2_JobTitle]'', N''JobTitle'', N''OBJECT''
');

GO
EXECUTE ('PRINT N''Creating index [CX_JobTitle] on [HR].[JobTitle]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_JobTitle] ON [HR].[JobTitle] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_JobTitle] on [HR].[JobTitle]''
');

GO
EXECUTE ('ALTER TABLE [HR].[JobTitle] ADD CONSTRAINT [PK_JobTitle] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Altering [HR].[JobHistory]''
');

GO
EXECUTE ('ALTER TABLE [HR].[JobHistory] DROP
COLUMN [DepartmentId]
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [HR].[Employee]''
');

GO
EXECUTE ('ALTER TABLE [HR].[Employee] ADD CONSTRAINT [FK_Employee_BusinessGroup] FOREIGN KEY ([BusinessGroupId]) REFERENCES [APPS].[BusinessGroup] ([Id])
');

GO
EXECUTE ('ALTER TABLE [HR].[Employee] ADD CONSTRAINT [FK_Employee_Department] FOREIGN KEY ([BusinessGroupId]) REFERENCES [APPS].[HROrganization] ([Id])
');

GO
EXECUTE ('ALTER TABLE [HR].[Employee] ADD CONSTRAINT [FK_Employee_JobLevel] FOREIGN KEY ([JobLevelId]) REFERENCES [HR].[JobLevel] ([Id])
');

GO
EXECUTE ('ALTER TABLE [HR].[Employee] ADD CONSTRAINT [FK_Employee_JobTitle] FOREIGN KEY ([JobTitleId]) REFERENCES [HR].[JobTitle] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [HR].[JobLevel]''
');

GO
EXECUTE ('ALTER TABLE [HR].[JobLevel] ADD CONSTRAINT [FK_JobLevel_BusinessGroup] FOREIGN KEY ([BusinessGroupId]) REFERENCES [APPS].[BusinessGroup] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [HR].[JobTitle]''
');

GO
EXECUTE ('ALTER TABLE [HR].[JobTitle] ADD CONSTRAINT [FK_JobTitle_BusinessGroup] FOREIGN KEY ([BusinessGroupId]) REFERENCES [APPS].[BusinessGroup] ([Id])
');

GO
SET NOEXEC OFF;

GO
IF N'$(IsSqlCmdEnabled)' <> N'True'
  SET NOEXEC ON;

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('f72418af-4d73-4e1f-b785-fde3072be56b' AS UNIQUEIDENTIFIER))
  PRINT '***** FINISHED EXECUTING MIGRATION "Migrations\006_20190704-1500_PC.sql", ID: {f72418af-4d73-4e1f-b785-fde3072be56b} *****
';

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('f72418af-4d73-4e1f-b785-fde3072be56b' AS UNIQUEIDENTIFIER))
  INSERT [$(DatabaseName)].[dbo].[__MigrationLog] ([migration_id], [script_checksum], [script_filename], [complete_dt], [applied_by], [deployed], [version], [package_version], [release_version])
  VALUES                                         (CAST ('f72418af-4d73-4e1f-b785-fde3072be56b' AS UNIQUEIDENTIFIER), '8C11689332C57A3226B90CE49F771C60047E243F08B67F86B57D3659C35F8A33', 'Migrations\006_20190704-1500_PC.sql', SYSDATETIME(), SYSTEM_USER, 1, NULL, '$(PackageVersion)', CASE '$(ReleaseVersion)' WHEN '' THEN NULL ELSE '$(ReleaseVersion)' END);

GO
SET IMPLICIT_TRANSACTIONS, NUMERIC_ROUNDABORT OFF;
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, NOCOUNT, QUOTED_IDENTIFIER ON;

GO
IF DB_NAME() != '$(DatabaseName)'
  USE [$(DatabaseName)];

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('a377a10f-c2d9-480d-8a2d-5778d88fe381' AS UNIQUEIDENTIFIER))
  PRINT '

***** EXECUTING MIGRATION "Migrations\007_20190704-1621_PC.sql", ID: {a377a10f-c2d9-480d-8a2d-5778d88fe381} *****';

GO
IF EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('a377a10f-c2d9-480d-8a2d-5778d88fe381' AS UNIQUEIDENTIFIER))
BEGIN
  PRINT '----- Skipping "Migrations\007_20190704-1621_PC.sql", ID: {a377a10f-c2d9-480d-8a2d-5778d88fe381} as it has already been run on this database';
  SET NOEXEC ON;
END

GO
EXECUTE ('
PRINT N''Dropping foreign keys from [APPSYS].[Notification]''
');

GO
EXECUTE ('ALTER TABLE [APPSYS].[Notification] DROP CONSTRAINT [FK_Notification_User]
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [APPSYS].[UserProfile]''
');

GO
EXECUTE ('ALTER TABLE [APPSYS].[UserProfile] DROP CONSTRAINT [FK_UserProfile_User]
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [APPS].[BankAccount]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[BankAccount] DROP CONSTRAINT [FK_BankAccount_Bank]
');

GO
EXECUTE ('ALTER TABLE [APPS].[BankAccount] DROP CONSTRAINT [FK_BankAccount_SetOfBook]
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [APPS].[Currency]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Currency] DROP CONSTRAINT [FK_Currency_BusinessGroup]
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [APPS].[SetOfBook]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[SetOfBook] DROP CONSTRAINT [FK_SetOfBook_Currency]
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [APPS].[Item]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Item] DROP CONSTRAINT [FK_Item_BusinessGroup]
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [APPS].[PaymentMethod]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[PaymentMethod] DROP CONSTRAINT [FK_PaymentMethod_SetofBook]
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [APPS].[SupplierHeader]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[SupplierHeader] DROP CONSTRAINT [FK_SupplierHeader_BusinessGroup]
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [APPS].[Tax]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Tax] DROP CONSTRAINT [FK_Tax_SetofBook1]
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [HR].[EmployeeGroup]''
');

GO
EXECUTE ('ALTER TABLE [HR].[EmployeeGroup] DROP CONSTRAINT [FK_EmployeeGroup_Employee]
');

GO
EXECUTE ('ALTER TABLE [HR].[EmployeeGroup] DROP CONSTRAINT [FK_EmployeeGroup_Group]
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [HR].[Employee]''
');

GO
EXECUTE ('ALTER TABLE [HR].[Employee] DROP CONSTRAINT [FK_Employee_BusinessGroup]
');

GO
EXECUTE ('ALTER TABLE [HR].[Employee] DROP CONSTRAINT [FK_Employee_Department]
');

GO
EXECUTE ('ALTER TABLE [HR].[Employee] DROP CONSTRAINT [FK_Employee_JobLevel]
');

GO
EXECUTE ('ALTER TABLE [HR].[Employee] DROP CONSTRAINT [FK_Employee_JobTitle]
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [HR].[JobHistory]''
');

GO
EXECUTE ('ALTER TABLE [HR].[JobHistory] DROP CONSTRAINT [FK_JobHistory_Employee]
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [APPSYS].[User]''
');

GO
EXECUTE ('ALTER TABLE [APPSYS].[User] DROP CONSTRAINT [FK_User_Employee]
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [INV].[BinLocation]''
');

GO
EXECUTE ('ALTER TABLE [INV].[BinLocation] DROP CONSTRAINT [FK_BinLocation_Warehouse]
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [APPS].[AssetOrganization]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[AssetOrganization] DROP CONSTRAINT [FK_AssetOrganization_Division]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [APPSYS].[Notification]''
');

GO
EXECUTE ('ALTER TABLE [APPSYS].[Notification] DROP CONSTRAINT [PK_Notification]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [APPSYS].[UserProfile]''
');

GO
EXECUTE ('ALTER TABLE [APPSYS].[UserProfile] DROP CONSTRAINT [PK_UserProfile]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [APPS].[AssetOrganization]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[AssetOrganization] DROP CONSTRAINT [IX_Code_AssetOrganization]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [APPS].[BankAccount]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[BankAccount] DROP CONSTRAINT [PK_BankAccount]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [APPS].[CostCenter]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[CostCenter] DROP CONSTRAINT [PK_CostCenter]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [APPS].[Currency]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Currency] DROP CONSTRAINT [PK_FunctionalCurrency]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [APPS].[FiscalCalendar]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[FiscalCalendar] DROP CONSTRAINT [PK_FiscalCalendar]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [APPS].[Item]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Item] DROP CONSTRAINT [PK_GoodItem]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [APPS].[PaymentMethod]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[PaymentMethod] DROP CONSTRAINT [PK_PaymentMethod]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [APPS].[SupplierHeader]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[SupplierHeader] DROP CONSTRAINT [PK_SupplierHeader]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [APPS].[Tax]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Tax] DROP CONSTRAINT [PK_Tax]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [APPS].[UnitOfMeasure]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[UnitOfMeasure] DROP CONSTRAINT [PK_UOM]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [AR].[Customer]''
');

GO
EXECUTE ('ALTER TABLE [AR].[Customer] DROP CONSTRAINT [PK_Customer]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [HR].[EmployeeGroup]''
');

GO
EXECUTE ('ALTER TABLE [HR].[EmployeeGroup] DROP CONSTRAINT [PK_UserGroup]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [HR].[Employee]''
');

GO
EXECUTE ('ALTER TABLE [HR].[Employee] DROP CONSTRAINT [PK_Employee]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [HR].[Group]''
');

GO
EXECUTE ('ALTER TABLE [HR].[Group] DROP CONSTRAINT [PK_Group]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [INV].[BinLocation]''
');

GO
EXECUTE ('ALTER TABLE [INV].[BinLocation] DROP CONSTRAINT [PK_Bin]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [INV].[Warehouse]''
');

GO
EXECUTE ('ALTER TABLE [INV].[Warehouse] DROP CONSTRAINT [PK_Warehouse]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [dbo].[CustomerGroup]''
');

GO
EXECUTE ('ALTER TABLE [dbo].[CustomerGroup] DROP CONSTRAINT [PK_CustomerGroup]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [dbo].[Stock]''
');

GO
EXECUTE ('ALTER TABLE [dbo].[Stock] DROP CONSTRAINT [PK_Stock]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [dbo].[SupplierGroup]''
');

GO
EXECUTE ('ALTER TABLE [dbo].[SupplierGroup] DROP CONSTRAINT [PK_SupplierGroup]
');

GO
EXECUTE ('PRINT N''Dropping index [IX_Code_Currency] from [APPS].[Currency]''
');

GO
EXECUTE ('DROP INDEX [IX_Code_Currency] ON [APPS].[Currency]
');

GO
EXECUTE ('PRINT N''Dropping index [CX_Notification] from [APPSYS].[Notification]''
');

GO
EXECUTE ('DROP INDEX [CX_Notification] ON [APPSYS].[Notification]
');

GO
EXECUTE ('PRINT N''Dropping index [IX_UserProfile] from [APPSYS].[UserProfile]''
');

GO
EXECUTE ('DROP INDEX [IX_UserProfile] ON [APPSYS].[UserProfile]
');

GO
EXECUTE ('PRINT N''Dropping index [CX_BankAccount] from [APPS].[BankAccount]''
');

GO
EXECUTE ('DROP INDEX [CX_BankAccount] ON [APPS].[BankAccount]
');

GO
EXECUTE ('PRINT N''Dropping index [CX_FunctionalCurrency] from [APPS].[Currency]''
');

GO
EXECUTE ('DROP INDEX [CX_FunctionalCurrency] ON [APPS].[Currency]
');

GO
EXECUTE ('PRINT N''Dropping index [CX_SupplierHeader] from [APPS].[SupplierHeader]''
');

GO
EXECUTE ('DROP INDEX [CX_SupplierHeader] ON [APPS].[SupplierHeader]
');

GO
EXECUTE ('PRINT N''Dropping index [CX_UserGroup] from [HR].[EmployeeGroup]''
');

GO
EXECUTE ('DROP INDEX [CX_UserGroup] ON [HR].[EmployeeGroup]
');

GO
EXECUTE ('PRINT N''Dropping index [CX_Employee] from [HR].[Employee]''
');

GO
EXECUTE ('DROP INDEX [CX_Employee] ON [HR].[Employee]
');

GO
EXECUTE ('PRINT N''Dropping index [CX_Group] from [HR].[Group]''
');

GO
EXECUTE ('DROP INDEX [CX_Group] ON [HR].[Group]
');

GO
EXECUTE ('PRINT N''Dropping [HR].[Group]''
');

GO
EXECUTE ('DROP TABLE [HR].[Group]
');

GO
EXECUTE ('PRINT N''Dropping [HR].[EmployeeGroup]''
');

GO
EXECUTE ('DROP TABLE [HR].[EmployeeGroup]
');

GO
EXECUTE ('PRINT N''Rebuilding [APPS].[BankAccount]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[RG_Recovery_1_BankAccount]
(
[Id] [uniqueidentifier] NOT NULL,
[BankId] [uniqueidentifier] NOT NULL,
[SetOfBookId] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Disable] [bit] NOT NULL,
[No] [nvarchar] (50) NOT NULL,
[Name] [nvarchar] (500) NOT NULL,
[Description] [nvarchar] (500) NULL
)
');

GO
SET IDENTITY_INSERT [APPS].[RG_Recovery_1_BankAccount] ON

GO
EXECUTE ('INSERT INTO [APPS].[RG_Recovery_1_BankAccount]([Id], [BankId], [SetOfBookId], [CX], [Disable], [No], [Name], [Description]) SELECT [Id], [BankId], [SetOfBookId], [CX], [Disable], [No], [Name], [Description] FROM [APPS].[BankAccount]
');

GO
SET IDENTITY_INSERT [APPS].[RG_Recovery_1_BankAccount] OFF

GO
EXECUTE ('DROP TABLE [APPS].[BankAccount]
');

GO
EXECUTE ('EXEC sp_rename N''[APPS].[RG_Recovery_1_BankAccount]'', N''BankAccount'', N''OBJECT''
');

GO
EXECUTE ('PRINT N''Creating index [CX_BankAccount] on [APPS].[BankAccount]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_BankAccount] ON [APPS].[BankAccount] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_BankAccount] on [APPS].[BankAccount]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[BankAccount] ADD CONSTRAINT [PK_BankAccount] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Rebuilding [INV].[Warehouse]''
');

GO
EXECUTE ('CREATE TABLE [INV].[RG_Recovery_2_Warehouse]
(
[Id] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Disable] [bit] NOT NULL,
[Code] [nvarchar] (50) NOT NULL,
[Name] [nvarchar] (50) NOT NULL,
[Location] [nvarchar] (500) NOT NULL,
[InventoryOrganizationId] [uniqueidentifier] NOT NULL
)
');

GO
SET IDENTITY_INSERT [INV].[RG_Recovery_2_Warehouse] ON

GO
EXECUTE ('INSERT INTO [INV].[RG_Recovery_2_Warehouse]([Id], [CX], [Disable], [Code], [Name], [Location], [InventoryOrganizationId]) SELECT [Id], [CX], [Disable], [Code], [Name], [Location], [InventoryOrganizationId] FROM [INV].[Warehouse]
');

GO
SET IDENTITY_INSERT [INV].[RG_Recovery_2_Warehouse] OFF

GO
EXECUTE ('DROP TABLE [INV].[Warehouse]
');

GO
EXECUTE ('EXEC sp_rename N''[INV].[RG_Recovery_2_Warehouse]'', N''Warehouse'', N''OBJECT''
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_Warehouse] on [INV].[Warehouse]''
');

GO
EXECUTE ('ALTER TABLE [INV].[Warehouse] ADD CONSTRAINT [PK_Warehouse] PRIMARY KEY CLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Rebuilding [INV].[BinLocation]''
');

GO
EXECUTE ('CREATE TABLE [INV].[RG_Recovery_3_BinLocation]
(
[Id] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Disable] [bit] NOT NULL,
[Row] [nvarchar] (500) NOT NULL,
[Rack] [nvarchar] (500) NULL,
[Bin] [nvarchar] (500) NULL,
[WarehouseId] [uniqueidentifier] NOT NULL
)
');

GO
SET IDENTITY_INSERT [INV].[RG_Recovery_3_BinLocation] ON

GO
EXECUTE ('INSERT INTO [INV].[RG_Recovery_3_BinLocation]([Id], [CX], [Disable], [Row], [Rack], [Bin], [WarehouseId]) SELECT [Id], [CX], [Disable], [Row], [Rack], [Bin], [WarehouseId] FROM [INV].[BinLocation]
');

GO
SET IDENTITY_INSERT [INV].[RG_Recovery_3_BinLocation] OFF

GO
EXECUTE ('DROP TABLE [INV].[BinLocation]
');

GO
EXECUTE ('EXEC sp_rename N''[INV].[RG_Recovery_3_BinLocation]'', N''BinLocation'', N''OBJECT''
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_Bin] on [INV].[BinLocation]''
');

GO
EXECUTE ('ALTER TABLE [INV].[BinLocation] ADD CONSTRAINT [PK_Bin] PRIMARY KEY CLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Altering [APPS].[ChartOfAccount]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[ChartOfAccount] ALTER COLUMN [AccountCode] [nvarchar] (100) NOT NULL
');

GO
EXECUTE ('PRINT N''Adding constraints to [APPS].[ChartOfAccount]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[ChartOfAccount] ADD CONSTRAINT [IX_ChartOfAccount] UNIQUE NONCLUSTERED  ([AccountCode])
');

GO
EXECUTE ('PRINT N''Rebuilding [APPS].[Currency]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[RG_Recovery_4_Currency]
(
[Id] [uniqueidentifier] NOT NULL,
[BusinessGroupId] [uniqueidentifier] NOT NULL,
[Code] [nvarchar] (3) NULL,
[Name] [nvarchar] (500) NULL,
[Disable] [bit] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Sequence] [int] NOT NULL
)
');

GO
SET IDENTITY_INSERT [APPS].[RG_Recovery_4_Currency] ON

GO
EXECUTE ('INSERT INTO [APPS].[RG_Recovery_4_Currency]([Id], [BusinessGroupId], [Code], [Name], [Disable], [CX]) SELECT [Id], [BusinessGroupId], [Code], [Name], [Disable], [CX] FROM [APPS].[Currency]
');

GO
SET IDENTITY_INSERT [APPS].[RG_Recovery_4_Currency] OFF

GO
EXECUTE ('DECLARE @idVal BIGINT
SELECT @idVal = IDENT_CURRENT(N''[APPS].[Currency]'')
IF @idVal IS NOT NULL
    DBCC CHECKIDENT(N''[APPS].[RG_Recovery_4_Currency]'', RESEED, @idVal)
');

GO
EXECUTE ('DROP TABLE [APPS].[Currency]
');

GO
EXECUTE ('EXEC sp_rename N''[APPS].[RG_Recovery_4_Currency]'', N''Currency'', N''OBJECT''
');

GO
EXECUTE ('PRINT N''Creating index [CX_FunctionalCurrency] on [APPS].[Currency]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_FunctionalCurrency] ON [APPS].[Currency] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_FunctionalCurrency] on [APPS].[Currency]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Currency] ADD CONSTRAINT [PK_FunctionalCurrency] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Adding constraints to [APPS].[Currency]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Currency] ADD CONSTRAINT [IX_Code_Currency] UNIQUE NONCLUSTERED  ([Code])
');

GO
EXECUTE ('PRINT N''Rebuilding [HR].[Employee]''
');

GO
EXECUTE ('CREATE TABLE [HR].[RG_Recovery_5_Employee]
(
[Id] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Code] [nvarchar] (50) NOT NULL,
[DisplayName] [nvarchar] (200) NULL,
[PrimaryEmail] [nvarchar] (500) NULL,
[AlternativeEmail] [nvarchar] (500) NULL,
[BusinessGroupId] [uniqueidentifier] NOT NULL,
[JobTitleId] [uniqueidentifier] NOT NULL,
[JobLevelId] [uniqueidentifier] NOT NULL,
[JoinDate] [date] NOT NULL,
[EffectiveDate] [date] NULL,
[EndDate] [date] NULL,
[Status] [int] NOT NULL,
[Disable] [bit] NOT NULL
)
');

GO
SET IDENTITY_INSERT [HR].[RG_Recovery_5_Employee] ON

GO
EXECUTE ('INSERT INTO [HR].[RG_Recovery_5_Employee]([Id], [CX], [Code], [DisplayName], [PrimaryEmail], [AlternativeEmail], [BusinessGroupId], [JobTitleId], [JobLevelId], [JoinDate], [EffectiveDate], [EndDate], [Status]) SELECT [Id], [CX], [Code], [DisplayName], [PrimaryEmail], [AlternativeEmail], [BusinessGroupId], [JobTitleId], [JobLevelId], [JoinDate], [EffectiveDate], [EndDate], [Status] FROM [HR].[Employee]
');

GO
SET IDENTITY_INSERT [HR].[RG_Recovery_5_Employee] OFF

GO
EXECUTE ('DECLARE @idVal BIGINT
SELECT @idVal = IDENT_CURRENT(N''[HR].[Employee]'')
IF @idVal IS NOT NULL
    DBCC CHECKIDENT(N''[HR].[RG_Recovery_5_Employee]'', RESEED, @idVal)
');

GO
EXECUTE ('DROP TABLE [HR].[Employee]
');

GO
EXECUTE ('EXEC sp_rename N''[HR].[RG_Recovery_5_Employee]'', N''Employee'', N''OBJECT''
');

GO
EXECUTE ('PRINT N''Creating index [CX_Employee] on [HR].[Employee]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_Employee] ON [HR].[Employee] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_Employee] on [HR].[Employee]''
');

GO
EXECUTE ('ALTER TABLE [HR].[Employee] ADD CONSTRAINT [PK_Employee] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Creating [HR].[EmployeePosition]''
');

GO
EXECUTE ('CREATE TABLE [HR].[EmployeePosition]
(
[EmployeeId] [uniqueidentifier] NOT NULL,
[PositionId] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1)
)
');

GO
EXECUTE ('PRINT N''Creating index [CX_UserGroup] on [HR].[EmployeePosition]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_UserGroup] ON [HR].[EmployeePosition] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_UserGroup] on [HR].[EmployeePosition]''
');

GO
EXECUTE ('ALTER TABLE [HR].[EmployeePosition] ADD CONSTRAINT [PK_UserGroup] PRIMARY KEY NONCLUSTERED  ([EmployeeId], [PositionId])
');

GO
EXECUTE ('PRINT N''Creating [HR].[Position]''
');

GO
EXECUTE ('CREATE TABLE [HR].[Position]
(
[Id] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Disable] [bit] NOT NULL,
[DivisionId] [uniqueidentifier] NOT NULL,
[Name] [nvarchar] (500) NOT NULL
)
');

GO
EXECUTE ('PRINT N''Creating index [CX_Group] on [HR].[Position]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_Group] ON [HR].[Position] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_Group] on [HR].[Position]''
');

GO
EXECUTE ('ALTER TABLE [HR].[Position] ADD CONSTRAINT [PK_Group] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Rebuilding [APPS].[Item]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[RG_Recovery_6_Item]
(
[Id] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Disable] [bit] NOT NULL,
[Code] [nvarchar] (100) NOT NULL,
[Name] [nvarchar] (500) NOT NULL,
[BusinessGroupId] [uniqueidentifier] NOT NULL
)
');

GO
SET IDENTITY_INSERT [APPS].[RG_Recovery_6_Item] ON

GO
EXECUTE ('INSERT INTO [APPS].[RG_Recovery_6_Item]([Id], [CX], [Disable], [Code], [Name], [BusinessGroupId]) SELECT [Id], [CX], [Disable], [Code], [Name], [BusinessGroupId] FROM [APPS].[Item]
');

GO
SET IDENTITY_INSERT [APPS].[RG_Recovery_6_Item] OFF

GO
EXECUTE ('DROP TABLE [APPS].[Item]
');

GO
EXECUTE ('EXEC sp_rename N''[APPS].[RG_Recovery_6_Item]'', N''Item'', N''OBJECT''
');

GO
EXECUTE ('PRINT N''Creating index [CX_Item] on [APPS].[Item]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_Item] ON [APPS].[Item] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_GoodItem] on [APPS].[Item]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Item] ADD CONSTRAINT [PK_GoodItem] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Adding constraints to [APPS].[Item]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Item] ADD CONSTRAINT [IX_Item] UNIQUE NONCLUSTERED  ([Code], [BusinessGroupId])
');

GO
EXECUTE ('PRINT N''Rebuilding [APPSYS].[Notification]''
');

GO
EXECUTE ('CREATE TABLE [APPSYS].[RG_Recovery_7_Notification]
(
[Id] [uniqueidentifier] NOT NULL,
[Time] [datetime] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Status] [int] NOT NULL,
[UserId] [uniqueidentifier] NOT NULL,
[Content] [ntext] NOT NULL
)
');

GO
SET IDENTITY_INSERT [APPSYS].[RG_Recovery_7_Notification] ON

GO
EXECUTE ('INSERT INTO [APPSYS].[RG_Recovery_7_Notification]([Id], [Time], [CX], [Status], [UserId], [Content]) SELECT [Id], [Time], [CX], [Status], [UserId], [Content] FROM [APPSYS].[Notification]
');

GO
SET IDENTITY_INSERT [APPSYS].[RG_Recovery_7_Notification] OFF

GO
EXECUTE ('DROP TABLE [APPSYS].[Notification]
');

GO
EXECUTE ('EXEC sp_rename N''[APPSYS].[RG_Recovery_7_Notification]'', N''Notification'', N''OBJECT''
');

GO
EXECUTE ('PRINT N''Creating index [CX_Notification] on [APPSYS].[Notification]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_Notification] ON [APPSYS].[Notification] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_Notification] on [APPSYS].[Notification]''
');

GO
EXECUTE ('ALTER TABLE [APPSYS].[Notification] ADD CONSTRAINT [PK_Notification] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Rebuilding [APPS].[PaymentMethod]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[RG_Recovery_8_PaymentMethod]
(
[Id] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Disable] [bit] NOT NULL,
[MethodName] [nvarchar] (50) NOT NULL,
[Sequence] [int] NOT NULL,
[SetOfBookId] [uniqueidentifier] NOT NULL
)
');

GO
SET IDENTITY_INSERT [APPS].[RG_Recovery_8_PaymentMethod] ON

GO
EXECUTE ('INSERT INTO [APPS].[RG_Recovery_8_PaymentMethod]([Id], [CX], [Disable], [MethodName], [Sequence], [SetOfBookId]) SELECT [Id], [CX], [Disable], [MethodName], [Sequence], [SetOfBookId] FROM [APPS].[PaymentMethod]
');

GO
SET IDENTITY_INSERT [APPS].[RG_Recovery_8_PaymentMethod] OFF

GO
EXECUTE ('DROP TABLE [APPS].[PaymentMethod]
');

GO
EXECUTE ('EXEC sp_rename N''[APPS].[RG_Recovery_8_PaymentMethod]'', N''PaymentMethod'', N''OBJECT''
');

GO
EXECUTE ('PRINT N''Creating index [CX_PaymentMethod] on [APPS].[PaymentMethod]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_PaymentMethod] ON [APPS].[PaymentMethod] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_PaymentMethod] on [APPS].[PaymentMethod]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[PaymentMethod] ADD CONSTRAINT [PK_PaymentMethod] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Rebuilding [APPS].[SupplierHeader]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[RG_Recovery_9_SupplierHeader]
(
[Id] [uniqueidentifier] NOT NULL,
[BusinessGroupId] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Disable] [bit] NOT NULL,
[Name] [nvarchar] (50) NOT NULL
)
');

GO
SET IDENTITY_INSERT [APPS].[RG_Recovery_9_SupplierHeader] ON

GO
EXECUTE ('INSERT INTO [APPS].[RG_Recovery_9_SupplierHeader]([Id], [BusinessGroupId], [CX], [Disable], [Name]) SELECT [Id], [BusinessGroupId], [CX], [Disable], [Name] FROM [APPS].[SupplierHeader]
');

GO
SET IDENTITY_INSERT [APPS].[RG_Recovery_9_SupplierHeader] OFF

GO
EXECUTE ('DROP TABLE [APPS].[SupplierHeader]
');

GO
EXECUTE ('EXEC sp_rename N''[APPS].[RG_Recovery_9_SupplierHeader]'', N''SupplierHeader'', N''OBJECT''
');

GO
EXECUTE ('PRINT N''Creating index [CX_SupplierHeader] on [APPS].[SupplierHeader]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_SupplierHeader] ON [APPS].[SupplierHeader] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_SupplierHeader] on [APPS].[SupplierHeader]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[SupplierHeader] ADD CONSTRAINT [PK_SupplierHeader] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Rebuilding [APPS].[Tax]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[RG_Recovery_10_Tax]
(
[Id] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Disable] [bit] NOT NULL,
[SetOfBookId] [uniqueidentifier] NOT NULL,
[Code] [nvarchar] (50) NOT NULL,
[Name] [nvarchar] (500) NOT NULL,
[Rate] [decimal] (18, 4) NOT NULL,
[Description] [nvarchar] (500) NULL,
[Percent] [float] NOT NULL
)
');

GO
SET IDENTITY_INSERT [APPS].[RG_Recovery_10_Tax] ON

GO
EXECUTE ('INSERT INTO [APPS].[RG_Recovery_10_Tax]([Id], [CX], [Disable], [SetOfBookId], [Code], [Name], [Description], [Percent]) SELECT [Id], [CX], [Disable], [SetOfBookId], [TaxCode], [Name], [Description], [Percent] FROM [APPS].[Tax]
');

GO
SET IDENTITY_INSERT [APPS].[RG_Recovery_10_Tax] OFF

GO
EXECUTE ('DECLARE @idVal BIGINT
SELECT @idVal = IDENT_CURRENT(N''[APPS].[Tax]'')
IF @idVal IS NOT NULL
    DBCC CHECKIDENT(N''[APPS].[RG_Recovery_10_Tax]'', RESEED, @idVal)
');

GO
EXECUTE ('DROP TABLE [APPS].[Tax]
');

GO
EXECUTE ('EXEC sp_rename N''[APPS].[RG_Recovery_10_Tax]'', N''Tax'', N''OBJECT''
');

GO
EXECUTE ('PRINT N''Creating index [CX_Tax] on [APPS].[Tax]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_Tax] ON [APPS].[Tax] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_Tax] on [APPS].[Tax]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Tax] ADD CONSTRAINT [PK_Tax] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Rebuilding [APPSYS].[UserProfile]''
');

GO
EXECUTE ('CREATE TABLE [APPSYS].[RG_Recovery_11_UserProfile]
(
[Id] [uniqueidentifier] NOT NULL,
[Key] [nvarchar] (200) NOT NULL,
[UserId] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Value] [ntext] NOT NULL
)
');

GO
SET IDENTITY_INSERT [APPSYS].[RG_Recovery_11_UserProfile] ON

GO
EXECUTE ('INSERT INTO [APPSYS].[RG_Recovery_11_UserProfile]([Id], [Key], [UserId], [CX], [Value]) SELECT [Id], [Key], [UserId], [CX], [Value] FROM [APPSYS].[UserProfile]
');

GO
SET IDENTITY_INSERT [APPSYS].[RG_Recovery_11_UserProfile] OFF

GO
EXECUTE ('DROP TABLE [APPSYS].[UserProfile]
');

GO
EXECUTE ('EXEC sp_rename N''[APPSYS].[RG_Recovery_11_UserProfile]'', N''UserProfile'', N''OBJECT''
');

GO
EXECUTE ('PRINT N''Creating index [CX_UserProfile] on [APPSYS].[UserProfile]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_UserProfile] ON [APPSYS].[UserProfile] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_UserProfile] on [APPSYS].[UserProfile]''
');

GO
EXECUTE ('ALTER TABLE [APPSYS].[UserProfile] ADD CONSTRAINT [PK_UserProfile] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Altering [APPSYS].[SystemConfiguration]''
');

GO
EXECUTE ('ALTER TABLE [APPSYS].[SystemConfiguration] ADD
[CX] [bigint] NOT NULL IDENTITY(1, 1)
');

GO
EXECUTE ('PRINT N''Rebuilding [AR].[Customer]''
');

GO
EXECUTE ('CREATE TABLE [AR].[RG_Recovery_12_Customer]
(
[Id] [uniqueidentifier] NOT NULL,
[BusinessGroupId] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Disable] [bit] NOT NULL,
[Code] [nvarchar] (50) NOT NULL,
[Name] [nvarchar] (500) NOT NULL
)
');

GO
SET IDENTITY_INSERT [AR].[RG_Recovery_12_Customer] ON

GO
EXECUTE ('INSERT INTO [AR].[RG_Recovery_12_Customer]([Id], [BusinessGroupId], [CX], [Disable], [Code], [Name]) SELECT [Id], [BusinessGroupId], [CX], [Disable], [Code], [Name] FROM [AR].[Customer]
');

GO
SET IDENTITY_INSERT [AR].[RG_Recovery_12_Customer] OFF

GO
EXECUTE ('DROP TABLE [AR].[Customer]
');

GO
EXECUTE ('EXEC sp_rename N''[AR].[RG_Recovery_12_Customer]'', N''Customer'', N''OBJECT''
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_Customer] on [AR].[Customer]''
');

GO
EXECUTE ('ALTER TABLE [AR].[Customer] ADD CONSTRAINT [PK_Customer] PRIMARY KEY CLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Rebuilding [dbo].[CustomerGroup]''
');

GO
EXECUTE ('CREATE TABLE [dbo].[RG_Recovery_13_CustomerGroup]
(
[Id] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Disable] [bit] NOT NULL,
[Name] [nvarchar] (500) NOT NULL,
[LegalEntityId] [uniqueidentifier] NOT NULL
)
');

GO
SET IDENTITY_INSERT [dbo].[RG_Recovery_13_CustomerGroup] ON

GO
EXECUTE ('INSERT INTO [dbo].[RG_Recovery_13_CustomerGroup]([Id], [CX], [Disable], [Name], [LegalEntityId]) SELECT [Id], [CX], [Disable], [Name], [LegalEntityId] FROM [dbo].[CustomerGroup]
');

GO
SET IDENTITY_INSERT [dbo].[RG_Recovery_13_CustomerGroup] OFF

GO
EXECUTE ('DROP TABLE [dbo].[CustomerGroup]
');

GO
EXECUTE ('EXEC sp_rename N''[dbo].[RG_Recovery_13_CustomerGroup]'', N''CustomerGroup'', N''OBJECT''
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_CustomerGroup] on [dbo].[CustomerGroup]''
');

GO
EXECUTE ('ALTER TABLE [dbo].[CustomerGroup] ADD CONSTRAINT [PK_CustomerGroup] PRIMARY KEY CLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Rebuilding [dbo].[Stock]''
');

GO
EXECUTE ('CREATE TABLE [dbo].[RG_Recovery_14_Stock]
(
[Id] [uniqueidentifier] NOT NULL,
[GoodItemId] [uniqueidentifier] NOT NULL,
[WarehouseId] [uniqueidentifier] NOT NULL,
[Quantity] [decimal] (18, 4) NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Disable] [bit] NOT NULL
)
');

GO
SET IDENTITY_INSERT [dbo].[RG_Recovery_14_Stock] ON

GO
EXECUTE ('INSERT INTO [dbo].[RG_Recovery_14_Stock]([Id], [GoodItemId], [WarehouseId], [Quantity], [CX], [Disable]) SELECT [Id], [GoodItemId], [WarehouseId], [Quantity], [CX], [Disable] FROM [dbo].[Stock]
');

GO
SET IDENTITY_INSERT [dbo].[RG_Recovery_14_Stock] OFF

GO
EXECUTE ('DROP TABLE [dbo].[Stock]
');

GO
EXECUTE ('EXEC sp_rename N''[dbo].[RG_Recovery_14_Stock]'', N''Stock'', N''OBJECT''
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_Stock] on [dbo].[Stock]''
');

GO
EXECUTE ('ALTER TABLE [dbo].[Stock] ADD CONSTRAINT [PK_Stock] PRIMARY KEY CLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Rebuilding [dbo].[SupplierGroup]''
');

GO
EXECUTE ('CREATE TABLE [dbo].[RG_Recovery_15_SupplierGroup]
(
[Id] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Disable] [bit] NOT NULL,
[Name] [nvarchar] (500) NOT NULL,
[LegalEntityId] [uniqueidentifier] NOT NULL
)
');

GO
SET IDENTITY_INSERT [dbo].[RG_Recovery_15_SupplierGroup] ON

GO
EXECUTE ('INSERT INTO [dbo].[RG_Recovery_15_SupplierGroup]([Id], [CX], [Disable], [Name], [LegalEntityId]) SELECT [Id], [CX], [Disable], [Name], [LegalEntityId] FROM [dbo].[SupplierGroup]
');

GO
SET IDENTITY_INSERT [dbo].[RG_Recovery_15_SupplierGroup] OFF

GO
EXECUTE ('DROP TABLE [dbo].[SupplierGroup]
');

GO
EXECUTE ('EXEC sp_rename N''[dbo].[RG_Recovery_15_SupplierGroup]'', N''SupplierGroup'', N''OBJECT''
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_SupplierGroup] on [dbo].[SupplierGroup]''
');

GO
EXECUTE ('ALTER TABLE [dbo].[SupplierGroup] ADD CONSTRAINT [PK_SupplierGroup] PRIMARY KEY CLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Adding constraints to [APPS].[AssetOrganization]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[AssetOrganization] ADD CONSTRAINT [CX_Code_AssetOrganization] UNIQUE CLUSTERED  ([Code], [DivisionId])
');

GO
EXECUTE ('PRINT N''Creating index [CX_CostCenter] on [APPS].[CostCenter]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_CostCenter] ON [APPS].[CostCenter] ([CX])
');

GO
EXECUTE ('PRINT N''Creating index [CX_FiscalCalendar] on [APPS].[FiscalCalendar]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_FiscalCalendar] ON [APPS].[FiscalCalendar] ([CX])
');

GO
EXECUTE ('PRINT N''Creating index [CX_InventoryOrganization] on [APPS].[InventoryOrganization]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_InventoryOrganization] ON [APPS].[InventoryOrganization] ([CX])
');

GO
EXECUTE ('PRINT N''Creating index [CX_ProjectOrganization] on [APPS].[ProjectOrganization]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_ProjectOrganization] ON [APPS].[ProjectOrganization] ([CX])
');

GO
EXECUTE ('PRINT N''Creating index [CX_UnitOfMeasure] on [APPS].[UnitOfMeasure]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_UnitOfMeasure] ON [APPS].[UnitOfMeasure] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_CostCenter] on [APPS].[CostCenter]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[CostCenter] ADD CONSTRAINT [PK_CostCenter] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Adding constraints to [APPS].[DescriptiveFlexField]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[DescriptiveFlexField] ADD CONSTRAINT [IX_DescriptiveFlexField] UNIQUE NONCLUSTERED  ([Code], [BusinessGroupId])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_FiscalCalendar] on [APPS].[FiscalCalendar]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[FiscalCalendar] ADD CONSTRAINT [PK_FiscalCalendar] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Adding constraints to [APPS].[KeyFlexField]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[KeyFlexField] ADD CONSTRAINT [IX_KeyFlexField] UNIQUE NONCLUSTERED  ([Code], [BusinessGroupId])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_UOM] on [APPS].[UnitOfMeasure]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[UnitOfMeasure] ADD CONSTRAINT [PK_UOM] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPSYS].[Notification]''
');

GO
EXECUTE ('ALTER TABLE [APPSYS].[Notification] ADD CONSTRAINT [FK_Notification_User] FOREIGN KEY ([UserId]) REFERENCES [APPSYS].[User] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPSYS].[UserProfile]''
');

GO
EXECUTE ('ALTER TABLE [APPSYS].[UserProfile] ADD CONSTRAINT [FK_UserProfile_User] FOREIGN KEY ([UserId]) REFERENCES [APPSYS].[User] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[BankAccount]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[BankAccount] ADD CONSTRAINT [FK_BankAccount_Bank] FOREIGN KEY ([BankId]) REFERENCES [APPS].[Bank] ([Id])
');

GO
EXECUTE ('ALTER TABLE [APPS].[BankAccount] ADD CONSTRAINT [FK_BankAccount_SetOfBook] FOREIGN KEY ([SetOfBookId]) REFERENCES [APPS].[SetOfBook] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[Currency]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Currency] ADD CONSTRAINT [FK_Currency_BusinessGroup] FOREIGN KEY ([BusinessGroupId]) REFERENCES [APPS].[BusinessGroup] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[Item]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Item] ADD CONSTRAINT [FK_Item_BusinessGroup] FOREIGN KEY ([BusinessGroupId]) REFERENCES [APPS].[BusinessGroup] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[PaymentMethod]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[PaymentMethod] ADD CONSTRAINT [FK_PaymentMethod_SetofBook] FOREIGN KEY ([SetOfBookId]) REFERENCES [APPS].[SetOfBook] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[SupplierHeader]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[SupplierHeader] ADD CONSTRAINT [FK_SupplierHeader_BusinessGroup] FOREIGN KEY ([BusinessGroupId]) REFERENCES [APPS].[BusinessGroup] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[Tax]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Tax] ADD CONSTRAINT [FK_Tax_SetofBook1] FOREIGN KEY ([SetOfBookId]) REFERENCES [APPS].[SetOfBook] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [HR].[EmployeePosition]''
');

GO
EXECUTE ('ALTER TABLE [HR].[EmployeePosition] ADD CONSTRAINT [FK_EmployeeGroup_Employee] FOREIGN KEY ([EmployeeId]) REFERENCES [HR].[Employee] ([Id])
');

GO
EXECUTE ('ALTER TABLE [HR].[EmployeePosition] ADD CONSTRAINT [FK_EmployeeGroup_Group] FOREIGN KEY ([PositionId]) REFERENCES [HR].[Position] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [HR].[Employee]''
');

GO
EXECUTE ('ALTER TABLE [HR].[Employee] ADD CONSTRAINT [FK_Employee_BusinessGroup] FOREIGN KEY ([BusinessGroupId]) REFERENCES [APPS].[BusinessGroup] ([Id])
');

GO
EXECUTE ('ALTER TABLE [HR].[Employee] ADD CONSTRAINT [FK_Employee_Department] FOREIGN KEY ([BusinessGroupId]) REFERENCES [APPS].[HROrganization] ([Id])
');

GO
EXECUTE ('ALTER TABLE [HR].[Employee] ADD CONSTRAINT [FK_Employee_JobLevel] FOREIGN KEY ([JobLevelId]) REFERENCES [HR].[JobLevel] ([Id])
');

GO
EXECUTE ('ALTER TABLE [HR].[Employee] ADD CONSTRAINT [FK_Employee_JobTitle] FOREIGN KEY ([JobTitleId]) REFERENCES [HR].[JobTitle] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [HR].[Position]''
');

GO
EXECUTE ('ALTER TABLE [HR].[Position] ADD CONSTRAINT [FK_Position_Division] FOREIGN KEY ([DivisionId]) REFERENCES [APPS].[Division] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [INV].[BinLocation]''
');

GO
EXECUTE ('ALTER TABLE [INV].[BinLocation] ADD CONSTRAINT [FK_BinLocation_Warehouse] FOREIGN KEY ([WarehouseId]) REFERENCES [INV].[Warehouse] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[AssetOrganization]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[AssetOrganization] ADD CONSTRAINT [FK_AssetOrganization_Division] FOREIGN KEY ([DivisionId]) REFERENCES [APPS].[Division] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[SetOfBook]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[SetOfBook] ADD CONSTRAINT [FK_SetOfBook_Currency] FOREIGN KEY ([CurrencyId]) REFERENCES [APPS].[Currency] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [HR].[JobHistory]''
');

GO
EXECUTE ('ALTER TABLE [HR].[JobHistory] ADD CONSTRAINT [FK_JobHistory_Employee] FOREIGN KEY ([EmployeeId]) REFERENCES [HR].[Employee] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPSYS].[User]''
');

GO
EXECUTE ('ALTER TABLE [APPSYS].[User] ADD CONSTRAINT [FK_User_Employee] FOREIGN KEY ([EmployeeId]) REFERENCES [HR].[Employee] ([Id])
');

GO
SET NOEXEC OFF;

GO
IF N'$(IsSqlCmdEnabled)' <> N'True'
  SET NOEXEC ON;

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('a377a10f-c2d9-480d-8a2d-5778d88fe381' AS UNIQUEIDENTIFIER))
  PRINT '***** FINISHED EXECUTING MIGRATION "Migrations\007_20190704-1621_PC.sql", ID: {a377a10f-c2d9-480d-8a2d-5778d88fe381} *****
';

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('a377a10f-c2d9-480d-8a2d-5778d88fe381' AS UNIQUEIDENTIFIER))
  INSERT [$(DatabaseName)].[dbo].[__MigrationLog] ([migration_id], [script_checksum], [script_filename], [complete_dt], [applied_by], [deployed], [version], [package_version], [release_version])
  VALUES                                         (CAST ('a377a10f-c2d9-480d-8a2d-5778d88fe381' AS UNIQUEIDENTIFIER), 'F27260C365FA7EE6A1854ACFAD4EF12B3FF7CABCA9013138980F500AE3DBAEF0', 'Migrations\007_20190704-1621_PC.sql', SYSDATETIME(), SYSTEM_USER, 1, NULL, '$(PackageVersion)', CASE '$(ReleaseVersion)' WHEN '' THEN NULL ELSE '$(ReleaseVersion)' END);

GO
SET IMPLICIT_TRANSACTIONS, NUMERIC_ROUNDABORT OFF;
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, NOCOUNT, QUOTED_IDENTIFIER ON;

GO
IF DB_NAME() != '$(DatabaseName)'
  USE [$(DatabaseName)];

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('3bb56e60-b21e-463d-943d-966b31c8ae94' AS UNIQUEIDENTIFIER))
  PRINT '

***** EXECUTING MIGRATION "Migrations\008_20190709-0931_PC.sql", ID: {3bb56e60-b21e-463d-943d-966b31c8ae94} *****';

GO
IF EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('3bb56e60-b21e-463d-943d-966b31c8ae94' AS UNIQUEIDENTIFIER))
BEGIN
  PRINT '----- Skipping "Migrations\008_20190709-0931_PC.sql", ID: {3bb56e60-b21e-463d-943d-966b31c8ae94} as it has already been run on this database';
  SET NOEXEC ON;
END

GO
EXECUTE ('
PRINT N''Dropping foreign keys from [APPSYS].[Notification]''
');

GO
EXECUTE ('ALTER TABLE [APPSYS].[Notification] DROP CONSTRAINT [FK_Notification_User]
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [HR].[Employee]''
');

GO
EXECUTE ('ALTER TABLE [HR].[Employee] DROP CONSTRAINT [FK_Employee_Department]
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [INV].[BinLocation]''
');

GO
EXECUTE ('ALTER TABLE [INV].[BinLocation] DROP CONSTRAINT [FK_BinLocation_Warehouse]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [APPSYS].[Notification]''
');

GO
EXECUTE ('ALTER TABLE [APPSYS].[Notification] DROP CONSTRAINT [PK_Notification]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [INV].[Warehouse]''
');

GO
EXECUTE ('ALTER TABLE [INV].[Warehouse] DROP CONSTRAINT [PK_Warehouse]
');

GO
EXECUTE ('PRINT N''Dropping index [CX_Notification] from [APPSYS].[Notification]''
');

GO
EXECUTE ('DROP INDEX [CX_Notification] ON [APPSYS].[Notification]
');

GO
EXECUTE ('PRINT N''Dropping [INV].[Warehouse]''
');

GO
EXECUTE ('DROP TABLE [INV].[Warehouse]
');

GO
EXECUTE ('PRINT N''Altering [APPSYS].[AuditLog]''
');

GO
EXECUTE ('ALTER TABLE [APPSYS].[AuditLog] ALTER COLUMN [NewData] [ntext] NULL
');

GO
EXECUTE ('PRINT N''Altering [APPS].[LegalEntity]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[LegalEntity] ALTER COLUMN [ShortName] [nvarchar] (500) NULL
');

GO
EXECUTE ('PRINT N''Rebuilding [APPSYS].[Notification]''
');

GO
EXECUTE ('CREATE TABLE [APPSYS].[RG_Recovery_1_Notification]
(
[Id] [uniqueidentifier] NOT NULL,
[Time] [datetime] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Unread] [bit] NOT NULL,
[UserId] [uniqueidentifier] NOT NULL,
[Content] [ntext] NOT NULL,
[URL] [ntext] NULL
)
');

GO
SET IDENTITY_INSERT [APPSYS].[RG_Recovery_1_Notification] ON

GO
EXECUTE ('INSERT INTO [APPSYS].[RG_Recovery_1_Notification]([Id], [Time], [CX], [UserId], [Content]) SELECT [Id], [Time], [CX], [UserId], [Content] FROM [APPSYS].[Notification]
');

GO
SET IDENTITY_INSERT [APPSYS].[RG_Recovery_1_Notification] OFF

GO
EXECUTE ('DECLARE @idVal BIGINT
SELECT @idVal = IDENT_CURRENT(N''[APPSYS].[Notification]'')
IF @idVal IS NOT NULL
    DBCC CHECKIDENT(N''[APPSYS].[RG_Recovery_1_Notification]'', RESEED, @idVal)
');

GO
EXECUTE ('DROP TABLE [APPSYS].[Notification]
');

GO
EXECUTE ('EXEC sp_rename N''[APPSYS].[RG_Recovery_1_Notification]'', N''Notification'', N''OBJECT''
');

GO
EXECUTE ('PRINT N''Creating index [CX_Notification] on [APPSYS].[Notification]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_Notification] ON [APPSYS].[Notification] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_Notification] on [APPSYS].[Notification]''
');

GO
EXECUTE ('ALTER TABLE [APPSYS].[Notification] ADD CONSTRAINT [PK_Notification] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Creating index [IX_Time_Notification] on [APPSYS].[Notification]''
');

GO
EXECUTE ('CREATE NONCLUSTERED INDEX [IX_Time_Notification] ON [APPSYS].[Notification] ([Time])
');

GO
EXECUTE ('PRINT N''Altering [dbo].[Stock]''
');

GO
EXECUTE ('EXEC sp_rename N''[dbo].[Stock].[GoodItemId]'', N''ItemId'', N''COLUMN''
');

GO
EXECUTE ('EXEC sp_rename N''[dbo].[Stock].[WarehouseId]'', N''InventoryOrganizationId'', N''COLUMN''
');

GO
EXECUTE ('PRINT N''Creating [dbo].[StockAdjustment]''
');

GO
EXECUTE ('CREATE TABLE [dbo].[StockAdjustment]
(
[Id] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Disable] [bit] NOT NULL,
[InventoryOrganizationId] [uniqueidentifier] NOT NULL,
[AdjustmentReasonId] [uniqueidentifier] NOT NULL,
[RequesterId] [uniqueidentifier] NOT NULL,
[DocumentDate] [date] NOT NULL,
[Memo] [nvarchar] (500) NOT NULL
)
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_StockAdjustment] on [dbo].[StockAdjustment]''
');

GO
EXECUTE ('ALTER TABLE [dbo].[StockAdjustment] ADD CONSTRAINT [PK_StockAdjustment] PRIMARY KEY CLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Creating [dbo].[StockAdjustmentReason]''
');

GO
EXECUTE ('CREATE TABLE [dbo].[StockAdjustmentReason]
(
[Id] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL,
[Disable] [bit] NOT NULL,
[LegalEntityId] [uniqueidentifier] NOT NULL,
[Reason] [nvarchar] (500) NOT NULL
)
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_StockAdjustmentReason] on [dbo].[StockAdjustmentReason]''
');

GO
EXECUTE ('ALTER TABLE [dbo].[StockAdjustmentReason] ADD CONSTRAINT [PK_StockAdjustmentReason] PRIMARY KEY CLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Creating [dbo].[StockRequest]''
');

GO
EXECUTE ('CREATE TABLE [dbo].[StockRequest]
(
[Id] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Disable] [bit] NOT NULL,
[InventoryOrganizationId] [uniqueidentifier] NOT NULL,
[RequesterId] [uniqueidentifier] NOT NULL,
[DocumentDate] [date] NOT NULL,
[DocumentNo] [nvarchar] (200) NOT NULL,
[Reason] [nvarchar] (500) NULL
)
');

GO
EXECUTE ('PRINT N''Creating index [CX_StockRequest] on [dbo].[StockRequest]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_StockRequest] ON [dbo].[StockRequest] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_StockRequest] on [dbo].[StockRequest]''
');

GO
EXECUTE ('ALTER TABLE [dbo].[StockRequest] ADD CONSTRAINT [PK_StockRequest] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Creating [dbo].[StockRequestDetail]''
');

GO
EXECUTE ('CREATE TABLE [dbo].[StockRequestDetail]
(
[Id] [uniqueidentifier] NOT NULL,
[StockRequestId] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Disable] [bit] NOT NULL,
[ItemId] [uniqueidentifier] NOT NULL,
[UnitOfMeasureId] [uniqueidentifier] NOT NULL,
[RequestedQuantity] [int] NOT NULL,
[Remark] [nvarchar] (500) NOT NULL
)
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_StockRequestDetail] on [dbo].[StockRequestDetail]''
');

GO
EXECUTE ('ALTER TABLE [dbo].[StockRequestDetail] ADD CONSTRAINT [PK_StockRequestDetail] PRIMARY KEY CLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Altering [INV].[BinLocation]''
');

GO
EXECUTE ('EXEC sp_rename N''[INV].[BinLocation].[WarehouseId]'', N''InventoryOrganizationId'', N''COLUMN''
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPSYS].[Notification]''
');

GO
EXECUTE ('ALTER TABLE [APPSYS].[Notification] ADD CONSTRAINT [FK_Notification_User] FOREIGN KEY ([UserId]) REFERENCES [APPSYS].[User] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [dbo].[StockAdjustment]''
');

GO
EXECUTE ('ALTER TABLE [dbo].[StockAdjustment] ADD CONSTRAINT [FK_StockAdjustment_StockAdjustmentReason] FOREIGN KEY ([AdjustmentReasonId]) REFERENCES [dbo].[StockAdjustmentReason] ([Id])
');

GO
EXECUTE ('ALTER TABLE [dbo].[StockAdjustment] ADD CONSTRAINT [FK_StockAdjustment_InventoryOrganization] FOREIGN KEY ([InventoryOrganizationId]) REFERENCES [APPS].[InventoryOrganization] ([Id])
');

GO
EXECUTE ('ALTER TABLE [dbo].[StockAdjustment] ADD CONSTRAINT [FK_StockAdjustment_Employee] FOREIGN KEY ([RequesterId]) REFERENCES [HR].[Employee] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [dbo].[StockAdjustmentReason]''
');

GO
EXECUTE ('ALTER TABLE [dbo].[StockAdjustmentReason] ADD CONSTRAINT [FK_StockAdjustmentReason_LegalEntity] FOREIGN KEY ([LegalEntityId]) REFERENCES [APPS].[LegalEntity] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [dbo].[StockRequestDetail]''
');

GO
EXECUTE ('ALTER TABLE [dbo].[StockRequestDetail] ADD CONSTRAINT [FK_StockRequestDetail_StockRequest] FOREIGN KEY ([StockRequestId]) REFERENCES [dbo].[StockRequest] ([Id])
');

GO
EXECUTE ('ALTER TABLE [dbo].[StockRequestDetail] ADD CONSTRAINT [FK_StockRequestDetail_UnitOfMeasure] FOREIGN KEY ([UnitOfMeasureId]) REFERENCES [APPS].[UnitOfMeasure] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [dbo].[StockRequest]''
');

GO
EXECUTE ('ALTER TABLE [dbo].[StockRequest] ADD CONSTRAINT [FK_StockRequest_InventoryOrganization] FOREIGN KEY ([InventoryOrganizationId]) REFERENCES [APPS].[InventoryOrganization] ([Id])
');

GO
EXECUTE ('ALTER TABLE [dbo].[StockRequest] ADD CONSTRAINT [FK_StockRequest_Employee] FOREIGN KEY ([RequesterId]) REFERENCES [HR].[Employee] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [dbo].[Stock]''
');

GO
EXECUTE ('ALTER TABLE [dbo].[Stock] ADD CONSTRAINT [FK_Stock_InventoryOrganization] FOREIGN KEY ([InventoryOrganizationId]) REFERENCES [APPS].[InventoryOrganization] ([Id])
');

GO
EXECUTE ('ALTER TABLE [dbo].[Stock] ADD CONSTRAINT [FK_Stock_Item] FOREIGN KEY ([ItemId]) REFERENCES [APPS].[Item] ([Id])
');

GO
SET NOEXEC OFF;

GO
IF N'$(IsSqlCmdEnabled)' <> N'True'
  SET NOEXEC ON;

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('3bb56e60-b21e-463d-943d-966b31c8ae94' AS UNIQUEIDENTIFIER))
  PRINT '***** FINISHED EXECUTING MIGRATION "Migrations\008_20190709-0931_PC.sql", ID: {3bb56e60-b21e-463d-943d-966b31c8ae94} *****
';

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('3bb56e60-b21e-463d-943d-966b31c8ae94' AS UNIQUEIDENTIFIER))
  INSERT [$(DatabaseName)].[dbo].[__MigrationLog] ([migration_id], [script_checksum], [script_filename], [complete_dt], [applied_by], [deployed], [version], [package_version], [release_version])
  VALUES                                         (CAST ('3bb56e60-b21e-463d-943d-966b31c8ae94' AS UNIQUEIDENTIFIER), '0CA06CF513698B30313BEE069490B231A9E2911B4F4BD9DC646AC70BCECB9221', 'Migrations\008_20190709-0931_PC.sql', SYSDATETIME(), SYSTEM_USER, 1, NULL, '$(PackageVersion)', CASE '$(ReleaseVersion)' WHEN '' THEN NULL ELSE '$(ReleaseVersion)' END);

GO
SET IMPLICIT_TRANSACTIONS, NUMERIC_ROUNDABORT OFF;
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, NOCOUNT, QUOTED_IDENTIFIER ON;

GO
IF DB_NAME() != '$(DatabaseName)'
  USE [$(DatabaseName)];

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('4a6458a4-827c-4a1f-9ce9-ef091cbfc925' AS UNIQUEIDENTIFIER))
  PRINT '

***** EXECUTING MIGRATION "Migrations\009_20190709-1625_PC.sql", ID: {4a6458a4-827c-4a1f-9ce9-ef091cbfc925} *****';

GO
IF EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('4a6458a4-827c-4a1f-9ce9-ef091cbfc925' AS UNIQUEIDENTIFIER))
BEGIN
  PRINT '----- Skipping "Migrations\009_20190709-1625_PC.sql", ID: {4a6458a4-827c-4a1f-9ce9-ef091cbfc925} as it has already been run on this database';
  SET NOEXEC ON;
END

GO
EXECUTE ('
PRINT N''Dropping foreign keys from [APPS].[CostCenter]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[CostCenter] DROP CONSTRAINT [FK_CostCenter_ChartOfAccount]
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [APPS].[CustomerHeader]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[CustomerHeader] DROP CONSTRAINT [FK_CustomerHeader_BusinessGroup]
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [APPS].[DescriptiveFlexField]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[DescriptiveFlexField] DROP CONSTRAINT [FK_DescriptiveFledField_BusinessGroup]
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [APPS].[FiscalCalendar]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[FiscalCalendar] DROP CONSTRAINT [FK_FiscalCalendar_SetofBook]
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [APPS].[KeyFlexField]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[KeyFlexField] DROP CONSTRAINT [FK_KeyFlexField_BusinessGroup]
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [APPS].[SupplierHeader]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[SupplierHeader] DROP CONSTRAINT [FK_SupplierHeader_BusinessGroup]
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [dbo].[StockAdjustmentReason]''
');

GO
EXECUTE ('ALTER TABLE [dbo].[StockAdjustmentReason] DROP CONSTRAINT [FK_StockAdjustmentReason_LegalEntity]
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [dbo].[StockAdjustment]''
');

GO
EXECUTE ('ALTER TABLE [dbo].[StockAdjustment] DROP CONSTRAINT [FK_StockAdjustment_StockAdjustmentReason]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [APPS].[CostCenter]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[CostCenter] DROP CONSTRAINT [PK_CostCenter]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [APPS].[CustomerHeader]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[CustomerHeader] DROP CONSTRAINT [PK_CustomerHeader]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [APPS].[CustomerHeader]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[CustomerHeader] DROP CONSTRAINT [IX_Name_CustomerHeader]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [APPS].[DescriptiveFlexField]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[DescriptiveFlexField] DROP CONSTRAINT [PK_DescriptiveFledField]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [APPS].[DescriptiveFlexField]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[DescriptiveFlexField] DROP CONSTRAINT [IX_DescriptiveFlexField]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [APPS].[FiscalCalendar]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[FiscalCalendar] DROP CONSTRAINT [PK_FiscalCalendar]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [APPS].[KeyFlexField]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[KeyFlexField] DROP CONSTRAINT [PK_KeyFlexField]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [APPS].[KeyFlexField]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[KeyFlexField] DROP CONSTRAINT [IX_KeyFlexField]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [APPS].[SupplierHeader]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[SupplierHeader] DROP CONSTRAINT [PK_SupplierHeader]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [AP].[SupplierHeaderValue]''
');

GO
EXECUTE ('ALTER TABLE [AP].[SupplierHeaderValue] DROP CONSTRAINT [PK_SupplierHeaderValue]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [dbo].[StockAdjustmentReason]''
');

GO
EXECUTE ('ALTER TABLE [dbo].[StockAdjustmentReason] DROP CONSTRAINT [PK_StockAdjustmentReason]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [dbo].[StockAdjustment]''
');

GO
EXECUTE ('ALTER TABLE [dbo].[StockAdjustment] DROP CONSTRAINT [PK_StockAdjustment]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [dbo].[StockRequestDetail]''
');

GO
EXECUTE ('ALTER TABLE [dbo].[StockRequestDetail] DROP CONSTRAINT [PK_StockRequestDetail]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [dbo].[Stock]''
');

GO
EXECUTE ('ALTER TABLE [dbo].[Stock] DROP CONSTRAINT [PK_Stock]
');

GO
EXECUTE ('PRINT N''Dropping index [CX_CostCenter] from [APPS].[CostCenter]''
');

GO
EXECUTE ('DROP INDEX [CX_CostCenter] ON [APPS].[CostCenter]
');

GO
EXECUTE ('PRINT N''Dropping index [CX_CustomerHeader] from [APPS].[CustomerHeader]''
');

GO
EXECUTE ('DROP INDEX [CX_CustomerHeader] ON [APPS].[CustomerHeader]
');

GO
EXECUTE ('PRINT N''Dropping index [CX_DescriptiveFledField] from [APPS].[DescriptiveFlexField]''
');

GO
EXECUTE ('DROP INDEX [CX_DescriptiveFledField] ON [APPS].[DescriptiveFlexField]
');

GO
EXECUTE ('PRINT N''Dropping index [CX_FiscalCalendar] from [APPS].[FiscalCalendar]''
');

GO
EXECUTE ('DROP INDEX [CX_FiscalCalendar] ON [APPS].[FiscalCalendar]
');

GO
EXECUTE ('PRINT N''Dropping index [CX_KeyFlexField] from [APPS].[KeyFlexField]''
');

GO
EXECUTE ('DROP INDEX [CX_KeyFlexField] ON [APPS].[KeyFlexField]
');

GO
EXECUTE ('PRINT N''Dropping index [CX_SupplierHeader] from [APPS].[SupplierHeader]''
');

GO
EXECUTE ('DROP INDEX [CX_SupplierHeader] ON [APPS].[SupplierHeader]
');

GO
EXECUTE ('PRINT N''Dropping index [CX_SupplierHeaderValue] from [AP].[SupplierHeaderValue]''
');

GO
EXECUTE ('DROP INDEX [CX_SupplierHeaderValue] ON [AP].[SupplierHeaderValue]
');

GO
EXECUTE ('PRINT N''Dropping [AP].[SupplierHeaderValue]''
');

GO
EXECUTE ('DROP TABLE [AP].[SupplierHeaderValue]
');

GO
EXECUTE ('PRINT N''Dropping [APPS].[SupplierHeader]''
');

GO
EXECUTE ('DROP TABLE [APPS].[SupplierHeader]
');

GO
EXECUTE ('PRINT N''Dropping [APPS].[KeyFlexField]''
');

GO
EXECUTE ('DROP TABLE [APPS].[KeyFlexField]
');

GO
EXECUTE ('PRINT N''Dropping [APPS].[FiscalCalendar]''
');

GO
EXECUTE ('DROP TABLE [APPS].[FiscalCalendar]
');

GO
EXECUTE ('PRINT N''Dropping [APPS].[DescriptiveFlexField]''
');

GO
EXECUTE ('DROP TABLE [APPS].[DescriptiveFlexField]
');

GO
EXECUTE ('PRINT N''Dropping [APPS].[CustomerHeader]''
');

GO
EXECUTE ('DROP TABLE [APPS].[CustomerHeader]
');

GO
EXECUTE ('PRINT N''Creating [APPS].[FiscalYear]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[FiscalYear]
(
[Id] [uniqueidentifier] NOT NULL,
[SetOfBookId] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Disable] [bit] NOT NULL,
[Name] [nvarchar] (500) NOT NULL,
[StartDate] [datetime] NOT NULL,
[EndDate] [datetime] NOT NULL,
[Status] [int] NOT NULL CONSTRAINT [DF_FiscalYear_Status] DEFAULT ((0))
)
');

GO
EXECUTE ('PRINT N''Creating index [CX_FiscalCalendar] on [APPS].[FiscalYear]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_FiscalCalendar] ON [APPS].[FiscalYear] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_FiscalCalendar] on [APPS].[FiscalYear]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[FiscalYear] ADD CONSTRAINT [PK_FiscalCalendar] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Creating [APPS].[AccountingPeriod]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[AccountingPeriod]
(
[Id] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL,
[Disable] [bit] NOT NULL,
[FiscalYearId] [uniqueidentifier] NOT NULL,
[StartPeriod] [date] NOT NULL,
[EndPeriod] [date] NOT NULL,
[Status] [int] NOT NULL
)
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_AccountingPeriod] on [APPS].[AccountingPeriod]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[AccountingPeriod] ADD CONSTRAINT [PK_AccountingPeriod] PRIMARY KEY CLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Altering [APPS].[ChartOfAccount]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[ChartOfAccount] ADD
[ParentId] [uniqueidentifier] NULL
');

GO
EXECUTE ('PRINT N''Creating [APPS].[COATemplate]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[COATemplate]
(
[Id] [uniqueidentifier] NOT NULL,
[BusinessGroupId] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Name] [nvarchar] (500) NOT NULL,
[ParentId] [uniqueidentifier] NULL
)
');

GO
EXECUTE ('PRINT N''Creating index [CX_COATemplate] on [APPS].[COATemplate]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_COATemplate] ON [APPS].[COATemplate] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_COATemplate] on [APPS].[COATemplate]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[COATemplate] ADD CONSTRAINT [PK_COATemplate] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Creating [APPS].[COATemplateDetail]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[COATemplateDetail]
(
[Id] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[COATemplateId] [uniqueidentifier] NOT NULL,
[Code] [nvarchar] (50) NOT NULL,
[Name] [nvarchar] (500) NOT NULL,
[Description] [nvarchar] (500) NOT NULL
)
');

GO
EXECUTE ('PRINT N''Creating index [CX_COATemplateDetail] on [APPS].[COATemplateDetail]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_COATemplateDetail] ON [APPS].[COATemplateDetail] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_COATemplateDetail] on [APPS].[COATemplateDetail]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[COATemplateDetail] ADD CONSTRAINT [PK_COATemplateDetail] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Rebuilding [APPS].[CostCenter]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[RG_Recovery_1_CostCenter]
(
[Id] [uniqueidentifier] NOT NULL,
[Disable] [bit] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Code] [nvarchar] (500) NOT NULL,
[Name] [nvarchar] (500) NULL,
[ParentId] [uniqueidentifier] NOT NULL,
[ChartOfAccountId] [uniqueidentifier] NULL,
[SetOfBookId] [uniqueidentifier] NOT NULL
)
');

GO
SET IDENTITY_INSERT [APPS].[RG_Recovery_1_CostCenter] ON

GO
EXECUTE ('INSERT INTO [APPS].[RG_Recovery_1_CostCenter]([Id], [Disable], [CX], [Code], [Name], [ParentId], [ChartOfAccountId]) SELECT [Id], [Disable], [CX], [Code], [Name], [ParentId], [ChartOfAccountId] FROM [APPS].[CostCenter]
');

GO
SET IDENTITY_INSERT [APPS].[RG_Recovery_1_CostCenter] OFF

GO
EXECUTE ('DECLARE @idVal BIGINT
SELECT @idVal = IDENT_CURRENT(N''[APPS].[CostCenter]'')
IF @idVal IS NOT NULL
    DBCC CHECKIDENT(N''[APPS].[RG_Recovery_1_CostCenter]'', RESEED, @idVal)
');

GO
EXECUTE ('DROP TABLE [APPS].[CostCenter]
');

GO
EXECUTE ('EXEC sp_rename N''[APPS].[RG_Recovery_1_CostCenter]'', N''CostCenter'', N''OBJECT''
');

GO
EXECUTE ('PRINT N''Creating index [CX_CostCenter] on [APPS].[CostCenter]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_CostCenter] ON [APPS].[CostCenter] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_CostCenter] on [APPS].[CostCenter]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[CostCenter] ADD CONSTRAINT [PK_CostCenter] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Rebuilding [dbo].[StockAdjustmentReason]''
');

GO
EXECUTE ('CREATE TABLE [dbo].[RG_Recovery_2_StockAdjustmentReason]
(
[Id] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Disable] [bit] NOT NULL,
[LegalEntityId] [uniqueidentifier] NOT NULL,
[Reason] [nvarchar] (500) NOT NULL
)
');

GO
SET IDENTITY_INSERT [dbo].[RG_Recovery_2_StockAdjustmentReason] ON

GO
EXECUTE ('INSERT INTO [dbo].[RG_Recovery_2_StockAdjustmentReason]([Id], [CX], [Disable], [LegalEntityId], [Reason]) SELECT [Id], [CX], [Disable], [LegalEntityId], [Reason] FROM [dbo].[StockAdjustmentReason]
');

GO
SET IDENTITY_INSERT [dbo].[RG_Recovery_2_StockAdjustmentReason] OFF

GO
EXECUTE ('DROP TABLE [dbo].[StockAdjustmentReason]
');

GO
EXECUTE ('EXEC sp_rename N''[dbo].[RG_Recovery_2_StockAdjustmentReason]'', N''StockAdjustmentReason'', N''OBJECT''
');

GO
EXECUTE ('PRINT N''Creating index [CX_StockAdjustmentReason] on [dbo].[StockAdjustmentReason]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_StockAdjustmentReason] ON [dbo].[StockAdjustmentReason] ([Id])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_StockAdjustmentReason] on [dbo].[StockAdjustmentReason]''
');

GO
EXECUTE ('ALTER TABLE [dbo].[StockAdjustmentReason] ADD CONSTRAINT [PK_StockAdjustmentReason] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Creating [APPS].[TaxTemplate]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[TaxTemplate]
(
[Id] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Name] [nvarchar] (500) NOT NULL,
[Type] [nvarchar] (50) NOT NULL,
[BusinessGroupId] [uniqueidentifier] NOT NULL
)
');

GO
EXECUTE ('PRINT N''Creating index [CX_TaxTemplate] on [APPS].[TaxTemplate]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_TaxTemplate] ON [APPS].[TaxTemplate] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_TemplateTax] on [APPS].[TaxTemplate]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[TaxTemplate] ADD CONSTRAINT [PK_TemplateTax] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Creating [APPS].[TaxTemplateDetail]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[TaxTemplateDetail]
(
[Id] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[TaxTemplateId] [uniqueidentifier] NOT NULL,
[Code] [nvarchar] (50) NOT NULL,
[Name] [nvarchar] (500) NOT NULL,
[UnitOfMeasureId] [uniqueidentifier] NOT NULL,
[Rate] [decimal] (18, 4) NOT NULL,
[Description] [nvarchar] (500) NULL
)
');

GO
EXECUTE ('PRINT N''Creating index [CX_TaxTemplateDetail] on [APPS].[TaxTemplateDetail]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_TaxTemplateDetail] ON [APPS].[TaxTemplateDetail] ([Id])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_TemplateTaxDetail] on [APPS].[TaxTemplateDetail]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[TaxTemplateDetail] ADD CONSTRAINT [PK_TemplateTaxDetail] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Creating index [CX_StockAdjustment] on [dbo].[StockAdjustment]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_StockAdjustment] ON [dbo].[StockAdjustment] ([CX])
');

GO
EXECUTE ('PRINT N''Creating index [CX_StockRequestDetail] on [dbo].[StockRequestDetail]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_StockRequestDetail] ON [dbo].[StockRequestDetail] ([CX])
');

GO
EXECUTE ('PRINT N''Creating index [CX_Stock] on [dbo].[Stock]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_Stock] ON [dbo].[Stock] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_StockAdjustment] on [dbo].[StockAdjustment]''
');

GO
EXECUTE ('ALTER TABLE [dbo].[StockAdjustment] ADD CONSTRAINT [PK_StockAdjustment] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_StockRequestDetail] on [dbo].[StockRequestDetail]''
');

GO
EXECUTE ('ALTER TABLE [dbo].[StockRequestDetail] ADD CONSTRAINT [PK_StockRequestDetail] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_Stock] on [dbo].[Stock]''
');

GO
EXECUTE ('ALTER TABLE [dbo].[Stock] ADD CONSTRAINT [PK_Stock] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[CostCenter]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[CostCenter] ADD CONSTRAINT [FK_CostCenter_ChartOfAccount] FOREIGN KEY ([ChartOfAccountId]) REFERENCES [APPS].[ChartOfAccount] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[FiscalYear]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[FiscalYear] ADD CONSTRAINT [FK_FiscalCalendar_SetofBook] FOREIGN KEY ([SetOfBookId]) REFERENCES [APPS].[SetOfBook] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [dbo].[StockAdjustmentReason]''
');

GO
EXECUTE ('ALTER TABLE [dbo].[StockAdjustmentReason] ADD CONSTRAINT [FK_StockAdjustmentReason_LegalEntity] FOREIGN KEY ([LegalEntityId]) REFERENCES [APPS].[LegalEntity] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [dbo].[StockAdjustment]''
');

GO
EXECUTE ('ALTER TABLE [dbo].[StockAdjustment] ADD CONSTRAINT [FK_StockAdjustment_StockAdjustmentReason] FOREIGN KEY ([AdjustmentReasonId]) REFERENCES [dbo].[StockAdjustmentReason] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[AccountingPeriod]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[AccountingPeriod] ADD CONSTRAINT [FK_AccountingPeriod_FiscalYear] FOREIGN KEY ([FiscalYearId]) REFERENCES [APPS].[FiscalYear] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[COATemplateDetail]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[COATemplateDetail] ADD CONSTRAINT [FK_COATemplateDetail_COATemplate] FOREIGN KEY ([COATemplateId]) REFERENCES [APPS].[COATemplate] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[COATemplate]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[COATemplate] ADD CONSTRAINT [FK_COATemplate_BusinessGroup] FOREIGN KEY ([BusinessGroupId]) REFERENCES [APPS].[BusinessGroup] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[CostCenter]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[CostCenter] ADD CONSTRAINT [FK_CostCenter_SetOfBook] FOREIGN KEY ([SetOfBookId]) REFERENCES [APPS].[SetOfBook] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[TaxTemplateDetail]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[TaxTemplateDetail] ADD CONSTRAINT [FK_TaxTemplateDetail_TaxTemplate] FOREIGN KEY ([TaxTemplateId]) REFERENCES [APPS].[TaxTemplate] ([Id])
');

GO
EXECUTE ('ALTER TABLE [APPS].[TaxTemplateDetail] ADD CONSTRAINT [FK_TaxTemplateDetail_UnitOfMeasure] FOREIGN KEY ([UnitOfMeasureId]) REFERENCES [APPS].[UnitOfMeasure] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[TaxTemplate]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[TaxTemplate] ADD CONSTRAINT [FK_TaxTemplate_BusinessGroup] FOREIGN KEY ([BusinessGroupId]) REFERENCES [APPS].[BusinessGroup] ([Id])
');

GO
EXECUTE ('PRINT N''Creating extended properties''
');

GO
EXECUTE ('EXEC sp_addextendedproperty N''MS_Description'', N''0 = CLOSE, 1 = OPEN'', ''SCHEMA'', N''APPS'', ''TABLE'', N''AccountingPeriod'', ''COLUMN'', N''Status''
');

GO
EXECUTE ('EXEC sp_addextendedproperty N''MS_Description'', N''0 = CLOSE, 1 = OPEN'', ''SCHEMA'', N''APPS'', ''TABLE'', N''FiscalYear'', ''COLUMN'', N''Status''
');

GO
SET NOEXEC OFF;

GO
IF N'$(IsSqlCmdEnabled)' <> N'True'
  SET NOEXEC ON;

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('4a6458a4-827c-4a1f-9ce9-ef091cbfc925' AS UNIQUEIDENTIFIER))
  PRINT '***** FINISHED EXECUTING MIGRATION "Migrations\009_20190709-1625_PC.sql", ID: {4a6458a4-827c-4a1f-9ce9-ef091cbfc925} *****
';

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('4a6458a4-827c-4a1f-9ce9-ef091cbfc925' AS UNIQUEIDENTIFIER))
  INSERT [$(DatabaseName)].[dbo].[__MigrationLog] ([migration_id], [script_checksum], [script_filename], [complete_dt], [applied_by], [deployed], [version], [package_version], [release_version])
  VALUES                                         (CAST ('4a6458a4-827c-4a1f-9ce9-ef091cbfc925' AS UNIQUEIDENTIFIER), '5F7D2D6216C50BE988FA33EC1584913877C2FC6F537E45B4DFE87FDABB99E2F5', 'Migrations\009_20190709-1625_PC.sql', SYSDATETIME(), SYSTEM_USER, 1, NULL, '$(PackageVersion)', CASE '$(ReleaseVersion)' WHEN '' THEN NULL ELSE '$(ReleaseVersion)' END);

GO
SET IMPLICIT_TRANSACTIONS, NUMERIC_ROUNDABORT OFF;
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, NOCOUNT, QUOTED_IDENTIFIER ON;

GO
IF DB_NAME() != '$(DatabaseName)'
  USE [$(DatabaseName)];

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('38d4d1f5-5da8-44f0-9e99-bd8c65642f79' AS UNIQUEIDENTIFIER))
  PRINT '

***** EXECUTING MIGRATION "Migrations\010_20190710-1423_PC.sql", ID: {38d4d1f5-5da8-44f0-9e99-bd8c65642f79} *****';

GO
IF EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('38d4d1f5-5da8-44f0-9e99-bd8c65642f79' AS UNIQUEIDENTIFIER))
BEGIN
  PRINT '----- Skipping "Migrations\010_20190710-1423_PC.sql", ID: {38d4d1f5-5da8-44f0-9e99-bd8c65642f79} as it has already been run on this database';
  SET NOEXEC ON;
END

GO
EXECUTE ('
PRINT N''Dropping foreign keys from [APPS].[Tax]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Tax] DROP CONSTRAINT [FK_Tax_SetofBook1]
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [dbo].[Stock]''
');

GO
EXECUTE ('ALTER TABLE [dbo].[Stock] DROP CONSTRAINT [FK_Stock_Item]
');

GO
EXECUTE ('ALTER TABLE [dbo].[Stock] DROP CONSTRAINT [FK_Stock_InventoryOrganization]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [APPS].[Tax]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Tax] DROP CONSTRAINT [PK_Tax]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [dbo].[Stock]''
');

GO
EXECUTE ('ALTER TABLE [dbo].[Stock] DROP CONSTRAINT [PK_Stock]
');

GO
EXECUTE ('PRINT N''Dropping index [CX_Tax] from [APPS].[Tax]''
');

GO
EXECUTE ('DROP INDEX [CX_Tax] ON [APPS].[Tax]
');

GO
EXECUTE ('PRINT N''Dropping index [CX_Stock] from [dbo].[Stock]''
');

GO
EXECUTE ('DROP INDEX [CX_Stock] ON [dbo].[Stock]
');

GO
EXECUTE ('PRINT N''Dropping [dbo].[Stock]''
');

GO
EXECUTE ('DROP TABLE [dbo].[Stock]
');

GO
EXECUTE ('PRINT N''Altering [APPS].[CostCenter]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[CostCenter] ALTER COLUMN [ParentId] [uniqueidentifier] NULL
');

GO
EXECUTE ('PRINT N''Altering [APPS].[UnitOfMeasure]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[UnitOfMeasure] DROP
COLUMN [AllowedPrecision]
');

GO
EXECUTE ('PRINT N''Rebuilding [APPS].[Tax]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[RG_Recovery_1_Tax]
(
[Id] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Disable] [bit] NOT NULL,
[SetOfBookId] [uniqueidentifier] NOT NULL,
[Code] [nvarchar] (50) NOT NULL,
[Name] [nvarchar] (500) NOT NULL,
[Rate] [decimal] (18, 4) NOT NULL,
[Description] [nvarchar] (500) NULL,
[UnitOfMeasureId] [uniqueidentifier] NULL,
[Type] [nvarchar] (50) NOT NULL
)
');

GO
SET IDENTITY_INSERT [APPS].[RG_Recovery_1_Tax] ON

GO
EXECUTE ('INSERT INTO [APPS].[RG_Recovery_1_Tax]([Id], [CX], [Disable], [SetOfBookId], [Code], [Name], [Rate], [Description]) SELECT [Id], [CX], [Disable], [SetOfBookId], [Code], [Name], [Rate], [Description] FROM [APPS].[Tax]
');

GO
SET IDENTITY_INSERT [APPS].[RG_Recovery_1_Tax] OFF

GO
EXECUTE ('DECLARE @idVal BIGINT
SELECT @idVal = IDENT_CURRENT(N''[APPS].[Tax]'')
IF @idVal IS NOT NULL
    DBCC CHECKIDENT(N''[APPS].[RG_Recovery_1_Tax]'', RESEED, @idVal)
');

GO
EXECUTE ('DROP TABLE [APPS].[Tax]
');

GO
EXECUTE ('EXEC sp_rename N''[APPS].[RG_Recovery_1_Tax]'', N''Tax'', N''OBJECT''
');

GO
EXECUTE ('PRINT N''Creating index [CX_Tax] on [APPS].[Tax]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_Tax] ON [APPS].[Tax] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_Tax] on [APPS].[Tax]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Tax] ADD CONSTRAINT [PK_Tax] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Creating [dbo].[InventoryTransaction]''
');

GO
EXECUTE ('CREATE TABLE [dbo].[InventoryTransaction]
(
[Id] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[ChartOfAccountId] [uniqueidentifier] NOT NULL,
[DocumentNumber] [nvarchar] (50) NOT NULL,
[Type] [int] NOT NULL CONSTRAINT [DF_StockDetail_Type] DEFAULT ((0)),
[CostPrice] [decimal] (18, 4) NOT NULL
)
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_StockDetail] on [dbo].[InventoryTransaction]''
');

GO
EXECUTE ('ALTER TABLE [dbo].[InventoryTransaction] ADD CONSTRAINT [PK_StockDetail] PRIMARY KEY CLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[Tax]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Tax] ADD CONSTRAINT [FK_Tax_SetofBook1] FOREIGN KEY ([SetOfBookId]) REFERENCES [APPS].[SetOfBook] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[Tax]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Tax] ADD CONSTRAINT [FK_Tax_UnitOfMeasure] FOREIGN KEY ([UnitOfMeasureId]) REFERENCES [APPS].[UnitOfMeasure] ([Id])
');

GO
EXECUTE ('PRINT N''Creating extended properties''
');

GO
EXECUTE ('EXEC sp_addextendedproperty N''MS_Description'', N''Type = VAT, ENV, IMP, SPEC, TNCN'', ''SCHEMA'', N''APPS'', ''TABLE'', N''Tax'', ''COLUMN'', N''Type''
');

GO
EXECUTE ('EXEC sp_addextendedproperty N''MS_Description'', N''1 = INPUT, 2 = OUTPUT'', ''SCHEMA'', N''dbo'', ''TABLE'', N''InventoryTransaction'', ''COLUMN'', N''Type''
');

GO
SET NOEXEC OFF;

GO
IF N'$(IsSqlCmdEnabled)' <> N'True'
  SET NOEXEC ON;

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('38d4d1f5-5da8-44f0-9e99-bd8c65642f79' AS UNIQUEIDENTIFIER))
  PRINT '***** FINISHED EXECUTING MIGRATION "Migrations\010_20190710-1423_PC.sql", ID: {38d4d1f5-5da8-44f0-9e99-bd8c65642f79} *****
';

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('38d4d1f5-5da8-44f0-9e99-bd8c65642f79' AS UNIQUEIDENTIFIER))
  INSERT [$(DatabaseName)].[dbo].[__MigrationLog] ([migration_id], [script_checksum], [script_filename], [complete_dt], [applied_by], [deployed], [version], [package_version], [release_version])
  VALUES                                         (CAST ('38d4d1f5-5da8-44f0-9e99-bd8c65642f79' AS UNIQUEIDENTIFIER), 'F230C14F73E9778A8DA42DA3A67CBAC5DBB1DE96E96B037807F9053F9E6391F3', 'Migrations\010_20190710-1423_PC.sql', SYSDATETIME(), SYSTEM_USER, 1, NULL, '$(PackageVersion)', CASE '$(ReleaseVersion)' WHEN '' THEN NULL ELSE '$(ReleaseVersion)' END);

GO
SET IMPLICIT_TRANSACTIONS, NUMERIC_ROUNDABORT OFF;
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, NOCOUNT, QUOTED_IDENTIFIER ON;

GO
IF DB_NAME() != '$(DatabaseName)'
  USE [$(DatabaseName)];

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('f094403a-3e11-4d8b-89d0-c680cf302395' AS UNIQUEIDENTIFIER))
  PRINT '

***** EXECUTING MIGRATION "Migrations\011_20190710-1438_PC.sql", ID: {f094403a-3e11-4d8b-89d0-c680cf302395} *****';

GO
IF EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('f094403a-3e11-4d8b-89d0-c680cf302395' AS UNIQUEIDENTIFIER))
BEGIN
  PRINT '----- Skipping "Migrations\011_20190710-1438_PC.sql", ID: {f094403a-3e11-4d8b-89d0-c680cf302395} as it has already been run on this database';
  SET NOEXEC ON;
END

GO
EXECUTE ('
PRINT N''Dropping extended properties''
');

GO
EXECUTE ('EXEC sp_dropextendedproperty N''MS_Description'', ''SCHEMA'', N''APPS'', ''TABLE'', N''FiscalYear'', ''COLUMN'', N''Status''
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [APPS].[FiscalYear]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[FiscalYear] DROP CONSTRAINT [FK_FiscalCalendar_SetofBook]
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [APPS].[AccountingPeriod]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[AccountingPeriod] DROP CONSTRAINT [FK_AccountingPeriod_FiscalYear]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [APPS].[FiscalYear]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[FiscalYear] DROP CONSTRAINT [PK_FiscalCalendar]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [APPS].[FiscalYear]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[FiscalYear] DROP CONSTRAINT [DF_FiscalYear_Status]
');

GO
EXECUTE ('PRINT N''Dropping index [CX_FiscalCalendar] from [APPS].[FiscalYear]''
');

GO
EXECUTE ('DROP INDEX [CX_FiscalCalendar] ON [APPS].[FiscalYear]
');

GO
EXECUTE ('PRINT N''Rebuilding [APPS].[FiscalYear]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[RG_Recovery_1_FiscalYear]
(
[Id] [uniqueidentifier] NOT NULL,
[SetOfBookId] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Disable] [bit] NOT NULL,
[Name] [nvarchar] (500) NOT NULL,
[StartDate] [datetime] NOT NULL,
[EndDate] [datetime] NOT NULL,
[Status] [int] NOT NULL CONSTRAINT [DF_FiscalYear_Status] DEFAULT ((0)),
[InventoryValuationMethod] [nvarchar] (50) NOT NULL
)
');

GO
SET IDENTITY_INSERT [APPS].[RG_Recovery_1_FiscalYear] ON

GO
EXECUTE ('INSERT INTO [APPS].[RG_Recovery_1_FiscalYear]([Id], [SetOfBookId], [CX], [Disable], [Name], [StartDate], [EndDate], [Status]) SELECT [Id], [SetOfBookId], [CX], [Disable], [Name], [StartDate], [EndDate], [Status] FROM [APPS].[FiscalYear]
');

GO
SET IDENTITY_INSERT [APPS].[RG_Recovery_1_FiscalYear] OFF

GO
EXECUTE ('DECLARE @idVal BIGINT
SELECT @idVal = IDENT_CURRENT(N''[APPS].[FiscalYear]'')
IF @idVal IS NOT NULL
    DBCC CHECKIDENT(N''[APPS].[RG_Recovery_1_FiscalYear]'', RESEED, @idVal)
');

GO
EXECUTE ('DROP TABLE [APPS].[FiscalYear]
');

GO
EXECUTE ('EXEC sp_rename N''[APPS].[RG_Recovery_1_FiscalYear]'', N''FiscalYear'', N''OBJECT''
');

GO
EXECUTE ('PRINT N''Creating index [CX_FiscalCalendar] on [APPS].[FiscalYear]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_FiscalCalendar] ON [APPS].[FiscalYear] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_FiscalCalendar] on [APPS].[FiscalYear]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[FiscalYear] ADD CONSTRAINT [PK_FiscalCalendar] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[FiscalYear]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[FiscalYear] ADD CONSTRAINT [FK_FiscalCalendar_SetofBook] FOREIGN KEY ([SetOfBookId]) REFERENCES [APPS].[SetOfBook] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[AccountingPeriod]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[AccountingPeriod] ADD CONSTRAINT [FK_AccountingPeriod_FiscalYear] FOREIGN KEY ([FiscalYearId]) REFERENCES [APPS].[FiscalYear] ([Id])
');

GO
EXECUTE ('PRINT N''Creating extended properties''
');

GO
EXECUTE ('EXEC sp_addextendedproperty N''MS_Description'', N''0 = CLOSED, 1 = OPEN, 2 = UNOPEN'', ''SCHEMA'', N''APPS'', ''TABLE'', N''FiscalYear'', ''COLUMN'', N''Status''
');

GO
SET NOEXEC OFF;

GO
IF N'$(IsSqlCmdEnabled)' <> N'True'
  SET NOEXEC ON;

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('f094403a-3e11-4d8b-89d0-c680cf302395' AS UNIQUEIDENTIFIER))
  PRINT '***** FINISHED EXECUTING MIGRATION "Migrations\011_20190710-1438_PC.sql", ID: {f094403a-3e11-4d8b-89d0-c680cf302395} *****
';

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('f094403a-3e11-4d8b-89d0-c680cf302395' AS UNIQUEIDENTIFIER))
  INSERT [$(DatabaseName)].[dbo].[__MigrationLog] ([migration_id], [script_checksum], [script_filename], [complete_dt], [applied_by], [deployed], [version], [package_version], [release_version])
  VALUES                                         (CAST ('f094403a-3e11-4d8b-89d0-c680cf302395' AS UNIQUEIDENTIFIER), '292368ED39BDA79A317E41A1387211D1FF25EF14E20E1D918FAD51E4446DF32A', 'Migrations\011_20190710-1438_PC.sql', SYSDATETIME(), SYSTEM_USER, 1, NULL, '$(PackageVersion)', CASE '$(ReleaseVersion)' WHEN '' THEN NULL ELSE '$(ReleaseVersion)' END);

GO
SET IMPLICIT_TRANSACTIONS, NUMERIC_ROUNDABORT OFF;
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, NOCOUNT, QUOTED_IDENTIFIER ON;

GO
IF DB_NAME() != '$(DatabaseName)'
  USE [$(DatabaseName)];

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('74e2f742-91e2-4515-a390-725130d8e412' AS UNIQUEIDENTIFIER))
  PRINT '

***** EXECUTING MIGRATION "Migrations\012_20190712-1027_PC.sql", ID: {74e2f742-91e2-4515-a390-725130d8e412} *****';

GO
IF EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('74e2f742-91e2-4515-a390-725130d8e412' AS UNIQUEIDENTIFIER))
BEGIN
  PRINT '----- Skipping "Migrations\012_20190712-1027_PC.sql", ID: {74e2f742-91e2-4515-a390-725130d8e412} as it has already been run on this database';
  SET NOEXEC ON;
END

GO
EXECUTE ('
PRINT N''Altering [APPS].[COATemplateDetail]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[COATemplateDetail] ADD
[ParentId] [uniqueidentifier] NULL
');

GO
SET NOEXEC OFF;

GO
IF N'$(IsSqlCmdEnabled)' <> N'True'
  SET NOEXEC ON;

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('74e2f742-91e2-4515-a390-725130d8e412' AS UNIQUEIDENTIFIER))
  PRINT '***** FINISHED EXECUTING MIGRATION "Migrations\012_20190712-1027_PC.sql", ID: {74e2f742-91e2-4515-a390-725130d8e412} *****
';

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('74e2f742-91e2-4515-a390-725130d8e412' AS UNIQUEIDENTIFIER))
  INSERT [$(DatabaseName)].[dbo].[__MigrationLog] ([migration_id], [script_checksum], [script_filename], [complete_dt], [applied_by], [deployed], [version], [package_version], [release_version])
  VALUES                                         (CAST ('74e2f742-91e2-4515-a390-725130d8e412' AS UNIQUEIDENTIFIER), '5B7252C469C3BCE74EB108524A4CD70B8780780A2D5836DFEB91C0FFC5A42D00', 'Migrations\012_20190712-1027_PC.sql', SYSDATETIME(), SYSTEM_USER, 1, NULL, '$(PackageVersion)', CASE '$(ReleaseVersion)' WHEN '' THEN NULL ELSE '$(ReleaseVersion)' END);

GO
SET IMPLICIT_TRANSACTIONS, NUMERIC_ROUNDABORT OFF;
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, NOCOUNT, QUOTED_IDENTIFIER ON;

GO
IF DB_NAME() != '$(DatabaseName)'
  USE [$(DatabaseName)];

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('3ac0a57f-f205-47d8-8dfb-e38e09667530' AS UNIQUEIDENTIFIER))
  PRINT '

***** EXECUTING MIGRATION "Migrations\013_20190713-1004_PC.sql", ID: {3ac0a57f-f205-47d8-8dfb-e38e09667530} *****';

GO
IF EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('3ac0a57f-f205-47d8-8dfb-e38e09667530' AS UNIQUEIDENTIFIER))
BEGIN
  PRINT '----- Skipping "Migrations\013_20190713-1004_PC.sql", ID: {3ac0a57f-f205-47d8-8dfb-e38e09667530} as it has already been run on this database';
  SET NOEXEC ON;
END

GO
EXECUTE ('
PRINT N''Dropping foreign keys from [APPSYS].[User]''
');

GO
EXECUTE ('ALTER TABLE [APPSYS].[User] DROP CONSTRAINT [FK_User_Employee]
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [HR].[EmployeePosition]''
');

GO
EXECUTE ('ALTER TABLE [HR].[EmployeePosition] DROP CONSTRAINT [FK_EmployeeGroup_Employee]
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [HR].[JobHistory]''
');

GO
EXECUTE ('ALTER TABLE [HR].[JobHistory] DROP CONSTRAINT [FK_JobHistory_Employee]
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [dbo].[StockAdjustment]''
');

GO
EXECUTE ('ALTER TABLE [dbo].[StockAdjustment] DROP CONSTRAINT [FK_StockAdjustment_Employee]
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [dbo].[StockRequest]''
');

GO
EXECUTE ('ALTER TABLE [dbo].[StockRequest] DROP CONSTRAINT [FK_StockRequest_Employee]
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [HR].[Employee]''
');

GO
EXECUTE ('ALTER TABLE [HR].[Employee] DROP CONSTRAINT [FK_Employee_BusinessGroup]
');

GO
EXECUTE ('ALTER TABLE [HR].[Employee] DROP CONSTRAINT [FK_Employee_JobTitle]
');

GO
EXECUTE ('ALTER TABLE [HR].[Employee] DROP CONSTRAINT [FK_Employee_JobLevel]
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [HR].[JobLevel]''
');

GO
EXECUTE ('ALTER TABLE [HR].[JobLevel] DROP CONSTRAINT [FK_JobLevel_BusinessGroup]
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [HR].[JobTitle]''
');

GO
EXECUTE ('ALTER TABLE [HR].[JobTitle] DROP CONSTRAINT [FK_JobTitle_BusinessGroup]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [AP].[Supplier]''
');

GO
EXECUTE ('ALTER TABLE [AP].[Supplier] DROP CONSTRAINT [PK_Supplier]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [AR].[Customer]''
');

GO
EXECUTE ('ALTER TABLE [AR].[Customer] DROP CONSTRAINT [PK_Customer]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [HR].[Employee]''
');

GO
EXECUTE ('ALTER TABLE [HR].[Employee] DROP CONSTRAINT [PK_Employee]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [HR].[JobLevel]''
');

GO
EXECUTE ('ALTER TABLE [HR].[JobLevel] DROP CONSTRAINT [PK_JobLevel]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [HR].[JobTitle]''
');

GO
EXECUTE ('ALTER TABLE [HR].[JobTitle] DROP CONSTRAINT [PK_JobTitle]
');

GO
EXECUTE ('PRINT N''Dropping index [CX_Supplier] from [AP].[Supplier]''
');

GO
EXECUTE ('DROP INDEX [CX_Supplier] ON [AP].[Supplier]
');

GO
EXECUTE ('PRINT N''Dropping index [CX_Employee] from [HR].[Employee]''
');

GO
EXECUTE ('DROP INDEX [CX_Employee] ON [HR].[Employee]
');

GO
EXECUTE ('PRINT N''Dropping index [CX_JobLevel] from [HR].[JobLevel]''
');

GO
EXECUTE ('DROP INDEX [CX_JobLevel] ON [HR].[JobLevel]
');

GO
EXECUTE ('PRINT N''Dropping index [CX_JobTitle] from [HR].[JobTitle]''
');

GO
EXECUTE ('DROP INDEX [CX_JobTitle] ON [HR].[JobTitle]
');

GO
EXECUTE ('PRINT N''Dropping [AR].[Customer]''
');

GO
EXECUTE ('DROP TABLE [AR].[Customer]
');

GO
EXECUTE ('PRINT N''Dropping [AP].[Supplier]''
');

GO
EXECUTE ('DROP TABLE [AP].[Supplier]
');

GO
EXECUTE ('PRINT N''Dropping [HR].[JobTitle]''
');

GO
EXECUTE ('DROP TABLE [HR].[JobTitle]
');

GO
EXECUTE ('PRINT N''Dropping [HR].[JobLevel]''
');

GO
EXECUTE ('DROP TABLE [HR].[JobLevel]
');

GO
EXECUTE ('PRINT N''Dropping [HR].[Employee]''
');

GO
EXECUTE ('DROP TABLE [HR].[Employee]
');

GO
EXECUTE ('PRINT N''Creating [APPS].[Employee]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[Employee]
(
[Id] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Code] [nvarchar] (50) NOT NULL,
[DisplayName] [nvarchar] (200) NULL,
[PrimaryEmail] [nvarchar] (500) NULL,
[AlternativeEmail] [nvarchar] (500) NULL,
[BusinessGroupId] [uniqueidentifier] NOT NULL,
[JobTitleId] [uniqueidentifier] NOT NULL,
[JobLevelId] [uniqueidentifier] NOT NULL,
[JoinDate] [date] NOT NULL,
[EffectiveDate] [date] NULL,
[EndDate] [date] NULL,
[Status] [int] NOT NULL,
[Disable] [bit] NOT NULL
)
');

GO
EXECUTE ('PRINT N''Creating index [CX_Employee] on [APPS].[Employee]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_Employee] ON [APPS].[Employee] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_Employee] on [APPS].[Employee]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Employee] ADD CONSTRAINT [PK_Employee] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Creating [APPS].[JobLevel]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[JobLevel]
(
[Id] [uniqueidentifier] NOT NULL,
[BusinessGroupId] [uniqueidentifier] NOT NULL,
[Level] [float] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Disable] [bit] NOT NULL
)
');

GO
EXECUTE ('PRINT N''Creating index [CX_JobLevel] on [APPS].[JobLevel]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_JobLevel] ON [APPS].[JobLevel] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_JobLevel] on [APPS].[JobLevel]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[JobLevel] ADD CONSTRAINT [PK_JobLevel] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Creating [APPS].[JobTitle]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[JobTitle]
(
[Id] [uniqueidentifier] NOT NULL,
[BusinessGroupId] [uniqueidentifier] NOT NULL,
[Code] [nvarchar] (50) NULL,
[Name] [nvarchar] (500) NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Disable] [bit] NOT NULL
)
');

GO
EXECUTE ('PRINT N''Creating index [CX_JobTitle] on [APPS].[JobTitle]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_JobTitle] ON [APPS].[JobTitle] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_JobTitle] on [APPS].[JobTitle]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[JobTitle] ADD CONSTRAINT [PK_JobTitle] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Creating [APPS].[Customer]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[Customer]
(
[Id] [uniqueidentifier] NOT NULL,
[BusinessGroupId] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Disable] [bit] NOT NULL,
[Code] [nvarchar] (50) NOT NULL,
[Name] [nvarchar] (500) NOT NULL
)
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_Customer] on [APPS].[Customer]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Customer] ADD CONSTRAINT [PK_Customer] PRIMARY KEY CLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Creating [APPS].[Supplier]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[Supplier]
(
[Id] [uniqueidentifier] NOT NULL,
[TaxCode] [nvarchar] (50) NULL,
[Name] [nvarchar] (500) NULL,
[BusinessGroupId] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1)
)
');

GO
EXECUTE ('PRINT N''Creating index [CX_Supplier] on [APPS].[Supplier]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_Supplier] ON [APPS].[Supplier] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_Supplier] on [APPS].[Supplier]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Supplier] ADD CONSTRAINT [PK_Supplier] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPSYS].[User]''
');

GO
EXECUTE ('ALTER TABLE [APPSYS].[User] ADD CONSTRAINT [FK_User_Employee] FOREIGN KEY ([EmployeeId]) REFERENCES [APPS].[Employee] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [HR].[EmployeePosition]''
');

GO
EXECUTE ('ALTER TABLE [HR].[EmployeePosition] ADD CONSTRAINT [FK_EmployeeGroup_Employee] FOREIGN KEY ([EmployeeId]) REFERENCES [APPS].[Employee] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [HR].[JobHistory]''
');

GO
EXECUTE ('ALTER TABLE [HR].[JobHistory] ADD CONSTRAINT [FK_JobHistory_Employee] FOREIGN KEY ([EmployeeId]) REFERENCES [APPS].[Employee] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [dbo].[StockAdjustment]''
');

GO
EXECUTE ('ALTER TABLE [dbo].[StockAdjustment] ADD CONSTRAINT [FK_StockAdjustment_Employee] FOREIGN KEY ([RequesterId]) REFERENCES [APPS].[Employee] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [dbo].[StockRequest]''
');

GO
EXECUTE ('ALTER TABLE [dbo].[StockRequest] ADD CONSTRAINT [FK_StockRequest_Employee] FOREIGN KEY ([RequesterId]) REFERENCES [APPS].[Employee] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[Employee]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Employee] ADD CONSTRAINT [FK_Employee_BusinessGroup] FOREIGN KEY ([BusinessGroupId]) REFERENCES [APPS].[BusinessGroup] ([Id])
');

GO
EXECUTE ('ALTER TABLE [APPS].[Employee] ADD CONSTRAINT [FK_Employee_JobTitle] FOREIGN KEY ([JobTitleId]) REFERENCES [APPS].[JobTitle] ([Id])
');

GO
EXECUTE ('ALTER TABLE [APPS].[Employee] ADD CONSTRAINT [FK_Employee_JobLevel] FOREIGN KEY ([JobLevelId]) REFERENCES [APPS].[JobLevel] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[JobLevel]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[JobLevel] ADD CONSTRAINT [FK_JobLevel_BusinessGroup] FOREIGN KEY ([BusinessGroupId]) REFERENCES [APPS].[BusinessGroup] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[JobTitle]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[JobTitle] ADD CONSTRAINT [FK_JobTitle_BusinessGroup] FOREIGN KEY ([BusinessGroupId]) REFERENCES [APPS].[BusinessGroup] ([Id])
');

GO
SET NOEXEC OFF;

GO
IF N'$(IsSqlCmdEnabled)' <> N'True'
  SET NOEXEC ON;

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('3ac0a57f-f205-47d8-8dfb-e38e09667530' AS UNIQUEIDENTIFIER))
  PRINT '***** FINISHED EXECUTING MIGRATION "Migrations\013_20190713-1004_PC.sql", ID: {3ac0a57f-f205-47d8-8dfb-e38e09667530} *****
';

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('3ac0a57f-f205-47d8-8dfb-e38e09667530' AS UNIQUEIDENTIFIER))
  INSERT [$(DatabaseName)].[dbo].[__MigrationLog] ([migration_id], [script_checksum], [script_filename], [complete_dt], [applied_by], [deployed], [version], [package_version], [release_version])
  VALUES                                         (CAST ('3ac0a57f-f205-47d8-8dfb-e38e09667530' AS UNIQUEIDENTIFIER), '228F11CF6A66C72F8A5E5B057E7C1D060FDE9D798B9710AF1D6C04088190B095', 'Migrations\013_20190713-1004_PC.sql', SYSDATETIME(), SYSTEM_USER, 1, NULL, '$(PackageVersion)', CASE '$(ReleaseVersion)' WHEN '' THEN NULL ELSE '$(ReleaseVersion)' END);

GO
SET IMPLICIT_TRANSACTIONS, NUMERIC_ROUNDABORT OFF;
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, NOCOUNT, QUOTED_IDENTIFIER ON;

GO
IF DB_NAME() != '$(DatabaseName)'
  USE [$(DatabaseName)];

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('04cd6b05-ee50-4ad6-859d-8f43f6a858bc' AS UNIQUEIDENTIFIER))
  PRINT '

***** EXECUTING MIGRATION "Migrations\014_20190713-1813_PC.sql", ID: {04cd6b05-ee50-4ad6-859d-8f43f6a858bc} *****';

GO
IF EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('04cd6b05-ee50-4ad6-859d-8f43f6a858bc' AS UNIQUEIDENTIFIER))
BEGIN
  PRINT '----- Skipping "Migrations\014_20190713-1813_PC.sql", ID: {04cd6b05-ee50-4ad6-859d-8f43f6a858bc} as it has already been run on this database';
  SET NOEXEC ON;
END

GO
EXECUTE ('
PRINT N''Dropping foreign keys from [APPS].[Employee]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Employee] DROP CONSTRAINT [FK_Employee_BusinessGroup]
');

GO
EXECUTE ('ALTER TABLE [APPS].[Employee] DROP CONSTRAINT [FK_Employee_JobLevel]
');

GO
EXECUTE ('ALTER TABLE [APPS].[Employee] DROP CONSTRAINT [FK_Employee_JobTitle]
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [HR].[EmployeePosition]''
');

GO
EXECUTE ('ALTER TABLE [HR].[EmployeePosition] DROP CONSTRAINT [FK_EmployeeGroup_Employee]
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [HR].[JobHistory]''
');

GO
EXECUTE ('ALTER TABLE [HR].[JobHistory] DROP CONSTRAINT [FK_JobHistory_Employee]
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [dbo].[StockAdjustment]''
');

GO
EXECUTE ('ALTER TABLE [dbo].[StockAdjustment] DROP CONSTRAINT [FK_StockAdjustment_Employee]
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [dbo].[StockRequest]''
');

GO
EXECUTE ('ALTER TABLE [dbo].[StockRequest] DROP CONSTRAINT [FK_StockRequest_Employee]
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [APPSYS].[User]''
');

GO
EXECUTE ('ALTER TABLE [APPSYS].[User] DROP CONSTRAINT [FK_User_Employee]
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [APPS].[UnitOfMeasure]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[UnitOfMeasure] DROP CONSTRAINT [FK_UnitOfMeasure_BusinessGroup]
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [dbo].[StockRequestDetail]''
');

GO
EXECUTE ('ALTER TABLE [dbo].[StockRequestDetail] DROP CONSTRAINT [FK_StockRequestDetail_UnitOfMeasure]
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [APPS].[Tax]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Tax] DROP CONSTRAINT [FK_Tax_UnitOfMeasure]
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [APPS].[TaxTemplateDetail]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[TaxTemplateDetail] DROP CONSTRAINT [FK_TaxTemplateDetail_UnitOfMeasure]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [APPS].[Employee]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Employee] DROP CONSTRAINT [PK_Employee]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [APPS].[UnitOfMeasure]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[UnitOfMeasure] DROP CONSTRAINT [PK_UOM]
');

GO
EXECUTE ('PRINT N''Dropping index [CX_Employee] from [APPS].[Employee]''
');

GO
EXECUTE ('DROP INDEX [CX_Employee] ON [APPS].[Employee]
');

GO
EXECUTE ('PRINT N''Dropping index [CX_UnitOfMeasure] from [APPS].[UnitOfMeasure]''
');

GO
EXECUTE ('DROP INDEX [CX_UnitOfMeasure] ON [APPS].[UnitOfMeasure]
');

GO
EXECUTE ('PRINT N''Altering [APPS].[BusinessGroup]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[BusinessGroup] ADD
[Description] [nvarchar] (500) NULL
');

GO
EXECUTE ('PRINT N''Altering [APPS].[Bank]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Bank] ADD
[Description] [nvarchar] (500) NULL
');

GO
EXECUTE ('PRINT N''Altering [APPS].[Currency]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Currency] ADD
[Description] [nvarchar] (500) NULL
');

GO
EXECUTE ('PRINT N''Altering [APPS].[Customer]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Customer] ADD
[Address] [nvarchar] (500) NULL,
[TaxCode] [nvarchar] (100) NULL,
[Description] [nvarchar] (500) NULL
');

GO
EXECUTE ('PRINT N''Creating [dbo].[CustomerReceiver]''
');

GO
EXECUTE ('CREATE TABLE [dbo].[CustomerReceiver]
(
[Id] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Name] [nvarchar] (100) NOT NULL,
[Email] [nvarchar] (100) NULL,
[Phone] [nvarchar] (20) NOT NULL,
[Address] [nvarchar] (500) NULL,
[CustomerId] [uniqueidentifier] NOT NULL
)
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_CustomerReceiver] on [dbo].[CustomerReceiver]''
');

GO
EXECUTE ('ALTER TABLE [dbo].[CustomerReceiver] ADD CONSTRAINT [PK_CustomerReceiver] PRIMARY KEY CLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Creating [APPS].[CustomerBankAccount]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[CustomerBankAccount]
(
[Id] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Name] [nchar] (10) NOT NULL,
[CustomerId] [uniqueidentifier] NOT NULL,
[BankId] [uniqueidentifier] NOT NULL,
[BankAccountName] [nvarchar] (50) NULL,
[Branch] [nvarchar] (500) NULL,
[ProvinceId] [uniqueidentifier] NOT NULL
)
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_CustomerBankAccount] on [APPS].[CustomerBankAccount]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[CustomerBankAccount] ADD CONSTRAINT [PK_CustomerBankAccount] PRIMARY KEY CLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Creating [APPS].[Province]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[Province]
(
[Id] [uniqueidentifier] NOT NULL,
[Name] [nvarchar] (100) NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1)
)
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_Province] on [APPS].[Province]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Province] ADD CONSTRAINT [PK_Province] PRIMARY KEY CLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Creating [APPS].[CustomerContact]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[CustomerContact]
(
[Id] [uniqueidentifier] NOT NULL,
[CustomerId] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Phone] [nvarchar] (20) NOT NULL,
[Email] [nvarchar] (100) NULL,
[Address] [nvarchar] (500) NULL,
[Name] [nvarchar] (500) NOT NULL
)
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_CustomerContact] on [APPS].[CustomerContact]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[CustomerContact] ADD CONSTRAINT [PK_CustomerContact] PRIMARY KEY CLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Rebuilding [APPS].[Employee]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[RG_Recovery_1_Employee]
(
[Id] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Code] [nchar] (5) NOT NULL,
[DisplayName] [nvarchar] (100) NOT NULL,
[PrimaryEmail] [nvarchar] (500) NULL,
[AlternativeEmail] [nvarchar] (500) NULL,
[BusinessGroupId] [uniqueidentifier] NOT NULL,
[JobTitleId] [uniqueidentifier] NOT NULL,
[JobLevelId] [uniqueidentifier] NOT NULL,
[JoinDate] [date] NOT NULL,
[EffectiveDate] [date] NULL,
[EndDate] [date] NULL,
[Status] [int] NOT NULL,
[Disable] [bit] NOT NULL,
[Gender] [bit] NOT NULL,
[IdNumber] [nvarchar] (20) NULL,
[IssueDate] [date] NULL,
[IssueLocation] [nvarchar] (100) NULL,
[TaxCode] [nvarchar] (100) NULL,
[Salary] [bigint] NULL,
[SalaryFactor] [float] NULL,
[InsuranceSalary] [bigint] NULL,
[NoDependentPerson] [int] NULL,
[BankId] [uniqueidentifier] NULL,
[BankAccount] [nvarchar] (50) NULL,
[BankAccountName] [nvarchar] (50) NULL,
[BankBranch] [nvarchar] (50) NULL,
[BankAddress] [nvarchar] (50) NULL,
[Phone] [nvarchar] (20) NULL,
[ProvinceId] [uniqueidentifier] NULL,
[Description] [nvarchar] (500) NULL
)
');

GO
SET IDENTITY_INSERT [APPS].[RG_Recovery_1_Employee] ON

GO
EXECUTE ('INSERT INTO [APPS].[RG_Recovery_1_Employee]([Id], [CX], [Code], [DisplayName], [PrimaryEmail], [AlternativeEmail], [BusinessGroupId], [JobTitleId], [JobLevelId], [JoinDate], [EffectiveDate], [EndDate], [Status], [Disable]) SELECT [Id], [CX], [Code], [DisplayName], [PrimaryEmail], [AlternativeEmail], [BusinessGroupId], [JobTitleId], [JobLevelId], [JoinDate], [EffectiveDate], [EndDate], [Status], [Disable] FROM [APPS].[Employee]
');

GO
SET IDENTITY_INSERT [APPS].[RG_Recovery_1_Employee] OFF

GO
EXECUTE ('DECLARE @idVal BIGINT
SELECT @idVal = IDENT_CURRENT(N''[APPS].[Employee]'')
IF @idVal IS NOT NULL
    DBCC CHECKIDENT(N''[APPS].[RG_Recovery_1_Employee]'', RESEED, @idVal)
');

GO
EXECUTE ('DROP TABLE [APPS].[Employee]
');

GO
EXECUTE ('EXEC sp_rename N''[APPS].[RG_Recovery_1_Employee]'', N''Employee'', N''OBJECT''
');

GO
EXECUTE ('PRINT N''Creating index [CX_Employee] on [APPS].[Employee]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_Employee] ON [APPS].[Employee] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_Employee] on [APPS].[Employee]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Employee] ADD CONSTRAINT [PK_Employee] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Altering [APPS].[JobLevel]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[JobLevel] ADD
[Description] [nvarchar] (500) NULL
');

GO
EXECUTE ('PRINT N''Altering [APPS].[JobTitle]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[JobTitle] ADD
[Description] [nvarchar] (500) NULL
');

GO
EXECUTE ('ALTER TABLE [APPS].[JobTitle] ALTER COLUMN [Code] [nvarchar] (50) NOT NULL
');

GO
EXECUTE ('PRINT N''Creating [APPS].[EmployeeContact]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[EmployeeContact]
(
[Id] [uniqueidentifier] NOT NULL,
[EmployeeId] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Name] [nvarchar] (50) NOT NULL,
[Email] [nvarchar] (50) NULL,
[Phone] [nvarchar] (50) NOT NULL,
[Address] [nvarchar] (500) NULL
)
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_EmployeeContact] on [APPS].[EmployeeContact]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[EmployeeContact] ADD CONSTRAINT [PK_EmployeeContact] PRIMARY KEY CLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Rebuilding [APPS].[UnitOfMeasure]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[RG_Recovery_2_UnitOfMeasure]
(
[Id] [uniqueidentifier] NOT NULL,
[Name] [nvarchar] (50) NOT NULL,
[Type] [nvarchar] (50) NOT NULL,
[BusinessGroupId] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Disable] [bit] NOT NULL,
[Code] [nvarchar] (10) NOT NULL,
[Description] [nvarchar] (500) NULL
)
');

GO
SET IDENTITY_INSERT [APPS].[RG_Recovery_2_UnitOfMeasure] ON

GO
EXECUTE ('INSERT INTO [APPS].[RG_Recovery_2_UnitOfMeasure]([Id], [Name], [Type], [BusinessGroupId], [CX], [Disable]) SELECT [Id], [Name], [Type], [BusinessGroupId], [CX], [Disable] FROM [APPS].[UnitOfMeasure]
');

GO
SET IDENTITY_INSERT [APPS].[RG_Recovery_2_UnitOfMeasure] OFF

GO
EXECUTE ('DECLARE @idVal BIGINT
SELECT @idVal = IDENT_CURRENT(N''[APPS].[UnitOfMeasure]'')
IF @idVal IS NOT NULL
    DBCC CHECKIDENT(N''[APPS].[RG_Recovery_2_UnitOfMeasure]'', RESEED, @idVal)
');

GO
EXECUTE ('DROP TABLE [APPS].[UnitOfMeasure]
');

GO
EXECUTE ('EXEC sp_rename N''[APPS].[RG_Recovery_2_UnitOfMeasure]'', N''UnitOfMeasure'', N''OBJECT''
');

GO
EXECUTE ('PRINT N''Creating index [CX_UnitOfMeasure] on [APPS].[UnitOfMeasure]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_UnitOfMeasure] ON [APPS].[UnitOfMeasure] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_UOM] on [APPS].[UnitOfMeasure]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[UnitOfMeasure] ADD CONSTRAINT [PK_UOM] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[Employee]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Employee] ADD CONSTRAINT [FK_Employee_BusinessGroup] FOREIGN KEY ([BusinessGroupId]) REFERENCES [APPS].[BusinessGroup] ([Id])
');

GO
EXECUTE ('ALTER TABLE [APPS].[Employee] ADD CONSTRAINT [FK_Employee_JobLevel] FOREIGN KEY ([JobLevelId]) REFERENCES [APPS].[JobLevel] ([Id])
');

GO
EXECUTE ('ALTER TABLE [APPS].[Employee] ADD CONSTRAINT [FK_Employee_JobTitle] FOREIGN KEY ([JobTitleId]) REFERENCES [APPS].[JobTitle] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[UnitOfMeasure]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[UnitOfMeasure] ADD CONSTRAINT [FK_UnitOfMeasure_BusinessGroup] FOREIGN KEY ([BusinessGroupId]) REFERENCES [APPS].[BusinessGroup] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[CustomerBankAccount]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[CustomerBankAccount] ADD CONSTRAINT [FK_CustomerBankAccount_Customer] FOREIGN KEY ([CustomerId]) REFERENCES [APPS].[Customer] ([Id])
');

GO
EXECUTE ('ALTER TABLE [APPS].[CustomerBankAccount] ADD CONSTRAINT [FK_CustomerBankAccount_Province] FOREIGN KEY ([ProvinceId]) REFERENCES [APPS].[Province] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[CustomerContact]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[CustomerContact] ADD CONSTRAINT [FK_CustomerContact_Customer] FOREIGN KEY ([CustomerId]) REFERENCES [APPS].[Customer] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[Customer]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Customer] ADD CONSTRAINT [FK_Customer_BusinessGroup] FOREIGN KEY ([BusinessGroupId]) REFERENCES [APPS].[BusinessGroup] ([Id])
');

GO
EXECUTE ('ALTER TABLE [APPS].[Customer] ADD CONSTRAINT [FK_Customer_CustomerReceiver] FOREIGN KEY ([Id]) REFERENCES [dbo].[CustomerReceiver] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[EmployeeContact]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[EmployeeContact] ADD CONSTRAINT [FK_EmployeeContact_Employee] FOREIGN KEY ([EmployeeId]) REFERENCES [APPS].[Employee] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[Employee]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Employee] ADD CONSTRAINT [FK_Employee_Bank] FOREIGN KEY ([BankId]) REFERENCES [APPS].[Bank] ([Id])
');

GO
EXECUTE ('ALTER TABLE [APPS].[Employee] ADD CONSTRAINT [FK_Employee_Province] FOREIGN KEY ([ProvinceId]) REFERENCES [APPS].[Province] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [HR].[EmployeePosition]''
');

GO
EXECUTE ('ALTER TABLE [HR].[EmployeePosition] ADD CONSTRAINT [FK_EmployeeGroup_Employee] FOREIGN KEY ([EmployeeId]) REFERENCES [APPS].[Employee] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [HR].[JobHistory]''
');

GO
EXECUTE ('ALTER TABLE [HR].[JobHistory] ADD CONSTRAINT [FK_JobHistory_Employee] FOREIGN KEY ([EmployeeId]) REFERENCES [APPS].[Employee] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [dbo].[StockAdjustment]''
');

GO
EXECUTE ('ALTER TABLE [dbo].[StockAdjustment] ADD CONSTRAINT [FK_StockAdjustment_Employee] FOREIGN KEY ([RequesterId]) REFERENCES [APPS].[Employee] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [dbo].[StockRequest]''
');

GO
EXECUTE ('ALTER TABLE [dbo].[StockRequest] ADD CONSTRAINT [FK_StockRequest_Employee] FOREIGN KEY ([RequesterId]) REFERENCES [APPS].[Employee] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPSYS].[User]''
');

GO
EXECUTE ('ALTER TABLE [APPSYS].[User] ADD CONSTRAINT [FK_User_Employee] FOREIGN KEY ([EmployeeId]) REFERENCES [APPS].[Employee] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [dbo].[StockRequestDetail]''
');

GO
EXECUTE ('ALTER TABLE [dbo].[StockRequestDetail] ADD CONSTRAINT [FK_StockRequestDetail_UnitOfMeasure] FOREIGN KEY ([UnitOfMeasureId]) REFERENCES [APPS].[UnitOfMeasure] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[Tax]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Tax] ADD CONSTRAINT [FK_Tax_UnitOfMeasure] FOREIGN KEY ([UnitOfMeasureId]) REFERENCES [APPS].[UnitOfMeasure] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[TaxTemplateDetail]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[TaxTemplateDetail] ADD CONSTRAINT [FK_TaxTemplateDetail_UnitOfMeasure] FOREIGN KEY ([UnitOfMeasureId]) REFERENCES [APPS].[UnitOfMeasure] ([Id])
');

GO
EXECUTE ('PRINT N''Creating extended properties''
');

GO
EXECUTE ('EXEC sp_addextendedproperty N''MS_Description'', N''Bank Account of employee'', ''SCHEMA'', N''APPS'', ''TABLE'', N''Employee'', ''COLUMN'', N''BankAccount''
');

GO
SET NOEXEC OFF;

GO
IF N'$(IsSqlCmdEnabled)' <> N'True'
  SET NOEXEC ON;

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('04cd6b05-ee50-4ad6-859d-8f43f6a858bc' AS UNIQUEIDENTIFIER))
  PRINT '***** FINISHED EXECUTING MIGRATION "Migrations\014_20190713-1813_PC.sql", ID: {04cd6b05-ee50-4ad6-859d-8f43f6a858bc} *****
';

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('04cd6b05-ee50-4ad6-859d-8f43f6a858bc' AS UNIQUEIDENTIFIER))
  INSERT [$(DatabaseName)].[dbo].[__MigrationLog] ([migration_id], [script_checksum], [script_filename], [complete_dt], [applied_by], [deployed], [version], [package_version], [release_version])
  VALUES                                         (CAST ('04cd6b05-ee50-4ad6-859d-8f43f6a858bc' AS UNIQUEIDENTIFIER), 'BF1E01B64616352EB5DB6F927E75F08EB4B2DD25799E1E47A3D6921F088FD566', 'Migrations\014_20190713-1813_PC.sql', SYSDATETIME(), SYSTEM_USER, 1, NULL, '$(PackageVersion)', CASE '$(ReleaseVersion)' WHEN '' THEN NULL ELSE '$(ReleaseVersion)' END);

GO
SET IMPLICIT_TRANSACTIONS, NUMERIC_ROUNDABORT OFF;
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, NOCOUNT, QUOTED_IDENTIFIER ON;

GO
IF DB_NAME() != '$(DatabaseName)'
  USE [$(DatabaseName)];

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('c96c86b3-bfe6-4929-9f40-5036ed8ee391' AS UNIQUEIDENTIFIER))
  PRINT '

***** EXECUTING MIGRATION "Migrations\015_20190715-0953_PC.sql", ID: {c96c86b3-bfe6-4929-9f40-5036ed8ee391} *****';

GO
IF EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('c96c86b3-bfe6-4929-9f40-5036ed8ee391' AS UNIQUEIDENTIFIER))
BEGIN
  PRINT '----- Skipping "Migrations\015_20190715-0953_PC.sql", ID: {c96c86b3-bfe6-4929-9f40-5036ed8ee391} as it has already been run on this database';
  SET NOEXEC ON;
END

GO
EXECUTE ('
PRINT N''Dropping foreign keys from [APPS].[Customer]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Customer] DROP CONSTRAINT [FK_Customer_CustomerReceiver]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [dbo].[CustomerReceiver]''
');

GO
EXECUTE ('ALTER TABLE [dbo].[CustomerReceiver] DROP CONSTRAINT [PK_CustomerReceiver]
');

GO
EXECUTE ('PRINT N''Dropping [dbo].[CustomerReceiver]''
');

GO
EXECUTE ('DROP TABLE [dbo].[CustomerReceiver]
');

GO
EXECUTE ('PRINT N''Creating [APPS].[CustomerReceiver]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[CustomerReceiver]
(
[Id] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Name] [nvarchar] (100) NOT NULL,
[Email] [nvarchar] (100) NULL,
[Phone] [nvarchar] (20) NOT NULL,
[Address] [nvarchar] (500) NULL,
[CustomerId] [uniqueidentifier] NOT NULL
)
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_CustomerReceiver] on [APPS].[CustomerReceiver]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[CustomerReceiver] ADD CONSTRAINT [PK_CustomerReceiver] PRIMARY KEY CLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[Customer]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Customer] ADD CONSTRAINT [FK_Customer_CustomerReceiver] FOREIGN KEY ([Id]) REFERENCES [APPS].[CustomerReceiver] ([Id])
');

GO
SET NOEXEC OFF;

GO
IF N'$(IsSqlCmdEnabled)' <> N'True'
  SET NOEXEC ON;

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('c96c86b3-bfe6-4929-9f40-5036ed8ee391' AS UNIQUEIDENTIFIER))
  PRINT '***** FINISHED EXECUTING MIGRATION "Migrations\015_20190715-0953_PC.sql", ID: {c96c86b3-bfe6-4929-9f40-5036ed8ee391} *****
';

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('c96c86b3-bfe6-4929-9f40-5036ed8ee391' AS UNIQUEIDENTIFIER))
  INSERT [$(DatabaseName)].[dbo].[__MigrationLog] ([migration_id], [script_checksum], [script_filename], [complete_dt], [applied_by], [deployed], [version], [package_version], [release_version])
  VALUES                                         (CAST ('c96c86b3-bfe6-4929-9f40-5036ed8ee391' AS UNIQUEIDENTIFIER), '415CA1AD72D77C5DBE4ACA395605AE8BE39A29574362FCFA06837A88EDC3687F', 'Migrations\015_20190715-0953_PC.sql', SYSDATETIME(), SYSTEM_USER, 1, NULL, '$(PackageVersion)', CASE '$(ReleaseVersion)' WHEN '' THEN NULL ELSE '$(ReleaseVersion)' END);

GO
SET IMPLICIT_TRANSACTIONS, NUMERIC_ROUNDABORT OFF;
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, NOCOUNT, QUOTED_IDENTIFIER ON;

GO
IF DB_NAME() != '$(DatabaseName)'
  USE [$(DatabaseName)];

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('a3421d16-1bd4-4efd-abd6-392706be463b' AS UNIQUEIDENTIFIER))
  PRINT '

***** EXECUTING MIGRATION "Migrations\016_20190715-1040_PC.sql", ID: {a3421d16-1bd4-4efd-abd6-392706be463b} *****';

GO
IF EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('a3421d16-1bd4-4efd-abd6-392706be463b' AS UNIQUEIDENTIFIER))
BEGIN
  PRINT '----- Skipping "Migrations\016_20190715-1040_PC.sql", ID: {a3421d16-1bd4-4efd-abd6-392706be463b} as it has already been run on this database';
  SET NOEXEC ON;
END

GO
EXECUTE ('
PRINT N''Dropping foreign keys from [APPS].[CustomerBankAccount]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[CustomerBankAccount] DROP CONSTRAINT [FK_CustomerBankAccount_Customer]
');

GO
EXECUTE ('ALTER TABLE [APPS].[CustomerBankAccount] DROP CONSTRAINT [FK_CustomerBankAccount_Province]
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [APPS].[Customer]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Customer] DROP CONSTRAINT [FK_Customer_BusinessGroup]
');

GO
EXECUTE ('ALTER TABLE [APPS].[Customer] DROP CONSTRAINT [FK_Customer_CustomerReceiver]
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [APPS].[CustomerContact]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[CustomerContact] DROP CONSTRAINT [FK_CustomerContact_Customer]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [APPS].[CustomerBankAccount]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[CustomerBankAccount] DROP CONSTRAINT [PK_CustomerBankAccount]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [APPS].[Customer]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Customer] DROP CONSTRAINT [PK_Customer]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [APPS].[Supplier]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Supplier] DROP CONSTRAINT [PK_Supplier]
');

GO
EXECUTE ('PRINT N''Dropping index [CX_Supplier] from [APPS].[Supplier]''
');

GO
EXECUTE ('DROP INDEX [CX_Supplier] ON [APPS].[Supplier]
');

GO
EXECUTE ('PRINT N''Rebuilding [APPS].[Customer]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[RG_Recovery_1_Customer]
(
[Id] [uniqueidentifier] NOT NULL,
[BusinessGroupId] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Disable] [bit] NOT NULL,
[Code] [nvarchar] (50) NOT NULL,
[Name] [nvarchar] (500) NOT NULL,
[Address] [nvarchar] (500) NULL,
[TaxCode] [nvarchar] (100) NULL,
[Description] [nvarchar] (500) NULL,
[Status] [int] NOT NULL
)
');

GO
SET IDENTITY_INSERT [APPS].[RG_Recovery_1_Customer] ON

GO
EXECUTE ('INSERT INTO [APPS].[RG_Recovery_1_Customer]([Id], [BusinessGroupId], [CX], [Disable], [Code], [Name], [Address], [TaxCode], [Description]) SELECT [Id], [BusinessGroupId], [CX], [Disable], [Code], [Name], [Address], [TaxCode], [Description] FROM [APPS].[Customer]
');

GO
SET IDENTITY_INSERT [APPS].[RG_Recovery_1_Customer] OFF

GO
EXECUTE ('DECLARE @idVal BIGINT
SELECT @idVal = IDENT_CURRENT(N''[APPS].[Customer]'')
IF @idVal IS NOT NULL
    DBCC CHECKIDENT(N''[APPS].[RG_Recovery_1_Customer]'', RESEED, @idVal)
');

GO
EXECUTE ('DROP TABLE [APPS].[Customer]
');

GO
EXECUTE ('EXEC sp_rename N''[APPS].[RG_Recovery_1_Customer]'', N''Customer'', N''OBJECT''
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_Customer] on [APPS].[Customer]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Customer] ADD CONSTRAINT [PK_Customer] PRIMARY KEY CLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Rebuilding [APPS].[CustomerBankAccount]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[RG_Recovery_2_CustomerBankAccount]
(
[Id] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Name] [nvarchar] (100) NOT NULL,
[CustomerId] [uniqueidentifier] NOT NULL,
[BankId] [uniqueidentifier] NOT NULL,
[BankAccountName] [nvarchar] (50) NOT NULL,
[BankBranch] [nvarchar] (500) NOT NULL,
[ProvinceId] [uniqueidentifier] NOT NULL
)
');

GO
SET IDENTITY_INSERT [APPS].[RG_Recovery_2_CustomerBankAccount] ON

GO
EXECUTE ('INSERT INTO [APPS].[RG_Recovery_2_CustomerBankAccount]([Id], [CX], [Name], [CustomerId], [BankId], [BankAccountName], [ProvinceId]) SELECT [Id], [CX], [Name], [CustomerId], [BankId], [BankAccountName], [ProvinceId] FROM [APPS].[CustomerBankAccount]
');

GO
SET IDENTITY_INSERT [APPS].[RG_Recovery_2_CustomerBankAccount] OFF

GO
EXECUTE ('DECLARE @idVal BIGINT
SELECT @idVal = IDENT_CURRENT(N''[APPS].[CustomerBankAccount]'')
IF @idVal IS NOT NULL
    DBCC CHECKIDENT(N''[APPS].[RG_Recovery_2_CustomerBankAccount]'', RESEED, @idVal)
');

GO
EXECUTE ('DROP TABLE [APPS].[CustomerBankAccount]
');

GO
EXECUTE ('EXEC sp_rename N''[APPS].[RG_Recovery_2_CustomerBankAccount]'', N''CustomerBankAccount'', N''OBJECT''
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_CustomerBankAccount] on [APPS].[CustomerBankAccount]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[CustomerBankAccount] ADD CONSTRAINT [PK_CustomerBankAccount] PRIMARY KEY CLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Rebuilding [APPS].[Supplier]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[RG_Recovery_3_Supplier]
(
[Id] [uniqueidentifier] NOT NULL,
[TaxCode] [nvarchar] (50) NULL,
[Name] [nvarchar] (500) NULL,
[BusinessGroupId] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Status] [int] NOT NULL,
[Address] [nvarchar] (500) NULL,
[Description] [nvarchar] (500) NULL,
[Disable] [bit] NOT NULL,
[Code] [nvarchar] (50) NOT NULL
)
');

GO
SET IDENTITY_INSERT [APPS].[RG_Recovery_3_Supplier] ON

GO
EXECUTE ('INSERT INTO [APPS].[RG_Recovery_3_Supplier]([Id], [TaxCode], [Name], [BusinessGroupId], [CX]) SELECT [Id], [TaxCode], [Name], [BusinessGroupId], [CX] FROM [APPS].[Supplier]
');

GO
SET IDENTITY_INSERT [APPS].[RG_Recovery_3_Supplier] OFF

GO
EXECUTE ('DECLARE @idVal BIGINT
SELECT @idVal = IDENT_CURRENT(N''[APPS].[Supplier]'')
IF @idVal IS NOT NULL
    DBCC CHECKIDENT(N''[APPS].[RG_Recovery_3_Supplier]'', RESEED, @idVal)
');

GO
EXECUTE ('DROP TABLE [APPS].[Supplier]
');

GO
EXECUTE ('EXEC sp_rename N''[APPS].[RG_Recovery_3_Supplier]'', N''Supplier'', N''OBJECT''
');

GO
EXECUTE ('PRINT N''Creating index [CX_Supplier] on [APPS].[Supplier]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_Supplier] ON [APPS].[Supplier] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_Supplier] on [APPS].[Supplier]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Supplier] ADD CONSTRAINT [PK_Supplier] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Creating [APPS].[SupplierBankAccount]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[SupplierBankAccount]
(
[Id] [uniqueidentifier] NOT NULL,
[SupplierId] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Name] [nvarchar] (100) NOT NULL,
[BankId] [uniqueidentifier] NOT NULL,
[BankAccountName] [nvarchar] (20) NOT NULL,
[BankBranch] [nvarchar] (100) NOT NULL,
[ProvinceId] [uniqueidentifier] NOT NULL
)
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_SupplierBankAccount] on [APPS].[SupplierBankAccount]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[SupplierBankAccount] ADD CONSTRAINT [PK_SupplierBankAccount] PRIMARY KEY CLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Creating [APPS].[SupplierContact]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[SupplierContact]
(
[Id] [uniqueidentifier] NOT NULL,
[SupplierId] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Phone] [nvarchar] (20) NOT NULL,
[Email] [nvarchar] (100) NULL,
[Address] [nvarchar] (500) NULL,
[Name] [nvarchar] (500) NOT NULL
)
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_SupplierContact] on [APPS].[SupplierContact]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[SupplierContact] ADD CONSTRAINT [PK_SupplierContact] PRIMARY KEY CLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Creating [APPS].[SupplierReceiver]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[SupplierReceiver]
(
[Id] [uniqueidentifier] NOT NULL,
[SupplierId] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Name] [nchar] (10) NOT NULL,
[Email] [nvarchar] (100) NULL,
[Phone] [nvarchar] (20) NOT NULL,
[Address] [nvarchar] (500) NULL
)
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_SupplierReceiver] on [APPS].[SupplierReceiver]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[SupplierReceiver] ADD CONSTRAINT [PK_SupplierReceiver] PRIMARY KEY CLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[CustomerBankAccount]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[CustomerBankAccount] ADD CONSTRAINT [FK_CustomerBankAccount_Bank] FOREIGN KEY ([BankId]) REFERENCES [APPS].[Bank] ([Id])
');

GO
EXECUTE ('ALTER TABLE [APPS].[CustomerBankAccount] ADD CONSTRAINT [FK_CustomerBankAccount_Customer] FOREIGN KEY ([CustomerId]) REFERENCES [APPS].[Customer] ([Id])
');

GO
EXECUTE ('ALTER TABLE [APPS].[CustomerBankAccount] ADD CONSTRAINT [FK_CustomerBankAccount_Province] FOREIGN KEY ([ProvinceId]) REFERENCES [APPS].[Province] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[CustomerReceiver]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[CustomerReceiver] ADD CONSTRAINT [FK_CustomerReceiver_Customer] FOREIGN KEY ([CustomerId]) REFERENCES [APPS].[Customer] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[Customer]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Customer] ADD CONSTRAINT [FK_Customer_BusinessGroup] FOREIGN KEY ([BusinessGroupId]) REFERENCES [APPS].[BusinessGroup] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[SupplierBankAccount]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[SupplierBankAccount] ADD CONSTRAINT [FK_SupplierBankAccount_Supplier] FOREIGN KEY ([SupplierId]) REFERENCES [APPS].[Supplier] ([Id])
');

GO
EXECUTE ('ALTER TABLE [APPS].[SupplierBankAccount] ADD CONSTRAINT [FK_SupplierBankAccount_Bank] FOREIGN KEY ([BankId]) REFERENCES [APPS].[Bank] ([Id])
');

GO
EXECUTE ('ALTER TABLE [APPS].[SupplierBankAccount] ADD CONSTRAINT [FK_SupplierBankAccount_Province] FOREIGN KEY ([ProvinceId]) REFERENCES [APPS].[Province] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[SupplierContact]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[SupplierContact] ADD CONSTRAINT [FK_SupplierContact_Supplier] FOREIGN KEY ([SupplierId]) REFERENCES [APPS].[Supplier] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[SupplierReceiver]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[SupplierReceiver] ADD CONSTRAINT [FK_SupplierReceiver_Supplier] FOREIGN KEY ([SupplierId]) REFERENCES [APPS].[Supplier] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[Supplier]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Supplier] ADD CONSTRAINT [FK_Supplier_BusinessGroup] FOREIGN KEY ([BusinessGroupId]) REFERENCES [APPS].[BusinessGroup] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[CustomerContact]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[CustomerContact] ADD CONSTRAINT [FK_CustomerContact_Customer] FOREIGN KEY ([CustomerId]) REFERENCES [APPS].[Customer] ([Id])
');

GO
SET NOEXEC OFF;

GO
IF N'$(IsSqlCmdEnabled)' <> N'True'
  SET NOEXEC ON;

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('a3421d16-1bd4-4efd-abd6-392706be463b' AS UNIQUEIDENTIFIER))
  PRINT '***** FINISHED EXECUTING MIGRATION "Migrations\016_20190715-1040_PC.sql", ID: {a3421d16-1bd4-4efd-abd6-392706be463b} *****
';

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('a3421d16-1bd4-4efd-abd6-392706be463b' AS UNIQUEIDENTIFIER))
  INSERT [$(DatabaseName)].[dbo].[__MigrationLog] ([migration_id], [script_checksum], [script_filename], [complete_dt], [applied_by], [deployed], [version], [package_version], [release_version])
  VALUES                                         (CAST ('a3421d16-1bd4-4efd-abd6-392706be463b' AS UNIQUEIDENTIFIER), 'B7DED6B492CE9B116E16785B6FF13A60E8EB505494049609E3AD80B70E39374C', 'Migrations\016_20190715-1040_PC.sql', SYSDATETIME(), SYSTEM_USER, 1, NULL, '$(PackageVersion)', CASE '$(ReleaseVersion)' WHEN '' THEN NULL ELSE '$(ReleaseVersion)' END);

GO
SET IMPLICIT_TRANSACTIONS, NUMERIC_ROUNDABORT OFF;
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, NOCOUNT, QUOTED_IDENTIFIER ON;

GO
IF DB_NAME() != '$(DatabaseName)'
  USE [$(DatabaseName)];

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('a4d7bfff-e3e1-47ce-80aa-22404923ca11' AS UNIQUEIDENTIFIER))
  PRINT '

***** EXECUTING MIGRATION "Migrations\018_20190715-1152_PC.sql", ID: {a4d7bfff-e3e1-47ce-80aa-22404923ca11} *****';

GO
IF EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('a4d7bfff-e3e1-47ce-80aa-22404923ca11' AS UNIQUEIDENTIFIER))
BEGIN
  PRINT '----- Skipping "Migrations\018_20190715-1152_PC.sql", ID: {a4d7bfff-e3e1-47ce-80aa-22404923ca11} as it has already been run on this database';
  SET NOEXEC ON;
END

GO
EXECUTE ('
PRINT N''Creating [APPS].[Voucher]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[Voucher]
(
[Id] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[SetOfBookId] [uniqueidentifier] NOT NULL,
[Code] [nvarchar] (10) NOT NULL,
[Name] [nvarchar] (200) NOT NULL,
[Description] [nvarchar] (500) NULL,
[DebitAccount] [uniqueidentifier] NULL,
[CreditAccount] [uniqueidentifier] NULL,
[VoucherTypeId] [uniqueidentifier] NULL,
[Disable] [bit] NOT NULL
)
');

GO
EXECUTE ('PRINT N''Creating index [CX_Voucher] on [APPS].[Voucher]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_Voucher] ON [APPS].[Voucher] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_Voucher] on [APPS].[Voucher]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Voucher] ADD CONSTRAINT [PK_Voucher] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Creating [APPS].[VoucherType]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[VoucherType]
(
[Id] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Code] [nvarchar] (10) NULL,
[Name] [nvarchar] (100) NULL,
[Disable] [bit] NOT NULL
)
');

GO
EXECUTE ('PRINT N''Creating index [CX_VoucherType] on [APPS].[VoucherType]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_VoucherType] ON [APPS].[VoucherType] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_VoucherType] on [APPS].[VoucherType]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[VoucherType] ADD CONSTRAINT [PK_VoucherType] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[Voucher]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Voucher] ADD CONSTRAINT [FK_Voucher_VoucherType] FOREIGN KEY ([VoucherTypeId]) REFERENCES [APPS].[VoucherType] ([Id])
');

GO
EXECUTE ('ALTER TABLE [APPS].[Voucher] ADD CONSTRAINT [FK_Voucher_SetOfBook] FOREIGN KEY ([SetOfBookId]) REFERENCES [APPS].[SetOfBook] ([Id])
');

GO
EXECUTE ('ALTER TABLE [APPS].[Voucher] ADD CONSTRAINT [FK_Voucher_ChartOfAccount_Debit] FOREIGN KEY ([DebitAccount]) REFERENCES [APPS].[ChartOfAccount] ([Id])
');

GO
EXECUTE ('ALTER TABLE [APPS].[Voucher] ADD CONSTRAINT [FK_Voucher_ChartOfAccount_Credit] FOREIGN KEY ([CreditAccount]) REFERENCES [APPS].[ChartOfAccount] ([Id])
');

GO
SET NOEXEC OFF;

GO
IF N'$(IsSqlCmdEnabled)' <> N'True'
  SET NOEXEC ON;

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('a4d7bfff-e3e1-47ce-80aa-22404923ca11' AS UNIQUEIDENTIFIER))
  PRINT '***** FINISHED EXECUTING MIGRATION "Migrations\018_20190715-1152_PC.sql", ID: {a4d7bfff-e3e1-47ce-80aa-22404923ca11} *****
';

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('a4d7bfff-e3e1-47ce-80aa-22404923ca11' AS UNIQUEIDENTIFIER))
  INSERT [$(DatabaseName)].[dbo].[__MigrationLog] ([migration_id], [script_checksum], [script_filename], [complete_dt], [applied_by], [deployed], [version], [package_version], [release_version])
  VALUES                                         (CAST ('a4d7bfff-e3e1-47ce-80aa-22404923ca11' AS UNIQUEIDENTIFIER), '92F0F46968E14ED042B48168F1603E01957B4DCF532E31B2E01857F6809B2C62', 'Migrations\018_20190715-1152_PC.sql', SYSDATETIME(), SYSTEM_USER, 1, NULL, '$(PackageVersion)', CASE '$(ReleaseVersion)' WHEN '' THEN NULL ELSE '$(ReleaseVersion)' END);

GO
SET IMPLICIT_TRANSACTIONS, NUMERIC_ROUNDABORT OFF;
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, NOCOUNT, QUOTED_IDENTIFIER ON;

GO
IF DB_NAME() != '$(DatabaseName)'
  USE [$(DatabaseName)];

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('9f1884ae-a2a1-4e3c-92ba-6ee1221da46a' AS UNIQUEIDENTIFIER))
  PRINT '

***** EXECUTING MIGRATION "Migrations\019_20190715-1444_PC.sql", ID: {9f1884ae-a2a1-4e3c-92ba-6ee1221da46a} *****';

GO
IF EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('9f1884ae-a2a1-4e3c-92ba-6ee1221da46a' AS UNIQUEIDENTIFIER))
BEGIN
  PRINT '----- Skipping "Migrations\019_20190715-1444_PC.sql", ID: {9f1884ae-a2a1-4e3c-92ba-6ee1221da46a} as it has already been run on this database';
  SET NOEXEC ON;
END

GO
EXECUTE ('
PRINT N''Dropping foreign keys from [APPS].[CustomerBankAccount]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[CustomerBankAccount] DROP CONSTRAINT [FK_CustomerBankAccount_Bank]
');

GO
EXECUTE ('ALTER TABLE [APPS].[CustomerBankAccount] DROP CONSTRAINT [FK_CustomerBankAccount_Customer]
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [APPS].[CustomerContact]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[CustomerContact] DROP CONSTRAINT [FK_CustomerContact_Customer]
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [APPS].[CustomerReceiver]''
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [APPS].[LegalEntity]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[LegalEntity] DROP CONSTRAINT [FK_LegalEntity_SetofBook]
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [APPS].[Division]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Division] DROP CONSTRAINT [FK_Division_LegalEntity]
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [dbo].[StockAdjustmentReason]''
');

GO
EXECUTE ('ALTER TABLE [dbo].[StockAdjustmentReason] DROP CONSTRAINT [FK_StockAdjustmentReason_LegalEntity]
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [APPS].[SupplierReceiver]''
');

GO
EXECUTE ('--ALTER TABLE [APPS].[SupplierReceiver] DROP CONSTRAINT [FK_SupplierReceiver_Supplier]
--GO
PRINT N''Dropping foreign keys from [APPS].[Voucher]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Voucher] DROP CONSTRAINT [FK_Voucher_SetOfBook]
');

GO
EXECUTE ('--PRINT N''Dropping constraints from [APPS].[CustomerReceiver]''
--GO
--ALTER TABLE [APPS].[CustomerReceiver] DROP CONSTRAINT [PK_CustomerReceiver]
--GO
PRINT N''Dropping constraints from [APPS].[LegalEntity]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[LegalEntity] DROP CONSTRAINT [PK_LegalEntity]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [APPS].[LegalEntity]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[LegalEntity] DROP CONSTRAINT [IX_Code_LegalEntity]
');

GO
EXECUTE ('--PRINT N''Dropping constraints from [APPS].[SupplierReceiver]''
--GO
--ALTER TABLE [APPS].[SupplierReceiver] DROP CONSTRAINT [PK_SupplierReceiver]
--GO
PRINT N''Dropping constraints from [dbo].[CustomerGroup]''
');

GO
EXECUTE ('ALTER TABLE [dbo].[CustomerGroup] DROP CONSTRAINT [PK_CustomerGroup]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [dbo].[SupplierGroup]''
');

GO
EXECUTE ('ALTER TABLE [dbo].[SupplierGroup] DROP CONSTRAINT [PK_SupplierGroup]
');

GO
EXECUTE ('PRINT N''Dropping index [CX_LegalEntity] from [APPS].[LegalEntity]''
');

GO
EXECUTE ('DROP INDEX [CX_LegalEntity] ON [APPS].[LegalEntity]
');

GO
EXECUTE ('PRINT N''Dropping [dbo].[CustomerGroup]''
');

GO
EXECUTE ('DROP TABLE [dbo].[CustomerGroup]
');

GO
EXECUTE ('--PRINT N''Dropping [APPS].[SupplierReceiver]''
--GO
--DROP TABLE [APPS].[SupplierReceiver]
--GO
--PRINT N''Dropping [APPS].[CustomerReceiver]''
--GO
--DROP TABLE [APPS].[CustomerReceiver]
--GO
PRINT N''Altering [APPS].[CustomerBankAccount]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[CustomerBankAccount] ADD
[AccountNumber] [nvarchar] (50) NULL,
[AccountName] [nvarchar] (500) NULL
');

GO
EXECUTE ('ALTER TABLE [APPS].[CustomerBankAccount] DROP
COLUMN [Name],
COLUMN [BankAccountName]
');

GO
EXECUTE ('EXEC sp_rename N''[APPS].[CustomerBankAccount].[CustomerId]'', N''CustomerDetailId'', N''COLUMN''
');

GO
EXECUTE ('EXEC sp_rename N''[APPS].[CustomerBankAccount].[BankBranch]'', N''Branch'', N''COLUMN''
');

GO
EXECUTE ('ALTER TABLE [APPS].[CustomerBankAccount] ALTER COLUMN [BankId] [uniqueidentifier] NULL
');

GO
EXECUTE ('PRINT N''Rebuilding [APPS].[LegalEntity]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[RG_Recovery_1_LegalEntity]
(
[Id] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Disable] [bit] NOT NULL,
[SetOfBookId] [uniqueidentifier] NOT NULL,
[Code] [char] (2) NOT NULL,
[ShortName] [nvarchar] (500) NULL,
[Name] [nvarchar] (500) NULL,
[BusinessGroupId] [uniqueidentifier] NOT NULL
)
');

GO
SET IDENTITY_INSERT [APPS].[RG_Recovery_1_LegalEntity] ON

GO
EXECUTE ('INSERT INTO [APPS].[RG_Recovery_1_LegalEntity]([Id], [CX], [Disable], [SetOfBookId], [Code], [ShortName], [Name]) SELECT [Id], [CX], [Disable], [SetOfBookId], [Code], [ShortName], [Name] FROM [APPS].[LegalEntity]
');

GO
SET IDENTITY_INSERT [APPS].[RG_Recovery_1_LegalEntity] OFF

GO
EXECUTE ('DECLARE @idVal BIGINT
SELECT @idVal = IDENT_CURRENT(N''[APPS].[LegalEntity]'')
IF @idVal IS NOT NULL
    DBCC CHECKIDENT(N''[APPS].[RG_Recovery_1_LegalEntity]'', RESEED, @idVal)
');

GO
EXECUTE ('DROP TABLE [APPS].[LegalEntity]
');

GO
EXECUTE ('EXEC sp_rename N''[APPS].[RG_Recovery_1_LegalEntity]'', N''LegalEntity'', N''OBJECT''
');

GO
EXECUTE ('PRINT N''Creating index [CX_LegalEntity] on [APPS].[LegalEntity]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_LegalEntity] ON [APPS].[LegalEntity] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_LegalEntity] on [APPS].[LegalEntity]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[LegalEntity] ADD CONSTRAINT [PK_LegalEntity] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Adding constraints to [APPS].[LegalEntity]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[LegalEntity] ADD CONSTRAINT [IX_Code_LegalEntity] UNIQUE NONCLUSTERED  ([Code], [SetOfBookId])
');

GO
EXECUTE ('PRINT N''Altering [APPS].[EmployeeContact]''
');

GO
EXECUTE ('--ALTER TABLE [APPS].[EmployeeContact] ADD
--[Description] [nvarchar] (500) NULL
--GO
PRINT N''Altering [APPS].[SupplierContact]''
PRINT N''Altering [APPS].[CustomerContact]''
');

GO
EXECUTE ('EXEC sp_rename N''[APPS].[CustomerContact].[CustomerId]'', N''CustomerDetailId'', N''COLUMN''
');

GO
EXECUTE ('PRINT N''Creating [APPS].[CustomerDetail]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[CustomerDetail]
(
[Id] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Disable] [bit] NOT NULL,
[CustomerId] [uniqueidentifier] NOT NULL,
[CustomerGroupId] [uniqueidentifier] NOT NULL,
[BusinessGroupId] [uniqueidentifier] NOT NULL,
[PaymentTermId] [uniqueidentifier] NULL,
[MaxDebtDays] [int] NULL,
[MaxDebtAmount] [float] NULL,
[StaffInCharge] [uniqueidentifier] NULL
)
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_CustomerDetail] on [APPS].[CustomerDetail]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[CustomerDetail] ADD CONSTRAINT [PK_CustomerDetail] PRIMARY KEY CLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Creating [APPS].[CustomerGroup]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[CustomerGroup]
(
[Id] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Disable] [bit] NOT NULL,
[Name] [nvarchar] (500) NOT NULL,
[LegalEntityId] [uniqueidentifier] NOT NULL,
[BusinessGroupId] [uniqueidentifier] NOT NULL
)
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_CustomerGroup] on [APPS].[CustomerGroup]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[CustomerGroup] ADD CONSTRAINT [PK_CustomerGroup] PRIMARY KEY CLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Rebuilding [dbo].[SupplierGroup]''
');

GO
EXECUTE ('CREATE TABLE [dbo].[RG_Recovery_2_SupplierGroup]
(
[Id] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Disable] [bit] NOT NULL,
[Name] [nvarchar] (500) NOT NULL,
[LegalEntityId] [uniqueidentifier] NOT NULL,
[BusinessGroupId] [uniqueidentifier] NOT NULL
)
');

GO
SET IDENTITY_INSERT [dbo].[RG_Recovery_2_SupplierGroup] ON

GO
EXECUTE ('INSERT INTO [dbo].[RG_Recovery_2_SupplierGroup]([Id], [CX], [Disable], [Name], [LegalEntityId]) SELECT [Id], [CX], [Disable], [Name], [LegalEntityId] FROM [dbo].[SupplierGroup]
');

GO
SET IDENTITY_INSERT [dbo].[RG_Recovery_2_SupplierGroup] OFF

GO
EXECUTE ('DECLARE @idVal BIGINT
SELECT @idVal = IDENT_CURRENT(N''[dbo].[SupplierGroup]'')
IF @idVal IS NOT NULL
    DBCC CHECKIDENT(N''[dbo].[RG_Recovery_2_SupplierGroup]'', RESEED, @idVal)
');

GO
EXECUTE ('DROP TABLE [dbo].[SupplierGroup]
');

GO
EXECUTE ('EXEC sp_rename N''[dbo].[RG_Recovery_2_SupplierGroup]'', N''SupplierGroup'', N''OBJECT''
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_SupplierGroup] on [dbo].[SupplierGroup]''
');

GO
EXECUTE ('ALTER TABLE [dbo].[SupplierGroup] ADD CONSTRAINT [PK_SupplierGroup] PRIMARY KEY CLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[LegalEntity]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[LegalEntity] ADD CONSTRAINT [FK_LegalEntity_SetofBook] FOREIGN KEY ([SetOfBookId]) REFERENCES [APPS].[SetOfBook] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[CustomerBankAccount]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[CustomerBankAccount] ADD CONSTRAINT [FK_CustomerBankAccount_Bank] FOREIGN KEY ([BankId]) REFERENCES [APPS].[Bank] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[Division]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Division] ADD CONSTRAINT [FK_Division_LegalEntity] FOREIGN KEY ([LegalEntityId]) REFERENCES [APPS].[LegalEntity] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [dbo].[StockAdjustmentReason]''
');

GO
EXECUTE ('ALTER TABLE [dbo].[StockAdjustmentReason] ADD CONSTRAINT [FK_StockAdjustmentReason_LegalEntity] FOREIGN KEY ([LegalEntityId]) REFERENCES [APPS].[LegalEntity] ([Id])
');

GO
SET NOEXEC OFF;

GO
IF N'$(IsSqlCmdEnabled)' <> N'True'
  SET NOEXEC ON;

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('9f1884ae-a2a1-4e3c-92ba-6ee1221da46a' AS UNIQUEIDENTIFIER))
  PRINT '***** FINISHED EXECUTING MIGRATION "Migrations\019_20190715-1444_PC.sql", ID: {9f1884ae-a2a1-4e3c-92ba-6ee1221da46a} *****
';

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('9f1884ae-a2a1-4e3c-92ba-6ee1221da46a' AS UNIQUEIDENTIFIER))
  INSERT [$(DatabaseName)].[dbo].[__MigrationLog] ([migration_id], [script_checksum], [script_filename], [complete_dt], [applied_by], [deployed], [version], [package_version], [release_version])
  VALUES                                         (CAST ('9f1884ae-a2a1-4e3c-92ba-6ee1221da46a' AS UNIQUEIDENTIFIER), '36CC4B3507F542D015947C21913044A90ABFDC262B67C4A1479616113E9C089C', 'Migrations\019_20190715-1444_PC.sql', SYSDATETIME(), SYSTEM_USER, 1, NULL, '$(PackageVersion)', CASE '$(ReleaseVersion)' WHEN '' THEN NULL ELSE '$(ReleaseVersion)' END);

GO
SET IMPLICIT_TRANSACTIONS, NUMERIC_ROUNDABORT OFF;
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, NOCOUNT, QUOTED_IDENTIFIER ON;

GO
IF DB_NAME() != '$(DatabaseName)'
  USE [$(DatabaseName)];

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('2d25e04d-38ff-4628-ba28-0710fff3cdeb' AS UNIQUEIDENTIFIER))
  PRINT '

***** EXECUTING MIGRATION "Migrations\020_20190715-1534_PC.sql", ID: {2d25e04d-38ff-4628-ba28-0710fff3cdeb} *****';

GO
IF EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('2d25e04d-38ff-4628-ba28-0710fff3cdeb' AS UNIQUEIDENTIFIER))
BEGIN
  PRINT '----- Skipping "Migrations\020_20190715-1534_PC.sql", ID: {2d25e04d-38ff-4628-ba28-0710fff3cdeb} as it has already been run on this database';
  SET NOEXEC ON;
END

GO
EXECUTE ('
PRINT N''Dropping foreign keys from [APPS].[SupplierBankAccount]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[SupplierBankAccount] DROP CONSTRAINT [FK_SupplierBankAccount_Supplier]
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [APPS].[SupplierContact]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[SupplierContact] DROP CONSTRAINT [FK_SupplierContact_Supplier]
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [HR].[EmployeePosition]''
');

GO
EXECUTE ('ALTER TABLE [HR].[EmployeePosition] DROP CONSTRAINT [FK_EmployeeGroup_Employee]
');

GO
EXECUTE ('ALTER TABLE [HR].[EmployeePosition] DROP CONSTRAINT [FK_EmployeeGroup_Group]
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [HR].[Position]''
');

GO
EXECUTE ('ALTER TABLE [HR].[Position] DROP CONSTRAINT [FK_Position_Division]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [HR].[EmployeePosition]''
');

GO
EXECUTE ('ALTER TABLE [HR].[EmployeePosition] DROP CONSTRAINT [PK_UserGroup]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [HR].[Position]''
');

GO
EXECUTE ('ALTER TABLE [HR].[Position] DROP CONSTRAINT [PK_Group]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [dbo].[SupplierGroup]''
');

GO
EXECUTE ('ALTER TABLE [dbo].[SupplierGroup] DROP CONSTRAINT [PK_SupplierGroup]
');

GO
EXECUTE ('PRINT N''Dropping index [CX_UserGroup] from [HR].[EmployeePosition]''
');

GO
EXECUTE ('DROP INDEX [CX_UserGroup] ON [HR].[EmployeePosition]
');

GO
EXECUTE ('PRINT N''Dropping index [CX_Group] from [HR].[Position]''
');

GO
EXECUTE ('DROP INDEX [CX_Group] ON [HR].[Position]
');

GO
EXECUTE ('PRINT N''Dropping [dbo].[SupplierGroup]''
');

GO
EXECUTE ('DROP TABLE [dbo].[SupplierGroup]
');

GO
EXECUTE ('PRINT N''Dropping [HR].[Position]''
');

GO
EXECUTE ('DROP TABLE [HR].[Position]
');

GO
EXECUTE ('PRINT N''Dropping [HR].[EmployeePosition]''
');

GO
EXECUTE ('DROP TABLE [HR].[EmployeePosition]
');

GO
EXECUTE ('PRINT N''Altering [APPS].[CustomerDetail]''
');

GO
EXECUTE ('EXEC sp_rename N''[APPS].[CustomerDetail].[StaffInCharge]'', N''StaffInChargeId'', N''COLUMN''
');

GO
EXECUTE ('PRINT N''Creating [APPS].[EmployeePosition]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[EmployeePosition]
(
[EmployeeId] [uniqueidentifier] NOT NULL,
[PositionId] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1)
)
');

GO
EXECUTE ('PRINT N''Creating index [CX_UserGroup] on [APPS].[EmployeePosition]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_UserGroup] ON [APPS].[EmployeePosition] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_UserGroup] on [APPS].[EmployeePosition]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[EmployeePosition] ADD CONSTRAINT [PK_UserGroup] PRIMARY KEY NONCLUSTERED  ([EmployeeId], [PositionId])
');

GO
EXECUTE ('PRINT N''Creating [APPS].[Position]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[Position]
(
[Id] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Disable] [bit] NOT NULL,
[LegalEntityId] [uniqueidentifier] NOT NULL,
[Name] [nvarchar] (500) NOT NULL
)
');

GO
EXECUTE ('PRINT N''Creating index [CX_Group] on [APPS].[Position]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_Group] ON [APPS].[Position] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_Group] on [APPS].[Position]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Position] ADD CONSTRAINT [PK_Group] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Altering [APPS].[SupplierBankAccount]''
');

GO
EXECUTE ('EXEC sp_rename N''[APPS].[SupplierBankAccount].[SupplierId]'', N''SupplierDetailId'', N''COLUMN''
');

GO
EXECUTE ('PRINT N''Creating [APPS].[SupplierDetail]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[SupplierDetail]
(
[Id] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL,
[Disable] [bit] NOT NULL,
[SupplierGroupId] [uniqueidentifier] NOT NULL,
[SupplierId] [uniqueidentifier] NOT NULL,
[StaffInChargeId] [uniqueidentifier] NULL
)
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_SupplierDetail] on [APPS].[SupplierDetail]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[SupplierDetail] ADD CONSTRAINT [PK_SupplierDetail] PRIMARY KEY CLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Altering [APPS].[SupplierContact]''
');

GO
EXECUTE ('EXEC sp_rename N''[APPS].[SupplierContact].[SupplierId]'', N''SupplierDetailId'', N''COLUMN''
');

GO
EXECUTE ('PRINT N''Creating [APPS].[SupplierGroup]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[SupplierGroup]
(
[Id] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Disable] [bit] NOT NULL,
[Name] [nvarchar] (500) NOT NULL,
[LegalEntityId] [uniqueidentifier] NOT NULL,
[BusinessGroupId] [uniqueidentifier] NOT NULL
)
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_SupplierGroup] on [APPS].[SupplierGroup]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[SupplierGroup] ADD CONSTRAINT [PK_SupplierGroup] PRIMARY KEY CLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[EmployeePosition]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[EmployeePosition] ADD CONSTRAINT [FK_EmployeeGroup_Group] FOREIGN KEY ([PositionId]) REFERENCES [APPS].[Position] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[CustomerBankAccount]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[CustomerBankAccount] ADD CONSTRAINT [FK_CustomerBankAccount_CustomerDetail] FOREIGN KEY ([CustomerDetailId]) REFERENCES [APPS].[CustomerDetail] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[CustomerContact]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[CustomerContact] ADD CONSTRAINT [FK_CustomerContact_CustomerDetail] FOREIGN KEY ([CustomerDetailId]) REFERENCES [APPS].[CustomerDetail] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[CustomerDetail]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[CustomerDetail] ADD CONSTRAINT [FK_CustomerDetail_Customer] FOREIGN KEY ([CustomerId]) REFERENCES [APPS].[Customer] ([Id])
');

GO
EXECUTE ('ALTER TABLE [APPS].[CustomerDetail] ADD CONSTRAINT [FK_CustomerDetail_CustomerGroup] FOREIGN KEY ([CustomerGroupId]) REFERENCES [APPS].[CustomerGroup] ([Id])
');

GO
EXECUTE ('ALTER TABLE [APPS].[CustomerDetail] ADD CONSTRAINT [FK_CustomerDetail_Employee] FOREIGN KEY ([StaffInChargeId]) REFERENCES [APPS].[Employee] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[CustomerGroup]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[CustomerGroup] ADD CONSTRAINT [FK_CustomerGroup_LegalEntity] FOREIGN KEY ([LegalEntityId]) REFERENCES [APPS].[LegalEntity] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[EmployeePosition]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[EmployeePosition] ADD CONSTRAINT [FK_EmployeeGroup_Employee] FOREIGN KEY ([EmployeeId]) REFERENCES [APPS].[Employee] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[Position]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[Position] ADD CONSTRAINT [FK_Position_LegalEntity] FOREIGN KEY ([LegalEntityId]) REFERENCES [APPS].[LegalEntity] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[SupplierBankAccount]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[SupplierBankAccount] ADD CONSTRAINT [FK_SupplierBankAccount_SupplierDetail] FOREIGN KEY ([SupplierDetailId]) REFERENCES [APPS].[SupplierDetail] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[SupplierContact]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[SupplierContact] ADD CONSTRAINT [FK_SupplierContact_SupplierDetail] FOREIGN KEY ([SupplierDetailId]) REFERENCES [APPS].[SupplierDetail] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[SupplierDetail]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[SupplierDetail] ADD CONSTRAINT [FK_SupplierDetail_SupplierGroup] FOREIGN KEY ([SupplierGroupId]) REFERENCES [APPS].[SupplierGroup] ([Id])
');

GO
EXECUTE ('ALTER TABLE [APPS].[SupplierDetail] ADD CONSTRAINT [FK_SupplierDetail_Supplier] FOREIGN KEY ([SupplierId]) REFERENCES [APPS].[Supplier] ([Id])
');

GO
EXECUTE ('ALTER TABLE [APPS].[SupplierDetail] ADD CONSTRAINT [FK_SupplierDetail_Employee] FOREIGN KEY ([StaffInChargeId]) REFERENCES [APPS].[Employee] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[SupplierGroup]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[SupplierGroup] ADD CONSTRAINT [FK_SupplierGroup_LegalEntity] FOREIGN KEY ([LegalEntityId]) REFERENCES [APPS].[LegalEntity] ([Id])
');

GO
SET NOEXEC OFF;

GO
IF N'$(IsSqlCmdEnabled)' <> N'True'
  SET NOEXEC ON;

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('2d25e04d-38ff-4628-ba28-0710fff3cdeb' AS UNIQUEIDENTIFIER))
  PRINT '***** FINISHED EXECUTING MIGRATION "Migrations\020_20190715-1534_PC.sql", ID: {2d25e04d-38ff-4628-ba28-0710fff3cdeb} *****
';

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('2d25e04d-38ff-4628-ba28-0710fff3cdeb' AS UNIQUEIDENTIFIER))
  INSERT [$(DatabaseName)].[dbo].[__MigrationLog] ([migration_id], [script_checksum], [script_filename], [complete_dt], [applied_by], [deployed], [version], [package_version], [release_version])
  VALUES                                         (CAST ('2d25e04d-38ff-4628-ba28-0710fff3cdeb' AS UNIQUEIDENTIFIER), '5E6685129B1710091EBAAEE133EC61D266CED846858503C38D129C83C2A0DFC0', 'Migrations\020_20190715-1534_PC.sql', SYSDATETIME(), SYSTEM_USER, 1, NULL, '$(PackageVersion)', CASE '$(ReleaseVersion)' WHEN '' THEN NULL ELSE '$(ReleaseVersion)' END);

GO
SET IMPLICIT_TRANSACTIONS, NUMERIC_ROUNDABORT OFF;
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, NOCOUNT, QUOTED_IDENTIFIER ON;

GO
IF DB_NAME() != '$(DatabaseName)'
  USE [$(DatabaseName)];

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('b5ee5e2b-cbec-4117-88ee-bbbbc1aedaef' AS UNIQUEIDENTIFIER))
  PRINT '

***** EXECUTING MIGRATION "Migrations\021_20190715-1652_PC.sql", ID: {b5ee5e2b-cbec-4117-88ee-bbbbc1aedaef} *****';

GO
IF EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('b5ee5e2b-cbec-4117-88ee-bbbbc1aedaef' AS UNIQUEIDENTIFIER))
BEGIN
  PRINT '----- Skipping "Migrations\021_20190715-1652_PC.sql", ID: {b5ee5e2b-cbec-4117-88ee-bbbbc1aedaef} as it has already been run on this database';
  SET NOEXEC ON;
END

GO
EXECUTE ('
PRINT N''Altering [APPS].[SetOfBook]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[SetOfBook] ADD
[ChartOfAccountTemplateId] [uniqueidentifier] NULL,
[EnvironmentTaxTemplateId] [uniqueidentifier] NULL,
[ExportTaxTemplateId] [uniqueidentifier] NULL,
[ImportTaxTemplateId] [uniqueidentifier] NULL,
[NaturalResourceTaxTemplateId] [uniqueidentifier] NULL,
[SpecialConsumptionTaxTemplateId] [uniqueidentifier] NULL,
[ValueAddedTaxTemplateId] [uniqueidentifier] NULL
');

GO
EXECUTE ('PRINT N''Creating [APPS].[EnumMasterData]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[EnumMasterData]
(
[Id] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Key] [nvarchar] (10) NOT NULL,
[Value] [nvarchar] (100) NOT NULL
)
');

GO
EXECUTE ('PRINT N''Creating index [CX_EnumMasterData] on [APPS].[EnumMasterData]''
');

GO
EXECUTE ('CREATE UNIQUE CLUSTERED INDEX [CX_EnumMasterData] ON [APPS].[EnumMasterData] ([CX])
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_EnumMasterData] on [APPS].[EnumMasterData]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[EnumMasterData] ADD CONSTRAINT [PK_EnumMasterData] PRIMARY KEY NONCLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Altering [APPS].[ChartOfAccount]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[ChartOfAccount] ADD
[Characteristic] [uniqueidentifier] NULL
');

GO
EXECUTE ('PRINT N''Altering [APPS].[CustomerContact]''
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[ChartOfAccount]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[ChartOfAccount] ADD CONSTRAINT [FK_ChartOfAccount_EnumMasterData] FOREIGN KEY ([Characteristic]) REFERENCES [APPS].[EnumMasterData] ([Id])
');

GO
SET NOEXEC OFF;

GO
IF N'$(IsSqlCmdEnabled)' <> N'True'
  SET NOEXEC ON;

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('b5ee5e2b-cbec-4117-88ee-bbbbc1aedaef' AS UNIQUEIDENTIFIER))
  PRINT '***** FINISHED EXECUTING MIGRATION "Migrations\021_20190715-1652_PC.sql", ID: {b5ee5e2b-cbec-4117-88ee-bbbbc1aedaef} *****
';

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('b5ee5e2b-cbec-4117-88ee-bbbbc1aedaef' AS UNIQUEIDENTIFIER))
  INSERT [$(DatabaseName)].[dbo].[__MigrationLog] ([migration_id], [script_checksum], [script_filename], [complete_dt], [applied_by], [deployed], [version], [package_version], [release_version])
  VALUES                                         (CAST ('b5ee5e2b-cbec-4117-88ee-bbbbc1aedaef' AS UNIQUEIDENTIFIER), '78DE1466CD52B783A3BA7677BB3BE5B70647F4EFEB05A14CEF2CAF3918BBF397', 'Migrations\021_20190715-1652_PC.sql', SYSDATETIME(), SYSTEM_USER, 1, NULL, '$(PackageVersion)', CASE '$(ReleaseVersion)' WHEN '' THEN NULL ELSE '$(ReleaseVersion)' END);

GO
SET IMPLICIT_TRANSACTIONS, NUMERIC_ROUNDABORT OFF;
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, NOCOUNT, QUOTED_IDENTIFIER ON;

GO
IF DB_NAME() != '$(DatabaseName)'
  USE [$(DatabaseName)];

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('046a0f01-f60f-47a7-acb2-25565bcb6252' AS UNIQUEIDENTIFIER))
  PRINT '

***** EXECUTING MIGRATION "Migrations\022_20190715-1824_PC.sql", ID: {046a0f01-f60f-47a7-acb2-25565bcb6252} *****';

GO
IF EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('046a0f01-f60f-47a7-acb2-25565bcb6252' AS UNIQUEIDENTIFIER))
BEGIN
  PRINT '----- Skipping "Migrations\022_20190715-1824_PC.sql", ID: {046a0f01-f60f-47a7-acb2-25565bcb6252} as it has already been run on this database';
  SET NOEXEC ON;
END

GO
EXECUTE ('
PRINT N''Dropping foreign keys from [APPS].[CustomerGroup]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[CustomerGroup] DROP CONSTRAINT [FK_CustomerGroup_LegalEntity]
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [APPS].[CustomerDetail]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[CustomerDetail] DROP CONSTRAINT [FK_CustomerDetail_CustomerGroup]
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [APPS].[CustomerReceiver]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[CustomerReceiver] DROP CONSTRAINT [FK_CustomerReceiver_Customer]
');

GO
EXECUTE ('PRINT N''Dropping foreign keys from [APPS].[SupplierReceiver]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[SupplierReceiver] DROP CONSTRAINT [FK_SupplierReceiver_Supplier]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [APPS].[CustomerGroup]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[CustomerGroup] DROP CONSTRAINT [PK_CustomerGroup]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [APPS].[CustomerReceiver]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[CustomerReceiver] DROP CONSTRAINT [PK_CustomerReceiver]
');

GO
EXECUTE ('PRINT N''Dropping constraints from [APPS].[SupplierReceiver]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[SupplierReceiver] DROP CONSTRAINT [PK_SupplierReceiver]
');

GO
EXECUTE ('PRINT N''Dropping [APPS].[SupplierReceiver]''
');

GO
EXECUTE ('DROP TABLE [APPS].[SupplierReceiver]
');

GO
EXECUTE ('PRINT N''Dropping [APPS].[CustomerReceiver]''
');

GO
EXECUTE ('DROP TABLE [APPS].[CustomerReceiver]
');

GO
EXECUTE ('PRINT N''Altering [APPS].[CustomerContact]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[CustomerContact] ADD
[ProvinceId] [uniqueidentifier] NULL,
[Description] [nvarchar] (500) NULL
');

GO
EXECUTE ('EXEC sp_rename N''[APPS].[CustomerContact].[Name]'', N''FullName'', N''COLUMN''
');

GO
EXECUTE ('ALTER TABLE [APPS].[CustomerContact] ALTER COLUMN [Phone] [nvarchar] (20) NULL
');

GO
EXECUTE ('PRINT N''Rebuilding [APPS].[CustomerGroup]''
');

GO
EXECUTE ('CREATE TABLE [APPS].[RG_Recovery_1_CustomerGroup]
(
[Id] [uniqueidentifier] NOT NULL,
[CX] [bigint] NOT NULL IDENTITY(1, 1),
[Disable] [bit] NOT NULL,
[Code] [nvarchar] (50) NOT NULL,
[Name] [nvarchar] (500) NOT NULL,
[Description] [nvarchar] (500) NULL,
[LegalEntityId] [uniqueidentifier] NOT NULL,
[BusinessGroupId] [uniqueidentifier] NOT NULL
)
');

GO
SET IDENTITY_INSERT [APPS].[RG_Recovery_1_CustomerGroup] ON

GO
EXECUTE ('INSERT INTO [APPS].[RG_Recovery_1_CustomerGroup]([Id], [CX], [Disable], [Name], [LegalEntityId], [BusinessGroupId]) SELECT [Id], [CX], [Disable], [Name], [LegalEntityId], [BusinessGroupId] FROM [APPS].[CustomerGroup]
');

GO
SET IDENTITY_INSERT [APPS].[RG_Recovery_1_CustomerGroup] OFF

GO
EXECUTE ('DECLARE @idVal BIGINT
SELECT @idVal = IDENT_CURRENT(N''[APPS].[CustomerGroup]'')
IF @idVal IS NOT NULL
    DBCC CHECKIDENT(N''[APPS].[RG_Recovery_1_CustomerGroup]'', RESEED, @idVal)
');

GO
EXECUTE ('DROP TABLE [APPS].[CustomerGroup]
');

GO
EXECUTE ('EXEC sp_rename N''[APPS].[RG_Recovery_1_CustomerGroup]'', N''CustomerGroup'', N''OBJECT''
');

GO
EXECUTE ('PRINT N''Creating primary key [PK_CustomerGroup] on [APPS].[CustomerGroup]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[CustomerGroup] ADD CONSTRAINT [PK_CustomerGroup] PRIMARY KEY CLUSTERED  ([Id])
');

GO
EXECUTE ('PRINT N''Altering [APPS].[EmployeeContact]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[EmployeeContact] ADD
[Description] [nvarchar] (500) NULL
');

GO
EXECUTE ('PRINT N''Altering [APPS].[SupplierContact]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[SupplierContact] ADD
[Description] [nvarchar] (500) NULL
');

GO
EXECUTE ('PRINT N''Altering [APPS].[SupplierGroup]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[SupplierGroup] ADD
[Code] [nvarchar] (50) NULL,
[Description] [nvarchar] (500) NULL
');

GO
EXECUTE ('ALTER TABLE [APPS].[SupplierGroup] ALTER COLUMN [Name] [nvarchar] (500) NULL
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[CustomerContact]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[CustomerContact] ADD CONSTRAINT [FK_CustomerContact_Province] FOREIGN KEY ([ProvinceId]) REFERENCES [APPS].[Province] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[CustomerGroup]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[CustomerGroup] ADD CONSTRAINT [FK_CustomerGroup_LegalEntity] FOREIGN KEY ([LegalEntityId]) REFERENCES [APPS].[LegalEntity] ([Id])
');

GO
EXECUTE ('PRINT N''Adding foreign keys to [APPS].[CustomerDetail]''
');

GO
EXECUTE ('ALTER TABLE [APPS].[CustomerDetail] ADD CONSTRAINT [FK_CustomerDetail_CustomerGroup] FOREIGN KEY ([CustomerGroupId]) REFERENCES [APPS].[CustomerGroup] ([Id])
');

GO
SET NOEXEC OFF;

GO
IF N'$(IsSqlCmdEnabled)' <> N'True'
  SET NOEXEC ON;

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('046a0f01-f60f-47a7-acb2-25565bcb6252' AS UNIQUEIDENTIFIER))
  PRINT '***** FINISHED EXECUTING MIGRATION "Migrations\022_20190715-1824_PC.sql", ID: {046a0f01-f60f-47a7-acb2-25565bcb6252} *****
';

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('046a0f01-f60f-47a7-acb2-25565bcb6252' AS UNIQUEIDENTIFIER))
  INSERT [$(DatabaseName)].[dbo].[__MigrationLog] ([migration_id], [script_checksum], [script_filename], [complete_dt], [applied_by], [deployed], [version], [package_version], [release_version])
  VALUES                                         (CAST ('046a0f01-f60f-47a7-acb2-25565bcb6252' AS UNIQUEIDENTIFIER), 'AE5E3F565E82803576B1B13E988F7A83CCC1A798D2806DCC0CAA7280BB8EFFAE', 'Migrations\022_20190715-1824_PC.sql', SYSDATETIME(), SYSTEM_USER, 1, NULL, '$(PackageVersion)', CASE '$(ReleaseVersion)' WHEN '' THEN NULL ELSE '$(ReleaseVersion)' END);

GO
PRINT '# Committing transaction';

COMMIT TRANSACTION;

GO







------------------------------------------------------------------------------------------------------------------------
------------------------------------------       POST-DEPLOYMENT SCRIPTS      ------------------------------------------
------------------------------------------------------------------------------------------------------------------------

SET IMPLICIT_TRANSACTIONS, NUMERIC_ROUNDABORT OFF;
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, NOCOUNT, QUOTED_IDENTIFIER ON;
IF DB_NAME() != '$(DatabaseName)'
  USE [$(DatabaseName)];

GO

PRINT '----- executing post-deployment script "Post-Deployment\01_Finalize_Deployment.sql" -----';
GO

---------------------- BEGIN POST-DEPLOYMENT SCRIPT: "Post-Deployment\01_Finalize_Deployment.sql" ------------------------
/*
Post-Deployment Script Template
--------------------------------------------------------------------------------------
 This file contains SQL statements that will be appended to the build script.
 Use SQLCMD syntax to include a file in the post-deployment script.
 Example:      :r .\myfile.sql
 Use SQLCMD syntax to reference a variable in the post-deployment script.
 Example:      :setvar TableName MyTable
               SELECT * FROM [$(TableName)]
--------------------------------------------------------------------------------------
*/

GO
----------------------- END POST-DEPLOYMENT SCRIPT: "Post-Deployment\01_Finalize_Deployment.sql" -------------------------

SET IMPLICIT_TRANSACTIONS, NUMERIC_ROUNDABORT OFF;
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, NOCOUNT, QUOTED_IDENTIFIER ON;
IF DB_NAME() != '$(DatabaseName)'
  USE [$(DatabaseName)];

GO


IF SERVERPROPERTY('EngineEdition') != 5 AND HAS_PERMS_BY_NAME(N'sys.xp_logevent', N'OBJECT', N'EXECUTE') = 1
BEGIN
  DECLARE @databaseName AS nvarchar(2048), @eventMessage AS nvarchar(2048)
  SET @databaseName = REPLACE(REPLACE(DB_NAME(), N'\', N'\\'), N'"', N'\"')
  SET @eventMessage = N'Redgate SQL Change Automation: { "deployment": { "description": "Redgate SQL Change Automation deployed $(ReleaseVersion) to ' + @databaseName + N'", "database": "' + @databaseName + N'" }}'
  EXECUTE sys.xp_logevent 55000, @eventMessage
END
PRINT 'Deployment completed successfully.'
GO




SET NOEXEC OFF; -- Resume statement execution if an error occurred within the script pre-amble
